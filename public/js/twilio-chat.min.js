!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;((t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Twilio||(t.Twilio={})).Chat=e()}}(function(){return function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){return i(t[s][1][e]||e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){try{return new Date(e)}catch(e){return null}}function o(e){switch(e){case"notParticipating":return"known";default:return e}}var s=r(e("babel-runtime/core-js/get-iterator")),a=r(e("babel-runtime/regenerator")),u=r(e("babel-runtime/core-js/map")),c=r(e("babel-runtime/core-js/json/stringify")),l=r(e("babel-runtime/core-js/number/is-integer")),f=r(e("babel-runtime/core-js/object/get-prototype-of")),h=r(e("babel-runtime/helpers/classCallCheck")),d=r(e("babel-runtime/helpers/createClass")),p=r(e("babel-runtime/helpers/possibleConstructorReturn")),m=r(e("babel-runtime/helpers/inherits")),v=r(e("babel-runtime/core-js/promise")),b=function(e,t,n,r){return new(n||(n=v.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var y=e("events"),_=e("./logger"),g=e("./data/members"),k=e("./member"),w=e("./data/messages"),C=e("./util"),x=_.Logger.scope(""),j={attributes:"attributes",createdBy:"createdBy",dateCreated:"dateCreated",dateUpdated:"dateUpdated",friendlyName:"friendlyName",lastConsumedMessageIndex:"lastConsumedMessageIndex",name:"friendlyName",sid:"sid",status:"status",type:"type",uniqueName:"uniqueName"},E=function(e){function t(e,n,r){(0,h.default)(this,t);var o=(0,p.default)(this,(t.__proto__||(0,f.default)(t)).call(this)),s=n.attributes||{},a=n.createdBy,d=i(n.dateCreated),m=i(n.dateUpdated),v=n.name||n.friendlyName||null,b=(0,l.default)(n.lastConsumedMessageIndex)?n.lastConsumedMessageIndex:null,y=n.uniqueName||null;try{(0,c.default)(s)}catch(e){throw new Error("Attributes must be a valid JSON object.")}return o.services=e,o.sid=r,o.entityName=n.channel,o.state={uniqueName:y,status:"known",type:n.type,attributes:s,createdBy:a,dateCreated:d,dateUpdated:m,friendlyName:v,lastConsumedMessageIndex:b},o.members=new u.default,o.membersEntity=new g.Members(o,e.session,e.userInfos,o.members),o.membersEntity.on("memberJoined",o.emit.bind(o,"memberJoined")),o.membersEntity.on("memberLeft",o.emit.bind(o,"memberLeft")),o.membersEntity.on("memberUpdated",o.emit.bind(o,"memberUpdated")),o.membersEntity.on("memberInfoUpdated",o.emit.bind(o,"memberInfoUpdated")),o.messages=[],o.messagesEntity=new w.Messages(o,e.session,o.messages),o.messagesEntity.on("messageAdded",function(e){return o._onMessageAdded(e)}),o.messagesEntity.on("messageUpdated",o.emit.bind(o,"messageUpdated")),o.messagesEntity.on("messageRemoved",o.emit.bind(o,"messageRemoved")),o}return(0,m.default)(t,e),(0,d.default)(t,[{key:"_subscribe",value:function(){var e=this;return this.entityPromise?this.entityPromise:this.entityPromise=this.entityPromise||this.services.session.datasync.document({uniqueName:this.entityName,mode:"open"}).then(function(t){return e.entity=t,e.entity.on("updated",function(t){e._update(t)}),e.entity.on("removed",function(){return e.emit("removed",e)}),e._update(e.entity.value),t}).catch(function(t){throw e.entity=null,e.entityPromise=null,x.error("Failed to get channel object",t),t})}},{key:"_subscribeStreams",value:function(){return b(this,void 0,void 0,a.default.mark(function e(){var t,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._subscribe();case 3:return x.trace("_subscribeStreams, this.entity.value=",this.entity.value),t=this.entity.value.messages,n=this.entity.value.roster,e.next=8,v.default.all([this.messagesEntity.subscribe(t),this.membersEntity.subscribe(n)]);case 8:e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(0),x.error("Failed to subscribe on channel objects",this.sid,e.t0),e.t0;case 14:case"end":return e.stop()}},e,this,[[0,10]])}))}},{key:"_unsubscribe",value:function(){return b(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrivate||!this.entity){e.next=5;break}return e.next=3,this.entity.close();case 3:this.entity=null,this.entityPromise=null;case 5:return e.abrupt("return",v.default.all([this.membersEntity.unsubscribe(),this.messagesEntity.unsubscribe()]));case 6:case"end":return e.stop()}},e,this)}))}},{key:"_setStatus",value:function(e){this.state.status!==e&&(this.state.status=e,"joined"===e?this._subscribeStreams():"invited"===e?this._subscribe():this.entityPromise&&this._unsubscribe())}},{key:"_update",value:function(e){x.trace("_update",e),t.preprocessUpdate(e,this.sid);var n=!1;for(var r in e){var i=j[r];i&&(i===j.status?this.state.status=o(e.status):i===j.attributes?C.isDeepEqual(this.state.attributes,e.attributes)||(this.state.attributes=e.attributes,n=!0):e[r]instanceof Date?this.state[i]&&this.state[i].getTime()===e[r].getTime()||(this.state[i]=e[r],n=!0):this[i]!==e[r]&&(this.state[i]=e[r],n=!0))}e.status||e.uniqueName||this.state.uniqueName&&(this.state.uniqueName=null,n=!0),n&&this.emit("updated",this)}},{key:"_onMessageAdded",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=(0,s.default)(this.members.values());!(t=(i=o.next()).done);t=!0){var a=i.value;if(a.identity===e.author){a._endTyping();break}}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}this.emit("messageAdded",e)}},{key:"add",value:function(e){return b(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&"string"==typeof e){t.next=2;break}throw new Error("Channel.add requires an <String>identity parameter");case 2:return t.abrupt("return",this.membersEntity.add(e));case 3:case"end":return t.stop()}},t,this)}))}},{key:"advanceLastConsumedMessageIndex",value:function(e){return b(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((0,l.default)(e)){t.next=2;break}throw new Error("Channel.advanceLastConsumedMessageIndex requires an integral <Number>index parameter");case 2:if(!(null!==this.lastConsumedMessageIndex&&e<=this.lastConsumedMessageIndex)){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,this._subscribeStreams();case 6:return this.services.consumptionHorizon.advanceLastConsumedMessageIndexForChannel(this.sid,e),t.abrupt("return",this);case 8:case"end":return t.stop()}},t,this)}))}},{key:"decline",value:function(){return b(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("declineInvitation",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}))}},{key:"delete",value:function(){return b(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("destroyChannel",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}))}},{key:"getAttributes",value:function(){return b(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribe();case 2:return e.abrupt("return",this.attributes);case 3:case"end":return e.stop()}},e,this)}))}},{key:"getMessages",value:function(e,t,n){return b(this,void 0,void 0,a.default.mark(function r(){return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(void 0===t||(0,l.default)(t)){r.next=2;break}throw new Error("Anchor should be a valid message index");case 2:return r.next=4,this._subscribeStreams();case 4:return r.abrupt("return",this.messagesEntity.getMessages(e,t,n));case 5:case"end":return r.stop()}},r,this)}))}},{key:"getMembers",value:function(){return b(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.membersEntity.getMembers());case 3:case"end":return e.stop()}},e,this)}))}},{key:"getMembersCount",value:function(){return b(this,void 0,void 0,a.default.mark(function e(){var t,n,r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=e.sent,n=new C.UriBuilder(t.publicChannelsUrl).path(this.sid).build(),e.next=6,this.services.network.get(n);case 6:return r=e.sent,e.abrupt("return",r.body.members_count);case 8:case"end":return e.stop()}},e,this)}))}},{key:"getMessagesCount",value:function(){return b(this,void 0,void 0,a.default.mark(function e(){var t,n,r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=e.sent,n=new C.UriBuilder(t.publicChannelsUrl).path(this.sid).build(),e.next=6,this.services.network.get(n);case 6:return r=e.sent,e.abrupt("return",r.body.messages_count);case 8:case"end":return e.stop()}},e,this)}))}},{key:"getUnconsumedMessagesCount",value:function(){return b(this,void 0,void 0,a.default.mark(function e(){var t,n,r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=e.sent,n=new C.UriBuilder(t.myChannelsUrl).arg("ChannelSid",this.sid).build(),e.next=6,this.services.network.get(n);case 6:if(!(r=e.sent).body.channels.length){e.next=9;break}return e.abrupt("return",r.body.channels[0].unread_messages_count||0);case 9:throw new Error("Channel is not in user channels list");case 10:case"end":return e.stop()}},e,this)}))}},{key:"invite",value:function(e){return b(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e&&e.length){t.next=2;break}throw new Error("Channel.invite requires an <String>identity parameter");case 2:return t.abrupt("return",this.membersEntity.invite(e));case 3:case"end":return t.stop()}},t,this)}))}},{key:"join",value:function(){return b(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("joinChannel",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}))}},{key:"leave",value:function(){return b(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("joined"!==this.state.status){e.next=3;break}return e.next=3,this.services.session.addCommand("leaveChannel",{channelSid:this.sid});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}},e,this)}))}},{key:"removeMember",value:function(e){return b(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&("string"==typeof e||e instanceof k.Member)){t.next=2;break}throw new Error("Channel.removeMember requires a <String|Member>member parameter.");case 2:return t.abrupt("return",this.membersEntity.remove("string"==typeof e?e:e.identity));case 3:case"end":return t.stop()}},t,this)}))}},{key:"sendMessage",value:function(e,t){return b(this,void 0,void 0,a.default.mark(function n(){var r;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.messagesEntity.send(e,t);case 2:return r=n.sent,n.abrupt("return",r.messageId);case 4:case"end":return n.stop()}},n,this)}))}},{key:"setAllMessagesConsumed",value:function(){return b(this,void 0,void 0,a.default.mark(function e(){var t;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this.getMessages(1);case 4:if(!((t=e.sent).items.length>0)){e.next=8;break}return e.next=8,this.advanceLastConsumedMessageIndex(t.items[0].index);case 8:return e.abrupt("return",this);case 9:case"end":return e.stop()}},e,this)}))}},{key:"setNoMessagesConsumed",value:function(){return b(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid,null),e.abrupt("return",this);case 4:case"end":return e.stop()}},e,this)}))}},{key:"typing",value:function(){return this.services.typingIndicator.send(this.sid)}},{key:"updateAttributes",value:function(e){return b(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=4;break}throw new Error("Attributes can't be null");case 4:if(e.constructor===Object){t.next=6;break}throw new Error("Attributes must be a valid JSON object.");case 6:return t.next=8,this.services.session.addCommand("editAttributes",{channelSid:this.sid,attributes:(0,c.default)(e)});case 8:return t.abrupt("return",this);case 9:case"end":return t.stop()}},t,this)}))}},{key:"updateFriendlyName",value:function(e){return b(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state.friendlyName===e){t.next=3;break}return t.next=3,this.services.session.addCommand("editFriendlyName",{channelSid:this.sid,friendlyName:e});case 3:return t.abrupt("return",this);case 4:case"end":return t.stop()}},t,this)}))}},{key:"updateLastConsumedMessageIndex",value:function(e){return b(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((0,l.default)(e)||null===e){t.next=2;break}throw new Error('Incorrect argument "index": integer number or null expected');case 2:return t.next=4,this._subscribeStreams();case 4:return this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid,e),t.abrupt("return",this);case 6:case"end":return t.stop()}},t,this)}))}},{key:"updateUniqueName",value:function(e){return b(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state.uniqueName===e){t.next=3;break}return t.next=3,this.services.session.addCommand("editUniqueName",{channelSid:this.sid,uniqueName:e});case 3:return t.abrupt("return",this);case 4:case"end":return t.stop()}},t,this)}))}},{key:"session",get:function(){return this.services.session}},{key:"status",get:function(){return this.state.status}},{key:"type",get:function(){return this.state.type}},{key:"uniqueName",get:function(){return this.state.uniqueName}},{key:"isPrivate",get:function(){return"private"===this.state.type}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"createdBy",get:function(){return this.state.createdBy}},{key:"attributes",get:function(){return this.state.attributes}},{key:"lastConsumedMessageIndex",get:function(){return this.state.lastConsumedMessageIndex}}],[{key:"preprocessUpdate",value:function(e,t){try{"string"==typeof e.attributes?e.attributes=JSON.parse(e.attributes):e.attributes&&(0,c.default)(e.attributes)}catch(n){x.warn("Retrieved malformed attributes from the server for channel: "+t),e.attributes={}}try{e.dateCreated&&(e.dateCreated=new Date(e.dateCreated))}catch(n){x.warn("Retrieved malformed attributes from the server for channel: "+t),delete e.dateCreated}try{e.dateUpdated&&(e.dateUpdated=new Date(e.dateUpdated))}catch(n){x.warn("Retrieved malformed attributes from the server for channel: "+t),delete e.dateUpdated}}}]),t}(y.EventEmitter);n.Channel=E},{"./data/members":6,"./data/messages":7,"./logger":10,"./member":11,"./util":21,"babel-runtime/core-js/get-iterator":23,"babel-runtime/core-js/json/stringify":25,"babel-runtime/core-js/map":26,"babel-runtime/core-js/number/is-integer":27,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,"babel-runtime/regenerator":48,events:194}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){try{return JSON.parse(e)}catch(e){u.warn("Failed to parse channel attributes",e)}return{}}function o(e){try{return new Date(e)}catch(e){return null}}var s=r(e("babel-runtime/helpers/classCallCheck")),a=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var u=new(e("./logger").Logger),c=function(){function e(t,n){(0,s.default)(this,e),this.client=t,this.descriptor=n,this.sid=n.sid,this.channel=n.sid+".channel",this.uniqueName=n.unique_name,this.friendlyName=n.friendly_name,this.attributes=i(n.attributes),this.createdBy=n.created_by,this.dateCreated=o(n.date_created),this.dateUpdated=o(n.date_updated),this.messagesCount=n.messages_count,this.membersCount=n.members_count,this.type=n.type}return(0,a.default)(e,[{key:"getChannel",value:function(){return this.client.getChannelBySid(this.sid)}}]),e}();n.ChannelDescriptor=c},{"./logger":10,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/regenerator")),o=r(e("babel-runtime/core-js/object/get-prototype-of")),s=r(e("babel-runtime/helpers/classCallCheck")),a=r(e("babel-runtime/helpers/createClass")),u=r(e("babel-runtime/helpers/possibleConstructorReturn")),c=r(e("babel-runtime/helpers/inherits")),l=r(e("babel-runtime/core-js/promise")),f=function(e,t,n,r){return new(n||(n=l.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var h=e("events"),d=e("./logger"),p=e("./configuration"),m=e("./userinfo");n.UserInfo=m.UserInfo;var v=e("./data/publicchannels"),b=e("./services/network"),y=d.Logger.scope(""),_=e("twilsock"),g=e("twilio-notifications"),k=e("twilio-transport"),w=e("twilio-sync"),C=e("twilio-ems-client"),x=e("./session"),j=e("./data/channels"),E=e("./data/userinfos"),S=e("./services/typingindicator"),T=e("./services/consumptionhorizon"),R=e("./../package.json").version,I="A valid Twilio token should be provided",A=function(e){function t(e,n){(0,s.default)(this,t);var r=(0,u.default)(this,(t.__proto__||(0,o.default)(t)).call(this));if(r.connectionState="connecting",r.initializePromise=null,r.sessionPromise=null,r.channelsPromise=null,r.publicChannels=null,r.options=n||{},r.options.logLevel=r.options.logLevel||"error",r.options.productId="ip_messaging",r.options.Sync=r.options.Sync||{},r.options.Sync.enableSessionStorage||(r.options.Sync.enableSessionStorage=!1),!e)throw new Error(I);return y.setLevel(r.options.logLevel),r.config=new p.Configuration(null,r.options),r.options.twilsockClient=r.options.twilsockClient||new _(e,r.options),r.options.transport=r.options.transport||new k.Transport(r.options.twilsockClient,r.options),r.options.emsClient=r.options.emsClient||new C.EmsClient(r.options),r.options.notificationsClient=r.options.notificationsClient||new g(e,r.options),r.options.syncClient=r.options.syncClient||new w.SyncClient(e,r.options),r.emsClient=r.options.emsClient,r.datasync=r.options.syncClient,r.transport=r.options.transport,r.twilsock=r.options.twilsockClient,r.notifications=r.options.notificationsClient,r.session=new x.Session(r.datasync,r.transport,r.config),r.sessionPromise=r.session.initialize(e),r.network=new b.Network(r.config,r.session,r.transport),r.userInfos=new E.UserInfos(r.session,r.datasync),r.userInfos.on("userInfoUpdated",r.emit.bind(r,"userInfoUpdated")),r.consumptionHorizon=new T.ConsumptionHorizon(r.config,r.session),r.typingIndicator=new S.TypingIndicator(r.config,r.transport,r.notifications,r.getChannelBySid.bind(r)),r.channels=new j.Channels({session:r.session,userInfos:r.userInfos,typingIndicator:r.typingIndicator,consumptionHorizon:r.consumptionHorizon,network:r.network,config:r.config}),r.channelsPromise=r.sessionPromise.then(function(){return r.channels.on("channelAdded",r.emit.bind(r,"channelAdded")),r.channels.on("channelRemoved",r.emit.bind(r,"channelRemoved")),r.channels.on("channelInvited",r.emit.bind(r,"channelInvited")),r.channels.on("channelJoined",r.emit.bind(r,"channelJoined")),r.channels.on("channelLeft",r.emit.bind(r,"channelLeft")),r.channels.on("channelUpdated",r.emit.bind(r,"channelUpdated")),r.channels.on("memberJoined",r.emit.bind(r,"memberJoined")),r.channels.on("memberLeft",r.emit.bind(r,"memberLeft")),r.channels.on("memberUpdated",r.emit.bind(r,"memberUpdated")),r.channels.on("messageAdded",r.emit.bind(r,"messageAdded")),r.channels.on("messageUpdated",r.emit.bind(r,"messageUpdated")),r.channels.on("messageRemoved",r.emit.bind(r,"messageRemoved")),r.channels.on("typingStarted",r.emit.bind(r,"typingStarted")),r.channels.on("typingEnded",r.emit.bind(r,"typingEnded")),r.channels.fetchChannels()}).then(function(){return r.channels}),r.notifications.on("transportReady",function(e){if(e)r.connectionState="connected",r.session.syncToken().catch(function(e){y.error("Faled to sync session token",e)});else switch(r.twilsock.state){case"rejected":r.connectionState="denied";break;default:r.connectionState="connecting"}r.emit("connectionStateChanged",r.connectionState)}),r.fpaToken=e,r.initializePromise=r._initialize(),r}return(0,c.default)(t,e),(0,a.default)(t,[{key:"_initialize",value:function(){return f(this,void 0,void 0,i.default.mark(function e(){var n,r,o=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.emsClient.setToken(this.fpaToken);case 2:return n=e.sent,this.config.updateToken(n.token),e.next=6,this.sessionPromise;case 6:return t.supportedPushChannels.forEach(function(e){return o.subscribeToPushNotifications(e)}),e.next=9,this.session.getSessionLinks();case 9:return r=e.sent,this.publicChannels=new v.PublicChannels(this.config,this,this.network,r.publicChannelsUrl),e.next=13,this.typingIndicator.initialize();case 13:case"end":return e.stop()}},e,this)}))}},{key:"subscribeToPushNotifications",value:function(e){var t=this;["twilio.channel.new_message","twilio.channel.added_to_channel","twilio.channel.invited_to_channel","twilio.channel.removed_from_channel","twilio.ipmsg.typing_indicator","twilio.channel.consumption_update"].forEach(function(n){t.notifications.subscribe(n,e)})}},{key:"initialize",value:function(){var e=this;return this.initializePromise.then(function(){return e})}},{key:"shutdown",value:function(){return this.twilsock.disconnect()}},{key:"updateToken",value:function(e){return f(this,void 0,void 0,i.default.mark(function t(){var n=this;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(y.info("updateToken"),e){t.next=3;break}throw new Error(I);case 3:if(e!==this.fpaToken){t.next=5;break}return t.abrupt("return",this);case 5:return t.abrupt("return",this.emsClient.setToken(e).then(function(e){if("NEW"===e.status)throw y.error("Can't extend token:",e.reason),new Error("Can't extend token:"+e.reason);return e.token}).then(function(t){return n.twilsock.updateToken(e).then(function(){return n.datasync.updateToken(e)}).then(function(){return n.notifications.updateToken(e)}).then(function(){return n.sessionPromise}).then(function(){return n.session.updateToken(t)}).then(function(){return t})}).then(function(t){return n.config.updateToken(t),n.fpaToken=e,n}));case 6:case"end":return t.stop()}},t,this)}))}},{key:"getChannelBySid",value:function(e){return f(this,void 0,void 0,i.default.mark(function t(){var n=this;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&"string"==typeof e){t.next=2;break}throw new Error("Client.getChannelBySid requires a <String>channelSid parameter");case 2:return t.abrupt("return",this.channels.getChannel(e).then(function(t){return t||n.publicChannels.getChannelBySid(e).then(function(e){return n.channels.pushChannel(e)})}));case 3:case"end":return t.stop()}},t,this)}))}},{key:"getChannelByUniqueName",value:function(e){return f(this,void 0,void 0,i.default.mark(function t(){var n=this;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&"string"==typeof e){t.next=2;break}throw new Error("Client.getChannelByUniqueName requires a <String>uniqueName parameter");case 2:return t.abrupt("return",this.publicChannels.getChannelByUniqueName(e).then(function(e){return n.channels.pushChannel(e)}));case 3:case"end":return t.stop()}},t,this)}))}},{key:"getUserChannels",value:function(e){return this.channelsPromise.then(function(t){return t.getChannels(e)})}},{key:"getPublicChannels",value:function(){return this.publicChannels.getChannels()}},{key:"createChannel",value:function(e){return e=e||{},this.channelsPromise.then(function(t){return t.addChannel(e)})}},{key:"setPushRegistrationId",value:function(e,n){if(-1===t.supportedPushChannels.indexOf(e))throw new Error("Invalid or unsupported channelType: "+e);this.notifications.setPushRegistrationId(n,e)}},{key:"handlePushNotification",value:function(e){var t=e.additionalData;switch(t.type){case"twilio.ipmsg.typing_indicator":this.typingIndicator.handleRemoteTyping(t.data);break;case"twilio.channel.new_message":var n=t.data.channel_id,r=t.data.message_id;this.getChannelBySid(n).then(function(e){return e.getMessages(10,r)})}}},{key:"userInfo",get:function(){return this.userInfos.myUserInfo}},{key:"reachabilityEnabled",get:function(){return this.session.reachabilityEnabled}}]),t}(h.EventEmitter);A.version=R,A.supportedPushChannels=["fcm","apn","gcm"],n.Client=A,n.default=A},{"./../package.json":262,"./configuration":4,"./data/channels":5,"./data/publicchannels":8,"./data/userinfos":9,"./logger":10,"./services/consumptionhorizon":14,"./services/network":15,"./services/typingindicator":16,"./session":17,"./userinfo":19,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,"babel-runtime/regenerator":48,events:194,"twilio-ems-client":208,"twilio-notifications":214,"twilio-sync":225,"twilio-transport":244,twilsock:247}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/helpers/classCallCheck")),o=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var s="https://aim.twilio.com",a=function(){function e(t,n){(0,i.default)(this,e),n=n||{},this.options=n.Chat||n.IPMessaging||n||{};var r=this.options.apiUri||this.options.typingUri||s;this.token=t,this.baseUrl=r}return(0,o.default)(e,[{key:"updateToken",value:function(e){this.token=e}},{key:"typingIndicatorUri",get:function(){return this.baseUrl+"/v1/typing"}},{key:"typingIndicatorTimeoutDefault",get:function(){return 5e3}},{key:"httpCacheLifetimeDefault",get:function(){return 1e4}},{key:"consumptionReportIntervalDefault",get:function(){return"PT5S"}},{key:"typingIndicatorTimeoutOverride",get:function(){return this.options.typingIndicatorTimeoutOverride}},{key:"httpCacheLifetimeOverride",get:function(){return this.options.httpCacheLifetimeOverride}},{key:"consumptionReportIntervalOverride",get:function(){return this.options.consumptionReportIntervalOverride}}]),e}();n.Configuration=a},{"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/regenerator")),o=r(e("babel-runtime/core-js/json/stringify")),s=r(e("babel-runtime/core-js/map")),a=r(e("babel-runtime/core-js/object/get-prototype-of")),u=r(e("babel-runtime/helpers/classCallCheck")),c=r(e("babel-runtime/helpers/createClass")),l=r(e("babel-runtime/helpers/possibleConstructorReturn")),f=r(e("babel-runtime/helpers/inherits")),h=r(e("babel-runtime/core-js/promise")),d=function(e,t,n,r){return new(n||(n=h.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var p=e("events"),m=e("../logger"),v=e("../channel");n.Channel=v.Channel;var b=m.Logger.scope(""),y=function(e){function t(e){(0,u.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return n.services=e,n.channels=new s.default,n}return(0,f.default)(t,e),(0,c.default)(t,[{key:"getMap",value:function(){var e=this;return this.services.session.getMyChannelsId().then(function(t){return e.services.session.datasync.map({uniqueName:t,mode:"open"})})}},{key:"addChannel",value:function(e){return d(this,void 0,void 0,i.default.mark(function t(){var n,r,s;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.services.session.addCommand("createChannel",{friendlyName:e.friendlyName,uniqueName:e.uniqueName,type:e.isPrivate?"private":"public",attributes:(0,o.default)(e.attributes)});case 2:if(n=t.sent,!(r=this.channels.get(n.channelSid))){t.next=8;break}return t.next=7,r._subscribe();case 7:return t.abrupt("return",r);case 8:return s=new v.Channel(this.services,{channel:n.channel,name:null,entityName:null,uniqueName:null,attributes:null,createdBy:null,friendlyName:null,lastConsumedMessageIndex:null,type:e.isPrivate?"private":"public",dateCreated:null,dateUpdated:null},n.channelSid),this.channels.set(s.sid,s),this.registerForEvents(s),t.next=13,s._subscribe();case 13:return this.emit("channelAdded",s),t.abrupt("return",s);case 15:case"end":return t.stop()}},t,this)}))}},{key:"fetchChannels",value:function(){var e=this;this.services.session.getMyChannelsId().then(function(t){return e.services.session.datasync.map({uniqueName:t,mode:"open"})}).then(function(t){t.on("itemAdded",function(t){e.upsertChannel(t.key,t.value)}),t.on("itemRemoved",function(t){var n=e.channels.get(t);n&&("joined"!==n.status&&"invited"!==n.status||(n._setStatus("known"),e.emit("channelLeft",n)),n.isPrivate&&(e.channels.delete(t),e.emit("channelRemoved",n)))}),t.on("itemUpdated",function(t){e.upsertChannel(t.key,t.value)});var n=[];return t.forEach(function(t){n.push(e.upsertChannel(t.key,t.value))}).then(function(){return h.default.all(n)})}).then(function(){b.debug("Channels list fetched")}).then(function(){return e}).catch(function(e){throw b.error("Failed to get channels list",e),e})}},{key:"_wrapPaginator",value:function(e,t){var n=this;return t(e.items).then(function(r){return{items:r,hasNextPage:e.hasNextPage,hasPrevPage:e.hasPrevPage,nextPage:function(){return e.nextPage().then(function(e){return n._wrapPaginator(e,t)})},prevPage:function(){return e.prevPage().then(function(e){return n._wrapPaginator(e,t)})}}})}},{key:"getChannels",value:function(e){var t=this;return this.getMap().then(function(t){return t.getItems(e)}).then(function(e){return t._wrapPaginator(e,function(e){return h.default.all(e.map(function(e){return t.upsertChannel(e.key,e.value)}))})})}},{key:"getChannel",value:function(e){var t=this;return this.getMap().then(function(t){return t.getItems({key:e})}).then(function(e){return e.items.map(function(e){return t.upsertChannel(e.key,e.value)})}).then(function(e){return e.length>0?e[0]:null})}},{key:"pushChannel",value:function(e){var t=e.sid,n={name:null,entityName:null,lastConsumedMessageIndex:null,type:e.type,status:"known",friendlyName:e.friendlyName,dateUpdated:e.dateUpdated,dateCreated:e.dateCreated,uniqueName:e.uniqueName,createdBy:e.createdBy,attributes:e.attributes,channel:e.channel,sid:t},r=this.channels.get(e.sid);return r||(r=new v.Channel(this.services,n,t),this.registerForEvents(r),this.channels.set(t,r)),r}},{key:"upsertChannel",value:function(e,t){var n=this;b.trace("upsertChannel(sid="+e+", data=",t);var r=this.channels.get(e);return r?(b.trace("upsertChannel: channel is known",r),"joined"===t.status&&"joined"!==r.status?(r._setStatus("joined"),void 0!==t.lastConsumedMessageIndex&&r._update({lastConsumedMessageIndex:t.lastConsumedMessageIndex}),r._subscribe().then(function(){n.emit("channelJoined",r)})):"invited"===t.status&&"invited"!==r.status?(r._setStatus("invited"),r._subscribe().then(function(){n.emit("channelInvited",r)})):"known"!==t.status||"invited"!==r.status&&"joined"!==r.status?"notParticipating"===t.status&&"private"===t.type?r._subscribe():r._update(t):(r._setStatus("known"),r._update(t),r._subscribe().then(function(){n.emit("channelLeft",r)})),r._subscribe().then(function(){return r})):(b.trace("upsertChannel: creating local channel object"),r=new v.Channel(this.services,t,e),this.registerForEvents(r),this.channels.set(e,r),r._subscribe().then(function(){return"joined"===t.status?(r._setStatus("joined"),n.emit("channelJoined",r)):"invited"===t.status&&(r._setStatus("invited"),n.emit("channelInvited",r)),n.emit("channelAdded",r),r}))}},{key:"onChannelRemoved",value:function(e){var t=this.channels.get(e);t&&(this.channels.delete(e),this.emit("channelRemoved",t))}},{key:"registerForEvents",value:function(e){var t=this;e.on("removed",function(){return t.onChannelRemoved(e.sid)}),e.on("updated",function(){return t.emit("channelUpdated",e)}),e.on("memberJoined",this.emit.bind(this,"memberJoined")),e.on("memberLeft",this.emit.bind(this,"memberLeft")),e.on("memberUpdated",this.emit.bind(this,"memberUpdated")),e.on("messageAdded",this.emit.bind(this,"messageAdded")),e.on("messageUpdated",this.emit.bind(this,"messageUpdated")),e.on("messageRemoved",this.emit.bind(this,"messageRemoved")),e.on("typingStarted",this.emit.bind(this,"typingStarted")),e.on("typingEnded",this.emit.bind(this,"typingEnded"))}}]),t}(p.EventEmitter);n.Channels=y},{"../channel":1,"../logger":10,"babel-runtime/core-js/json/stringify":25,"babel-runtime/core-js/map":26,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,"babel-runtime/regenerator":48,events:194}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/regenerator")),o=r(e("babel-runtime/core-js/object/get-prototype-of")),s=r(e("babel-runtime/helpers/classCallCheck")),a=r(e("babel-runtime/helpers/createClass")),u=r(e("babel-runtime/helpers/possibleConstructorReturn")),c=r(e("babel-runtime/helpers/inherits")),l=r(e("babel-runtime/core-js/promise")),f=function(e,t,n,r){return new(n||(n=l.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var h=e("events"),d=e("../member"),p=e("../logger").Logger.scope("Members"),m=function(e){function t(e,n,r,i){(0,s.default)(this,t);var a=(0,u.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return a.channel=e,a.session=n,a.userInfos=r,a.members=i,a.sync=n.datasync,a}return(0,c.default)(t,e),(0,a.default)(t,[{key:"unsubscribe",value:function(){return f(this,void 0,void 0,i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rosterEntityPromise){e.next=6;break}return e.next=3,this.rosterEntityPromise;case 3:(t=e.sent).close(),this.rosterEntityPromise=null;case 6:case"end":return e.stop()}},e,this)}))}},{key:"subscribe",value:function(e){var t=this;return this.rosterEntityPromise=this.rosterEntityPromise||this.sync.map({uniqueName:e,mode:"open"}).then(function(e){e.on("itemAdded",function(e){t.upsertMember(e.key,e.value).then(function(e){t.emit("memberJoined",e)})}),e.on("itemRemoved",function(e){if(t.members.has(e)){var n=t.members.get(e);t.members.delete(e),t.emit("memberLeft",n)}}),e.on("itemUpdated",function(e){t.upsertMember(e.key,e.value)});var n=[];return e.forEach(function(e){n.push(t.upsertMember(e.key,e.value))}).then(function(){return l.default.all(n)}).then(function(){return e})}).catch(function(e){throw t.rosterEntityPromise=null,p.error("Failed to get roster object for channel",t.channel.sid,e),e})}},{key:"upsertMember",value:function(e,t){return f(this,void 0,void 0,i.default.mark(function n(){var r,o,s=this;return i.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=this.members.get(e))){n.next=3;break}return n.abrupt("return",r._update(t));case 3:return n.next=5,this.userInfos.getUserInfo(t.identity,t.userInfo);case 5:return o=n.sent,r=new d.Member(this.channel,t,e,o),this.members.set(e,r),r.on("updated",function(){return s.emit("memberUpdated",r)}),r.on("userInfoUpdated",function(){return s.emit("memberInfoUpdated",r)}),n.abrupt("return",r);case 11:case"end":return n.stop()}},n,this)}))}},{key:"getMembers",value:function(){var e=this;return this.rosterEntityPromise.then(function(){var t=[];return e.members.forEach(function(e){return t.push(e)}),t})}},{key:"add",value:function(e){return this.session.addCommand("addMember",{channelSid:this.channel.sid,username:e})}},{key:"invite",value:function(e){return this.session.addCommand("inviteMember",{channelSid:this.channel.sid,username:e})}},{key:"remove",value:function(e){return this.session.addCommand("removeMember",{channelSid:this.channel.sid,username:e})}}]),t}(h.EventEmitter);n.Members=m},{"../logger":10,"../member":11,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,"babel-runtime/regenerator":48,events:194}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/core-js/json/stringify")),o=r(e("babel-runtime/regenerator")),s=r(e("babel-runtime/core-js/map")),a=r(e("babel-runtime/core-js/object/get-prototype-of")),u=r(e("babel-runtime/helpers/classCallCheck")),c=r(e("babel-runtime/helpers/createClass")),l=r(e("babel-runtime/helpers/possibleConstructorReturn")),f=r(e("babel-runtime/helpers/inherits")),h=r(e("babel-runtime/core-js/promise")),d=function(e,t,n,r){return new(n||(n=h.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var p=e("events"),m=e("../logger"),v=e("../message"),b=m.Logger.scope(""),y=function(e){function t(e,n,r){(0,u.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return i.channel=e,i.session=n,i.sync=n.datasync,i.sortedMessages=[],i.messagesByIndex=new s.default,i.messagesListPromise=null,i}return(0,f.default)(t,e),(0,c.default)(t,[{key:"subscribe",value:function(e){var t=this;return this.messagesListPromise=this.messagesListPromise||this.sync.list({uniqueName:e,mode:"open"}).then(function(e){return e.on("itemAdded",function(e){var n=new v.Message(t.channel,t.session,e.index,e.value);t.messagesByIndex.has(n.index)?b.debug("Message arrived, but already known and ignored",t.channel.sid,n.index):(t.sortedMessages.push(n),t.messagesByIndex.set(n.index,n),n.on("updated",function(){return t.emit("messageUpdated",n)}),t.emit("messageAdded",n))}),e.on("itemRemoved",function(e){var n=t.removeMessageById(e);n&&(t.messagesByIndex.delete(n.index),n.removeAllListeners("updated"),t.emit("messageRemoved",n))}),e.on("itemUpdated",function(e){var n=t.messagesByIndex.get(e.index);n&&n._update(e.value)}),e}).catch(function(e){throw t.messagesListPromise=null,b.error("Failed to get messages object for channel",t.channel.sid,e),e})}},{key:"unsubscribe",value:function(){return d(this,void 0,void 0,o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.messagesListPromise){e.next=6;break}return e.next=3,this.messagesListPromise;case 3:(t=e.sent).close(),this.messagesListPromise=null;case 6:case"end":return e.stop()}},e,this)}))}},{key:"removeMessageById",value:function(e){for(var t=void 0,n=0;n<this.sortedMessages.length;n++)if(this.sortedMessages[n].index===e){t=this.sortedMessages.splice(n,1)[0];break}return t}},{key:"send",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d(this,void 0,void 0,o.default.mark(function n(){return o.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t.constructor===Object){n.next=2;break}throw new Error("Attributes must be a valid JSON object");case 2:return n.abrupt("return",this.session.addCommand("sendMessage",{channelSid:this.channel.sid,text:e,attributes:(0,i.default)(t)}));case 3:case"end":return n.stop()}},n,this)}))}},{key:"getMessages",value:function(e,t,n){return t=void 0!==t?t:"end",n=n||"backwards",this._getMessages(e,t,n)}},{key:"wrapPaginator",value:function(e,t,n){var r=this,i="desc"===e,o=function(){return t.nextPage().then(function(t){return r.wrapPaginator(e,t,n)})},s=function(){return t.prevPage().then(function(t){return r.wrapPaginator(e,t,n)})};return n(t.items).then(function(e){return{items:e.sort(function(e,t){return e.index-t.index}),hasPrevPage:i?t.hasNextPage:t.hasPrevPage,hasNextPage:i?t.hasPrevPage:t.hasNextPage,prevPage:i?o:s,nextPage:i?s:o}})}},{key:"_upsertMessage",value:function(e,t){var n=this,r=this.messagesByIndex.get(e);if(r)return r;var i=new v.Message(this.channel,this.session,e,t);return this.messagesByIndex.set(i.index,i),i.on("updated",function(){return n.emit("messageUpdated",i)}),i}},{key:"_getMessages",value:function(e,t,n){var r=this;t=void 0!==t?t:"end",e=e||30;var i="backwards"===n?"desc":"asc";return this.messagesListPromise.then(function(n){return n.getItems({from:"end"!==t?t:void 0,pageSize:e,order:i})}).then(function(e){return r.wrapPaginator(i,e,function(e){return h.default.all(e.map(function(e){return r._upsertMessage(e.index,e.value)}))})})}}]),t}(p.EventEmitter);n.Messages=y},{"../logger":10,"../message":12,"babel-runtime/core-js/json/stringify":25,"babel-runtime/core-js/map":26,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,"babel-runtime/regenerator":48,events:194}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/regenerator")),o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/createClass")),a=r(e("babel-runtime/core-js/promise")),u=function(e,t,n,r){return new(n||(n=a.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../util"),l=e("../restpaginator"),f=e("../channeldescriptor"),h=function(){function e(t,n,r,i){(0,o.default)(this,e),this.config=t,this.client=n,this.transport=r,this.url=i}return(0,s.default)(e,[{key:"getChannels",value:function(e){return u(this,void 0,void 0,i.default.mark(function t(){var n,r,o=this;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},n=new c.UriBuilder(this.url).arg("PageToken",e.pageToken).build(),t.next=4,this.transport.get(n);case 4:return r=t.sent,t.abrupt("return",new l.Paginator(r.body.channels.map(function(e){return new f.ChannelDescriptor(o.client,e)}),function(e){return o.getChannels({pageToken:e})},r.body.meta.prev_token,r.body.meta.next_token));case 6:case"end":return t.stop()}},t,this)}))}},{key:"getChannelBySid",value:function(e){return u(this,void 0,void 0,i.default.mark(function t(){var n,r;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new c.UriBuilder(this.url).path(e).build(),t.next=3,this.transport.get(n);case 3:return r=t.sent,t.abrupt("return",new f.ChannelDescriptor(this.client,r.body));case 5:case"end":return t.stop()}},t,this)}))}},{key:"getChannelByUniqueName",value:function(e){return u(this,void 0,void 0,i.default.mark(function t(){var n,r;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new c.UriBuilder(this.url).path(encodeURIComponent(e)).build(),t.next=3,this.transport.get(n);case 3:return r=t.sent,t.abrupt("return",new f.ChannelDescriptor(this.client,r.body));case 5:case"end":return t.stop()}},t,this)}))}}]),e}();n.PublicChannels=h},{"../channeldescriptor":2,"../restpaginator":13,"../util":21,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/regenerator":48}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/core-js/map")),o=r(e("babel-runtime/core-js/object/get-prototype-of")),s=r(e("babel-runtime/helpers/classCallCheck")),a=r(e("babel-runtime/helpers/createClass")),u=r(e("babel-runtime/helpers/possibleConstructorReturn")),c=r(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{value:!0});var l=e("events"),f=e("../userinfo"),h=function(e){function t(e,n){(0,s.default)(this,t);var r=(0,u.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return r.myUserInfo=new f.UserInfo(null,null,n,e),r.myUserInfo.on("updated",function(){return r.emit("userInfoUpdated",r.myUserInfo)}),r.session=e,r.sync=n,r.infos=new i.default,r.identity=null,r.session.getUserInfosData().then(function(e){return r.identity=e.identity,r.myUserInfo.identity=e.identity,r.myUserInfo.entityName=e.userInfo,r.infos.set(e.identity,r.myUserInfo),r.myUserInfo._ensureFetched()}),r}return(0,c.default)(t,e),(0,a.default)(t,[{key:"getMyUserInfo",value:function(){var e=this;return this.session.getUserInfosData().then(function(t){return e.getUserInfo(t.identity,t.userInfo)})}},{key:"getUserInfo",value:function(e,t){var n=this,r=this.infos.get(e);return r||(r=new f.UserInfo(e,t||null,this.sync,this.session),this.infos.set(e,r),r.on("updated",function(){return n.emit("userInfoUpdated",r)})),r._ensureFetched()}}]),t}(l.EventEmitter);n.UserInfos=h},{"../userinfo":19,"babel-runtime/core-js/map":26,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,events:194}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return[e].concat((0,a.default)(t))}var o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/createClass")),a=r(e("babel-runtime/core-js/array/from"));Object.defineProperty(n,"__esModule",{value:!0});var u=e("loglevel"),c=function(){function e(){(0,o.default)(this,e),this.prefix=""}return(0,s.default)(e,[{key:"setLevel",value:function(e){u.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.trace.apply(null,i("Chat T:"+this.prefix,t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.debug.apply(null,i("Chat D:"+this.prefix,t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.info.apply(null,i("Chat I:"+this.prefix,t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.warn.apply(null,i("Chat W:"+this.prefix,t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.error.apply(null,i("Chat E:"+this.prefix,t))}}],[{key:"scope",value:function(t){return new e}},{key:"setLevel",value:function(e){u.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.trace.apply(null,i("Chat T:",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.debug.apply(null,i("Chat D:",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.info.apply(null,i("Chat I:",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.warn.apply(null,i("Chat W:",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.error.apply(null,i("Chat E:",t))}}]),e}();n.Logger=c},{"babel-runtime/core-js/array/from":22,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,loglevel:198}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/core-js/number/is-integer")),o=r(e("babel-runtime/core-js/object/get-prototype-of")),s=r(e("babel-runtime/helpers/classCallCheck")),a=r(e("babel-runtime/helpers/possibleConstructorReturn")),u=r(e("babel-runtime/helpers/createClass")),c=r(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{value:!0});var l=function(e){function t(e,n,r,u){(0,s.default)(this,t);var c=(0,a.default)(this,(t.__proto__||(0,o.default)(t)).call(this));if(c.channel=e,c.userInfo=u,c.state={sid:r,typingTimeout:null,isTyping:!1,identity:n.identity,roleSid:n.roleSid||null,lastConsumedMessageIndex:(0,i.default)(n.lastConsumedMessageIndex)?n.lastConsumedMessageIndex:null,lastConsumptionTimestamp:n.lastConsumptionTimestamp?new Date(n.lastConsumptionTimestamp):null},!n.identity)throw new Error("Received invalid Member object from server: Missing identity.");return u.on("updated",function(){return c.emit("userInfoUpdated",c)}),c}return(0,c.default)(t,e),(0,u.default)(t,[{key:"identity",get:function(){return this.state.identity},set:function(e){this.state.identity=e}},{key:"isTyping",get:function(){return this.state.isTyping},set:function(e){this.state.isTyping=e}},{key:"lastConsumedMessageIndex",get:function(){return this.state.lastConsumedMessageIndex},set:function(e){this.state.lastConsumedMessageIndex=e}},{key:"lastConsumptionTimestamp",get:function(){return this.state.lastConsumptionTimestamp},set:function(e){this.state.lastConsumptionTimestamp=e}},{key:"roleSid",get:function(){return this.state.roleSid},set:function(e){this.state.roleSid=e}}]),(0,u.default)(t,[{key:"_startTyping",value:function(e){var t=this;return clearTimeout(this.state.typingTimeout),this.state.isTyping=!0,this.emit("typingStarted",this),this.channel.emit("typingStarted",this),this.state.typingTimeout=setTimeout(function(){return t._endTyping()},e),this}},{key:"_endTyping",value:function(){this.state.typingTimeout&&(this.state.isTyping=!1,this.emit("typingEnded",this),this.channel.emit("typingEnded",this),clearInterval(this.state.typingTimeout),this.state.typingTimeout=null)}},{key:"_update",value:function(e){var t=!1;if(e.roleSid&&this.state.roleSid!==e.roleSid&&(this.state.roleSid=e.roleSid,t=!0),!(0,i.default)(e.lastConsumedMessageIndex)&&null!==e.lastConsumedMessageIndex||this.state.lastConsumedMessageIndex===e.lastConsumedMessageIndex||(this.state.lastConsumedMessageIndex=e.lastConsumedMessageIndex,t=!0),e.lastConsumptionTimestamp){var n=new Date(e.lastConsumptionTimestamp);this.state.lastConsumptionTimestamp&&this.state.lastConsumptionTimestamp.getTime()===n.getTime()||(this.state.lastConsumptionTimestamp=n,t=!0)}return t&&this.emit("updated",this),this}},{key:"remove",value:function(){return this.channel.removeMember(this)}}]),t}(e("events").EventEmitter);n.Member=l},{"babel-runtime/core-js/number/is-integer":27,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,events:194}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){try{return t?JSON.parse(t):{}}catch(t){return v.warn("Got malformed attributes for the message",e),{}}}var o=r(e("babel-runtime/core-js/json/stringify")),s=r(e("babel-runtime/regenerator")),a=r(e("babel-runtime/core-js/object/get-prototype-of")),u=r(e("babel-runtime/helpers/classCallCheck")),c=r(e("babel-runtime/helpers/createClass")),l=r(e("babel-runtime/helpers/possibleConstructorReturn")),f=r(e("babel-runtime/helpers/inherits")),h=r(e("babel-runtime/core-js/promise")),d=function(e,t,n,r){return new(n||(n=h.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var p=e("events"),m=e("./util"),v=new(e("./logger").Logger),b=function(e){function t(e,n,r,o){(0,u.default)(this,t);var s=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this));s.channel=e,s.session=n;var c=(o.text,o.dateUpdated&&new Date(o.dateUpdated),o.lastUpdatedBy&&o.lastUpdatedBy,new Date(o.timestamp));return s.state={sid:o.sid,index:r,author:o.author,body:o.text,timestamp:c,dateUpdated:o.dateUpdated?new Date(o.dateUpdated):null,lastUpdatedBy:o.lastUpdatedBy?o.lastUpdatedBy:null,attributes:i(o.sid,o.attributes)},s}return(0,f.default)(t,e),(0,c.default)(t,[{key:"_update",value:function(e){var t=!1;!e.text&&"string"!=typeof e.text||e.text===this.state.body||(this.state.body=e.text,t=!0),e.lastUpdatedBy&&e.lastUpdatedBy!==this.state.lastUpdatedBy&&(this.state.lastUpdatedBy=e.lastUpdatedBy,t=!0),e.dateUpdated&&new Date(e.dateUpdated).getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=new Date(e.dateUpdated),t=!0);var n=i(this.sid,e.attributes);m.isDeepEqual(this.state.attributes,n)||(this.state.attributes=n,t=!0),t&&this.emit("updated",this)}},{key:"remove",value:function(){return d(this,void 0,void 0,s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.session.addCommand("deleteMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString()});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}))}},{key:"updateBody",value:function(e){return d(this,void 0,void 0,s.default.mark(function t(){return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e){t.next=2;break}throw new Error("Body <String> is a required parameter for updateBody");case 2:return t.next=4,this.session.addCommand("editMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString(),text:e});case 4:return t.abrupt("return",this);case 5:case"end":return t.stop()}},t,this)}))}},{key:"updateAttributes",value:function(e){return d(this,void 0,void 0,s.default.mark(function t(){return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e){t.next=4;break}throw new Error("Attributes is a required parameter for updateAttributes");case 4:if(e.constructor===Object){t.next=6;break}throw new Error("Attributes must be a valid JSON object");case 6:return t.next=8,this.session.addCommand("editMessageAttributes",{channelSid:this.channel.sid,messageIdx:this.index,attributes:(0,o.default)(e)});case 8:return t.abrupt("return",this);case 9:case"end":return t.stop()}},t,this)}))}},{key:"sid",get:function(){return this.state.sid}},{key:"author",get:function(){return this.state.author}},{key:"body",get:function(){return this.state.body}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"index",get:function(){return this.state.index}},{key:"lastUpdatedBy",get:function(){return this.state.lastUpdatedBy}},{key:"timestamp",get:function(){return this.state.timestamp}},{key:"attributes",get:function(){return this.state.attributes}}]),t}(p.EventEmitter);n.Message=b},{"./logger":10,"./util":21,"babel-runtime/core-js/json/stringify":25,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,"babel-runtime/regenerator":48,events:194}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/core-js/promise")),o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(t,n,r,i){(0,o.default)(this,e),this.state={prevToken:r,nextToken:i,source:n,items:t}}return(0,s.default)(e,[{key:"hasNextPage",get:function(){return!!this.state.nextToken}},{key:"hasPrevPage",get:function(){return!!this.state.prevToken}},{key:"items",get:function(){return this.state.items}}]),(0,s.default)(e,[{key:"nextPage",value:function(){return this.hasNextPage?this.state.source(this.state.nextToken):i.default.reject(new Error("No next page"))}},{key:"prevPage",value:function(){return this.hasPrevPage?this.state.source(this.state.prevToken):i.default.reject(new Error("No previous page"))}}]),e}();n.Paginator=a},{"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],14:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/core-js/map")),o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(t,n){(0,o.default)(this,e),this.session=n,this.consumptionHorizonReports=new i.default,this.consumptionHorizonUpdateTimer=null}return(0,s.default)(e,[{key:"getReportInterval",value:function(){return this.session.getConsumptionReportInterval().then(function(e){return 1e3*e.seconds})}},{key:"delayedSendConsumptionHorizon",value:function(e){var t=this;null===this.consumptionHorizonUpdateTimer&&(this.consumptionHorizonUpdateTimer=setTimeout(function(){var e=[];t.consumptionHorizonReports.forEach(function(t){return e.push(t)}),e.length>0&&t.session.addCommand("consumptionReport",{report:e}),t.consumptionHorizonUpdateTimer=null,t.consumptionHorizonReports.clear()},e))}},{key:"updateLastConsumedMessageIndexForChannel",value:function(e,t){var n=this;this.consumptionHorizonReports.set(e,{channelSid:e,messageIdx:t}),this.getReportInterval().then(function(e){return n.delayedSendConsumptionHorizon(e)})}},{key:"advanceLastConsumedMessageIndexForChannel",value:function(e,t){var n=this,r=this.consumptionHorizonReports.get(e);r&&r.messageIdx>=t||(this.consumptionHorizonReports.set(e,{channelSid:e,messageIdx:t}),this.getReportInterval().then(function(e){return n.delayedSendConsumptionHorizon(e)}))}}]),e}();n.ConsumptionHorizon=a},{"babel-runtime/core-js/map":26,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/regenerator")),o=r(e("babel-runtime/helpers/slicedToArray")),s=r(e("babel-runtime/core-js/get-iterator")),a=r(e("babel-runtime/core-js/number/is-integer")),u=r(e("babel-runtime/core-js/map")),c=r(e("babel-runtime/helpers/classCallCheck")),l=r(e("babel-runtime/helpers/createClass")),f=r(e("babel-runtime/core-js/promise")),h=function(e,t,n,r){return new(n||(n=f.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var d=function(){function e(t,n,r){(0,c.default)(this,e),this.config=t,this.session=n,this.transport=r,this.cache=new u.default,this.cacheLifetime=(0,a.default)(t.httpCacheLifetimeOverride)?t.httpCacheLifetimeOverride:t.httpCacheLifetimeDefault}return(0,l.default)(e,[{key:"isExpired",value:function(e){return!this.cacheLifetime||Date.now()-e>this.cacheLifetime}},{key:"cleanupCache",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=(0,s.default)(this.cache);!(e=(r=i.next()).done);e=!0){var a=(0,o.default)(r.value,2),u=a[0],c=a[1];this.isExpired(c.timestamp)&&this.cache.delete(u)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}0===this.cache.size&&clearTimeout(this.timer)}},{key:"pokeTimer",value:function(){var e=this;this.timer=this.timer||setInterval(function(){return e.cleanupCache()},2*this.cacheLifetime)}},{key:"get",value:function(e){return h(this,void 0,void 0,i.default.mark(function t(){var n,r,o;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=this.cache.get(e))||this.isExpired(n.timestamp)){t.next=3;break}return t.abrupt("return",n.response);case 3:return r={"X-Twilio-Token":this.config.token},t.next=6,this.transport.get(e,r);case 6:return o=t.sent,this.cache.set(e,{response:o,timestamp:Date.now()}),this.pokeTimer(),t.abrupt("return",o);case 10:case"end":return t.stop()}},t,this)}))}}]),e}();n.Network=d},{"babel-runtime/core-js/get-iterator":23,"babel-runtime/core-js/map":26,"babel-runtime/core-js/number/is-integer":27,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/slicedToArray":46,"babel-runtime/regenerator":48}],16:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/core-js/promise")),o=r(e("babel-runtime/core-js/map")),s=r(e("babel-runtime/helpers/classCallCheck")),a=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var u=e("../logger").Logger.scope("TypingIndicator"),c=function(){function e(t,n,r,i){(0,s.default)(this,e),this.config=t,this.transport=n,this.notifications=r,this.getChannel=i,this.serviceTypingTimeout=null,this.sentUpdates=new o.default}return(0,a.default)(e,[{key:"initialize",value:function(){var e=this;this.notifications.subscribe("twilio.ipmsg.typing_indicator","twilsock"),this.notifications.on("message",function(t,n){"twilio.ipmsg.typing_indicator"===t&&e.handleRemoteTyping(n)})}},{key:"handleRemoteTyping",value:function(e){var t=this;u.trace("Got new typing indicator ",e),this.getChannel(e.channel_sid).then(function(n){n&&n.members.forEach(function(n){n.identity===e.identity&&n._startTyping(t.typingTimeout)})}).catch(function(e){throw u.error(e),e})}},{key:"send",value:function(e){var t=this.sentUpdates.get(e);return t&&t>Date.now()-this.typingTimeout?i.default.resolve():(this.sentUpdates.set(e,Date.now()),this._send(e))}},{key:"_send",value:function(e){var t=this;u.trace("Sending typing indicator");var n=this.config.typingIndicatorUri,r={"X-Twilio-Token":this.config.token,"Content-Type":"application/x-www-form-urlencoded"},i="ChannelSid="+e;return this.transport.post(n,r,i).then(function(e){e.body.hasOwnProperty("typing_timeout")&&(t.serviceTypingTimeout=1e3*e.body.typing_timeout)}).catch(function(e){throw u.error("Failed to send typing indicator:",e),e})}},{key:"typingTimeout",get:function(){return this.config.typingIndicatorTimeoutOverride||this.serviceTypingTimeout||this.config.typingIndicatorTimeoutDefault}}]),e}();n.TypingIndicator=c},{"../logger":10,"babel-runtime/core-js/map":26,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],17:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return!t.some(function(t){return!e.hasOwnProperty(t)})}var o=r(e("babel-runtime/regenerator")),s=r(e("babel-runtime/helpers/extends")),a=r(e("babel-runtime/core-js/map")),u=r(e("babel-runtime/helpers/createClass")),c=r(e("babel-runtime/helpers/classCallCheck")),l=r(e("babel-runtime/core-js/promise")),f=function(e,t,n,r){return new(n||(n=l.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var h=e("uuid"),d=e("platform"),p=e("durational"),m=e("./logger"),v=e("./sessionerror"),b=e("./util/deferred"),y=e("./../package.json").version,_=m.Logger.scope("Session"),g=function e(){(0,c.default)(this,e)},k=function(){function e(t,n,r){(0,c.default)(this,e);var i="undefined"!=typeof navigator?d.parse(navigator.userAgent):d;this.datasync=t,this.transport=n,this.config=r,this.sessionInfo=new b.Deferred,this.currentContext={},this.token=null,this.tokenSynced=!0,this.pendingCommands=new a.default,this.sessionStreamPromise=null,this.endpointPlatform=["js",y,i.os,i.name,i.version].join("|")}return(0,u.default)(e,[{key:"handleContextUpdate",value:function(e){_.info("Session context updated"),_.debug("new session context:",e),this.currentContext=e,i(e,["identity","userInfo","links","myChannels","channels"])&&(_.info("new session context accepted"),this.sessionInfo.set(e))}},{key:"initialize",value:function(e){var t=this;this.token=e,this.tokenSynced=!1;var n={type:"IpMsgSession",apiVersion:"3",endpointPlatform:this.endpointPlatform,token:e};return this.sessionStreamPromise=this.datasync.list({purpose:"com.twilio.rtd.ipmsg",context:n}).then(function(e){return _.info("Session created",e.sid),t.tokenSynced=!0,e.on("itemAdded",function(e){return t.processCommandResponse(e)}),e.on("itemUpdated",function(e){return t.processCommandResponse(e)}),e.on("contextUpdatedRemotely",function(e){return t.handleContextUpdate(e)}),e}).catch(function(e){throw _.error("Failed to create session",e),e}),this.sessionStreamPromise}},{key:"addCommand",value:function(e,t){return this.processCommand(e,t)}},{key:"processCommand",value:function(e,t){var n=this,r=new g;return r.request=t,r.request.action=e,r.commandId=h.v4(),_.info("Adding command: ",e,r.commandId),_.debug("command arguments:",t),new l.default(function(e,t){n.sessionStreamPromise.then(function(i){return n.pendingCommands.set(r.commandId,{resolve:e,reject:t,commandId:r.commandId,request:r.request}),i.push(r)}).then(function(){return _.debug("Command accepted by server",r.commandId)}).catch(function(e){n.pendingCommands.delete(r.commandId),_.error("Failed to add a command to the session",e),t(new Error("Can't add command: "+e.description))})})}},{key:"processCommandResponse",value:function(e){if(e.value.hasOwnProperty("response")&&e.value.hasOwnProperty("commandId")&&this.pendingCommands.has(e.value.commandId)){var t=e.value,n=e.value.commandId;if(200===t.response.status){_.debug("Command succeeded: ",t);var r=this.pendingCommands.get(n).resolve;this.pendingCommands.delete(n),r(t.response)}else{_.error("Command failed: ",t);var i=this.pendingCommands.get(n).reject;this.pendingCommands.delete(n),i(new v.SessionError(t.response.statusText,t.response.status))}}}},{key:"updateToken",value:function(e){return this.token=e,this.tokenSynced=!1,this.syncToken()}},{key:"syncToken",value:function(){return f(this,void 0,void 0,o.default.mark(function e(){var t,n,r,i;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.tokenSynced){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.getSessionContext();case 5:return t=e.sent,e.next=8,this.sessionStreamPromise;case 8:return n=e.sent,e.next=11,n.updateContext((0,s.default)(t,{token:this.token}));case 11:this.tokenSynced=!0,e.next=20;break;case 14:throw e.prev=14,e.t0=e.catch(2),r="Couldn't update the token in session context",i=400,_.error(r,e.t0),new v.SessionError(r,i);case 20:case"end":return e.stop()}},e,this,[[2,14]])}))}},{key:"getSessionContext",value:function(){return this.sessionStreamPromise.then(function(e){return e.getContext()})}},{key:"getSessionLinks",value:function(){return f(this,void 0,void 0,o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",{publicChannelsUrl:this.config.baseUrl+t.links.publicChannelsUrl,myChannelsUrl:this.config.baseUrl+t.links.myChannelsUrl,typingUrl:this.config.baseUrl+t.links.typingUrl});case 4:case"end":return e.stop()}},e,this)}))}},{key:"getChannelsId",value:function(){return f(this,void 0,void 0,o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",t.channels);case 4:case"end":return e.stop()}},e,this)}))}},{key:"getMyChannelsId",value:function(){return f(this,void 0,void 0,o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",t.myChannels);case 4:case"end":return e.stop()}},e,this)}))}},{key:"getUserInfosData",value:function(){return this.sessionInfo.promise.then(function(e){return{userInfo:e.userInfo,identity:e.identity}})}},{key:"getConsumptionReportInterval",value:function(){return f(this,void 0,void 0,o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionContext();case 2:return t=e.sent,e.abrupt("return",p.fromString(this.config.consumptionReportIntervalOverride||t.consumptionReportInterval||this.config.consumptionReportIntervalDefault));case 4:case"end":return e.stop()}},e,this)}))}},{key:"identity",get:function(){return this.sessionInfo.current.identity}},{key:"reachabilityEnabled",get:function(){return this.currentContext.reachabilityEnabled}}]),e}();n.Session=k},{"./../package.json":262,"./logger":10,"./sessionerror":18,"./util/deferred":20,"babel-runtime/core-js/map":26,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/extends":43,"babel-runtime/regenerator":48,durational:192,platform:200,uuid:254}],18:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/core-js/object/get-prototype-of")),o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/possibleConstructorReturn")),a=r(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{value:!0});var u=function(e){function t(e,n){(0,o.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return r.name=r.constructor.name,r.message=e,r.code=n,Error.captureStackTrace?Error.captureStackTrace(r,r.constructor):r.stack=(new Error).stack,r}return(0,a.default)(t,e),t}(Error);n.SessionError=u},{"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45}],19:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/core-js/json/stringify")),o=r(e("babel-runtime/regenerator")),s=r(e("babel-runtime/core-js/object/get-prototype-of")),a=r(e("babel-runtime/helpers/classCallCheck")),u=r(e("babel-runtime/helpers/createClass")),c=r(e("babel-runtime/helpers/possibleConstructorReturn")),l=r(e("babel-runtime/helpers/inherits")),f=r(e("babel-runtime/core-js/promise")),h=function(e,t,n,r){return new(n||(n=f.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var d=e("events"),p=e("./logger").Logger.scope("UserInfo"),m=function(e){function t(e,n,r,i){(0,a.default)(this,t);var o=(0,c.default)(this,(t.__proto__||(0,s.default)(t)).call(this));return o.setMaxListeners(0),o.sync=r,o.session=i,o.state={identity:e,entityName:n,friendlyName:null,attributes:{},online:null,notifiable:null},o}return(0,l.default)(t,e),(0,u.default)(t,[{key:"_update",value:function(e,t){switch(p.debug("UserInfo for",this.state.identity,"updated:",e,t),e){case"friendlyName":this.state.friendlyName=t.value;break;case"attributes":try{this.state.attributes=JSON.parse(t.value)}catch(e){this.state.attributes={}}break;case"reachability":this.state.online=t.online,this.state.notifiable=t.notifiable;break;default:return}this.emit("updated",e)}},{key:"_updateReachabilityInfo",value:function(e,t){var n=this;return this.session.reachabilityEnabled?e.get("reachability").then(t).catch(function(e){p.warn("Failed to get reachability info for ",n.state.identity,e)}):f.default.resolve()}},{key:"_fetch",value:function(){return h(this,void 0,void 0,o.default.mark(function e(){var t,n=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.entityName){e.next=2;break}return e.abrupt("return",this);case 2:return t=function(e){return n._update(e.key,e.value)},this.promiseToFetch=this.sync.map({uniqueName:this.state.entityName,mode:"open",optimistic:!0}).then(function(e){return e.on("itemUpdated",t),f.default.all([e.get("friendlyName").then(t),e.get("attributes").then(t),n._updateReachabilityInfo(e,t)])}).then(function(){return p.debug("Fetched for",n.identity),n}).catch(function(e){throw n.promiseToFetch=null,e}),e.abrupt("return",this.promiseToFetch);case 5:case"end":return e.stop()}},e,this)}))}},{key:"_ensureFetched",value:function(){return this.promiseToFetch||this._fetch()}},{key:"updateAttributes",value:function(e){return h(this,void 0,void 0,o.default.mark(function t(){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&e.constructor===Object){t.next=2;break}throw new Error("Attributes must be an object.");case 2:return t.next=4,this.session.addCommand("editUserAttributes",{username:this.state.identity,attributes:(0,i.default)(e)});case 4:return t.abrupt("return",this);case 5:case"end":return t.stop()}},t,this)}))}},{key:"updateFriendlyName",value:function(e){return h(this,void 0,void 0,o.default.mark(function t(){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e||"string"==typeof e){t.next=2;break}throw new Error("friendlyName must be string or empty.");case 2:return t.next=4,this.session.addCommand("editUserFriendlyName",{username:this.state.identity,friendlyName:e});case 4:return t.abrupt("return",this);case 5:case"end":return t.stop()}},t,this)}))}},{key:"identity",get:function(){return this.state.identity},set:function(e){this.state.identity=e}},{key:"entityName",set:function(e){this.state.entityName=e}},{key:"attributes",get:function(){return this.state.attributes}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"online",get:function(){return this.state.online}},{key:"notifiable",get:function(){return this.state.notifiable}}]),t}(d.EventEmitter);n.UserInfo=m},{"./logger":10,"babel-runtime/core-js/json/stringify":25,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,"babel-runtime/regenerator":48,events:194}],20:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/core-js/promise")),o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(){var t=this;(0,o.default)(this,e),this._promise=new i.default(function(e,n){t._resolve=e,t._reject=n})}return(0,s.default)(e,[{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}},{key:"promise",get:function(){return this._promise}}]),e}();n.Deferred=a},{"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],21:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return 0===c.createPatch(e,t).length}function o(e){return JSON.parse((0,u.default)(e))}var s=r(e("babel-runtime/helpers/classCallCheck")),a=r(e("babel-runtime/helpers/createClass")),u=r(e("babel-runtime/core-js/json/stringify"));Object.defineProperty(n,"__esModule",{value:!0});var c=e("rfc6902");n.isDeepEqual=i,n.deepClone=o;var l=function(){function e(t){(0,s.default)(this,e),this.base=t.replace(/\/$/,""),this.args=new Array,this.paths=new Array}return(0,a.default)(e,[{key:"arg",value:function(e,t){return void 0!==t&&this.args.push(e+"="+t),this}},{key:"path",value:function(e){return this.paths.push(e),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();n.UriBuilder=l},{"babel-runtime/core-js/json/stringify":25,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,rfc6902:207}],22:[function(e,t,n){t.exports={default:e("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":63}],23:[function(e,t,n){t.exports={default:e("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":64}],24:[function(e,t,n){t.exports={default:e("core-js/library/fn/is-iterable"),__esModule:!0}},{"core-js/library/fn/is-iterable":65}],25:[function(e,t,n){t.exports={default:e("core-js/library/fn/json/stringify"),__esModule:!0}},{"core-js/library/fn/json/stringify":66}],26:[function(e,t,n){t.exports={default:e("core-js/library/fn/map"),__esModule:!0}},{"core-js/library/fn/map":67}],27:[function(e,t,n){t.exports={default:e("core-js/library/fn/number/is-integer"),__esModule:!0}},{"core-js/library/fn/number/is-integer":68}],28:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":69}],29:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":70}],30:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/define-properties"),__esModule:!0}},{"core-js/library/fn/object/define-properties":71}],31:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":72}],32:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/freeze"),__esModule:!0}},{"core-js/library/fn/object/freeze":73}],33:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/get-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/get-prototype-of":74}],34:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/keys"),__esModule:!0}},{"core-js/library/fn/object/keys":75}],35:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/set-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/set-prototype-of":76}],36:[function(e,t,n){t.exports={default:e("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":77}],37:[function(e,t,n){t.exports={default:e("core-js/library/fn/reflect/construct"),__esModule:!0}},{"core-js/library/fn/reflect/construct":78}],38:[function(e,t,n){t.exports={default:e("core-js/library/fn/set"),__esModule:!0}},{"core-js/library/fn/set":79}],39:[function(e,t,n){t.exports={default:e("core-js/library/fn/symbol"),__esModule:!0}},{"core-js/library/fn/symbol":80}],40:[function(e,t,n){t.exports={default:e("core-js/library/fn/symbol/iterator"),__esModule:!0}},{"core-js/library/fn/symbol/iterator":81}],41:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],42:[function(e,t,n){"use strict";n.__esModule=!0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("../core-js/object/define-property"));n.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,r.default)(e,i.key,i)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},{"../core-js/object/define-property":31}],43:[function(e,t,n){"use strict";n.__esModule=!0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("../core-js/object/assign"));n.default=r.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}},{"../core-js/object/assign":28}],44:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=r(e("../core-js/object/set-prototype-of")),o=r(e("../core-js/object/create")),s=r(e("../helpers/typeof"));n.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,s.default)(t)));e.prototype=(0,o.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(i.default?(0,i.default)(e,t):e.__proto__=t)}},{"../core-js/object/create":29,"../core-js/object/set-prototype-of":35,"../helpers/typeof":47}],45:[function(e,t,n){"use strict";n.__esModule=!0;var r=function(e){return e&&e.__esModule?e:{default:e}}(e("../helpers/typeof"));n.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,r.default)(t))&&"function"!=typeof t?e:t}},{"../helpers/typeof":47}],46:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=r(e("../core-js/is-iterable")),o=r(e("../core-js/get-iterator"));n.default=function(){function e(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var a,u=(0,o.default)(e);!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw s}}return n}return function(t,n){if(Array.isArray(t))return t;if((0,i.default)(Object(t)))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},{"../core-js/get-iterator":23,"../core-js/is-iterable":24}],47:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=r(e("../core-js/symbol/iterator")),o=r(e("../core-js/symbol")),s="function"==typeof o.default&&"symbol"==typeof i.default?function(e){return typeof e}:function(e){return e&&"function"==typeof o.default&&e.constructor===o.default&&e!==o.default.prototype?"symbol":typeof e};n.default="function"==typeof o.default&&"symbol"===s(i.default)?function(e){return void 0===e?"undefined":s(e)}:function(e){return e&&"function"==typeof o.default&&e.constructor===o.default&&e!==o.default.prototype?"symbol":void 0===e?"undefined":s(e)}},{"../core-js/symbol":39,"../core-js/symbol/iterator":40}],48:[function(e,t,n){t.exports=e("regenerator-runtime")},{"regenerator-runtime":205}],49:[function(e,t,n){var r=e("./lib/backoff"),i=e("./lib/strategy/exponential"),o=e("./lib/strategy/fibonacci"),s=e("./lib/function_call.js");t.exports.Backoff=r,t.exports.FunctionCall=s,t.exports.FibonacciStrategy=o,t.exports.ExponentialStrategy=i,t.exports.fibonacci=function(e){return new r(new o(e))},t.exports.exponential=function(e){return new r(new i(e))},t.exports.call=function(e,t,n){var r=Array.prototype.slice.call(arguments);return e=r[0],t=r.slice(1,r.length-1),n=r[r.length-1],new s(e,t,n)}},{"./lib/backoff":50,"./lib/function_call.js":51,"./lib/strategy/exponential":52,"./lib/strategy/fibonacci":53}],50:[function(e,t,n){function r(e){i.EventEmitter.call(this),this.backoffStrategy_=e,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}var i=e("events"),o=e("precond");e("util").inherits(r,i.EventEmitter),r.prototype.failAfter=function(e){o.checkArgument(e>0,"Expected a maximum number of retry greater than 0 but got %s.",e),this.maxNumberOfRetry_=e},r.prototype.backoff=function(e){o.checkState(-1===this.timeoutID_,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",e),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,e))},r.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},r.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},t.exports=r},{events:194,precond:201,util:253}],51:[function(e,t,n){function r(e,t,n){i.EventEmitter.call(this),o.checkIsFunction(e,"Expected fn to be a function."),o.checkIsArray(t,"Expected args to be an array."),o.checkIsFunction(n,"Expected callback to be a function."),this.function_=e,this.arguments_=t,this.callback_=n,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=r.DEFAULT_RETRY_PREDICATE_,this.state_=r.State_.PENDING}var i=e("events"),o=e("precond"),s=e("util"),a=e("./backoff"),u=e("./strategy/fibonacci");s.inherits(r,i.EventEmitter),r.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},r.DEFAULT_RETRY_PREDICATE_=function(e){return!0},r.prototype.isPending=function(){return this.state_==r.State_.PENDING},r.prototype.isRunning=function(){return this.state_==r.State_.RUNNING},r.prototype.isCompleted=function(){return this.state_==r.State_.COMPLETED},r.prototype.isAborted=function(){return this.state_==r.State_.ABORTED},r.prototype.setStrategy=function(e){return o.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=e,this},r.prototype.retryIf=function(e){return o.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=e,this},r.prototype.getLastResult=function(){return this.lastResult_.concat()},r.prototype.getNumRetries=function(){return this.numRetries_},r.prototype.failAfter=function(e){return o.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=e,this},r.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=r.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},r.prototype.start=function(e){o.checkState(!this.isAborted(),"FunctionCall is aborted."),o.checkState(this.isPending(),"FunctionCall already started.");var t=this.strategy_||new u;this.backoff_=e?e(t):new a(t),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=r.State_.RUNNING,this.doCall_(!1)},r.prototype.doCall_=function(e){e&&this.numRetries_++;var t=["call"].concat(this.arguments_);i.EventEmitter.prototype.emit.apply(this,t);var n=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(n))},r.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},r.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var e=Array.prototype.slice.call(arguments);this.lastResult_=e,i.EventEmitter.prototype.emit.apply(this,["callback"].concat(e));var t=e[0];t&&this.retryPredicate_(t)?this.backoff_.backoff(t):(this.state_=r.State_.COMPLETED,this.doCallback_())}},r.prototype.handleBackoff_=function(e,t,n){this.emit("backoff",e,t,n)},t.exports=r},{"./backoff":50,"./strategy/fibonacci":53,events:194,precond:201,util:253}],52:[function(e,t,n){function r(e){s.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=r.DEFAULT_FACTOR,e&&void 0!==e.factor&&(o.checkArgument(e.factor>1,"Exponential factor should be greater than 1 but got %s.",e.factor),this.factor_=e.factor)}var i=e("util"),o=e("precond"),s=e("./strategy");i.inherits(r,s),r.DEFAULT_FACTOR=2,r.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},r.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},t.exports=r},{"./strategy":54,precond:201,util:253}],53:[function(e,t,n){function r(e){o.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}var i=e("util"),o=e("./strategy");i.inherits(r,o),r.prototype.next_=function(){var e=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=e,e},r.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},t.exports=r},{"./strategy":54,util:253}],54:[function(e,t,n){function r(e){return void 0!==e&&null!==e}function i(e){if(e=e||{},r(e.initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(r(e.maxDelay)&&e.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=e.initialDelay||100,this.maxDelay_=e.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(r(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=e.randomisationFactor||0}e("events"),e("util"),i.prototype.getMaxDelay=function(){return this.maxDelay_},i.prototype.getInitialDelay=function(){return this.initialDelay_},i.prototype.next=function(){var e=this.next_(),t=1+Math.random()*this.randomisationFactor_;return Math.round(e*t)},i.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},i.prototype.reset=function(){this.reset_()},i.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},t.exports=i},{events:194,util:253}],55:[function(e,t,n){"use strict";function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function i(e){return 3*e.length/4-r(e)}function o(e){var t,n,i,o,s,a,u=e.length;s=r(e),a=new f(3*u/4-s),i=s>0?u-4:u;var c=0;for(t=0,n=0;t<i;t+=4,n+=3)o=l[e.charCodeAt(t)]<<18|l[e.charCodeAt(t+1)]<<12|l[e.charCodeAt(t+2)]<<6|l[e.charCodeAt(t+3)],a[c++]=o>>16&255,a[c++]=o>>8&255,a[c++]=255&o;return 2===s?(o=l[e.charCodeAt(t)]<<2|l[e.charCodeAt(t+1)]>>4,a[c++]=255&o):1===s&&(o=l[e.charCodeAt(t)]<<10|l[e.charCodeAt(t+1)]<<4|l[e.charCodeAt(t+2)]>>2,a[c++]=o>>8&255,a[c++]=255&o),a}function s(e){return c[e>>18&63]+c[e>>12&63]+c[e>>6&63]+c[63&e]}function a(e,t,n){for(var r,i=[],o=t;o<n;o+=3)r=(e[o]<<16)+(e[o+1]<<8)+e[o+2],i.push(s(r));return i.join("")}function u(e){for(var t,n=e.length,r=n%3,i="",o=[],s=0,u=n-r;s<u;s+=16383)o.push(a(e,s,s+16383>u?u:s+16383));return 1===r?(t=e[n-1],i+=c[t>>2],i+=c[t<<4&63],i+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],i+=c[t>>10],i+=c[t>>4&63],i+=c[t<<2&63],i+="="),o.push(i),o.join("")}n.byteLength=i,n.toByteArray=o,n.fromByteArray=u;for(var c=[],l=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0,p=h.length;d<p;++d)c[d]=h[d],l[h.charCodeAt(d)]=d;l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}],56:[function(e,t,n){(function(r,i){!function(e){if("object"==typeof n&&void 0!==t)t.exports=e();else{var r;"undefined"!=typeof window?r=window:void 0!==i?r=i:"undefined"!=typeof self&&(r=self),r.Promise=e()}}(function(){return function t(n,r,i){function o(a,u){if(!r[a]){if(!n[a]){var c="function"==typeof e&&e;if(!u&&c)return c(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=r[a]={exports:{}};n[a][0].call(f.exports,function(e){return o(n[a][1][e]||e)},f,f.exports,t,n,r,i)}return r[a].exports}for(var s="function"==typeof e&&e,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){"use strict";t.exports=function(e){function t(e){var t=new n(e),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}var n=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t,n){"use strict";function i(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new l(16),this._normalQueue=new l(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=c}function o(e,t,n){this._lateQueue.push(e,t,n),this._queueTick()}function s(e,t,n){this._normalQueue.push(e,t,n),this._queueTick()}function a(e){this._normalQueue._pushOne(e),this._queueTick()}var u;try{throw new Error}catch(e){u=e}var c=e("./schedule"),l=e("./queue"),f=e("./util");i.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},i.prototype.hasCustomScheduler=function(){return this._customScheduler},i.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},i.prototype.disableTrampolineIfNecessary=function(){f.hasDevTools&&(this._trampolineEnabled=!1)},i.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},i.prototype.fatalError=function(e,t){t?(r.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),r.exit(2)):this.throwLater(e)},i.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},f.hasDevTools?(i.prototype.invokeLater=function(e,t,n){this._trampolineEnabled?o.call(this,e,t,n):this._schedule(function(){setTimeout(function(){e.call(t,n)},100)})},i.prototype.invoke=function(e,t,n){this._trampolineEnabled?s.call(this,e,t,n):this._schedule(function(){e.call(t,n)})},i.prototype.settlePromises=function(e){this._trampolineEnabled?a.call(this,e):this._schedule(function(){e._settlePromises()})}):(i.prototype.invokeLater=o,i.prototype.invoke=s,i.prototype.settlePromises=a),i.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var n=e.shift(),r=e.shift();t.call(n,r)}else t._settlePromises()}},i.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},i.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},i.prototype._reset=function(){this._isTickUsed=!1},t.exports=i,t.exports.firstLineError=u},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t,n){"use strict";t.exports=function(e,t,n,r){var i=!1,o=function(e,t){this._reject(t)},s=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(o,o,null,this,e)},a=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},u=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(o){i||(i=!0,e.prototype._propagateFrom=r.propagateFromFunction(),e.prototype._boundValue=r.boundValueFunction());var c=n(o),l=new e(t);l._propagateFrom(this,1);var f=this._target();if(l._setBoundTo(c),c instanceof e){var h={promiseRejectionQueued:!1,promise:l,target:f,bindingPromise:c};f._then(t,s,void 0,l,h),c._then(a,u,void 0,l,h),l._setOnCancel(c)}else l._resolveCallback(f);return l},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,n){return e.resolve(n).bind(t)}}},{}],4:[function(e,t,n){"use strict";function r(){try{Promise===o&&(Promise=i)}catch(e){}return o}var i;"undefined"!=typeof Promise&&(i=Promise);var o=e("./promise")();o.noConflict=r,t.exports=o},{"./promise":22}],5:[function(e,t,n){"use strict";var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}t.exports=function(t){function n(e,n){var r;if(null!=e&&(r=e[n]),"function"!=typeof r){var i="Object "+s.classString(e)+" has no method '"+s.toString(n)+"'";throw new t.TypeError(i)}return r}function r(e){return n(e,this.pop()).apply(e,this)}function i(e){return e[this]}function o(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}var s=e("./util"),a=s.canEvaluate;s.isIdentifier,t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(r,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t;if("number"==typeof e)t=o;else if(a){var n=(void 0)(e);t=null!==n?n:i}else t=i;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){var o=e("./util"),s=o.tryCatch,a=o.errorObj,u=t._async;t.prototype.break=t.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var n=e._cancellationParent;if(null==n||!n._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=n}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),u.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(e,t){if(o.isArray(e))for(var n=0;n<e.length;++n)this._doInvokeOnCancel(e[n],t);else if(void 0!==e)if("function"==typeof e){if(!t){var r=s(e).call(this._boundValue());r===a&&(this._attachExtraTrace(r.e),u.throwLater(r.e))}}else e._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),u.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,n){"use strict";t.exports=function(t){function n(e,n,a){return function(u){var c=a._boundValue();e:for(var l=0;l<e.length;++l){var f=e[l];if(f===Error||null!=f&&f.prototype instanceof Error){if(u instanceof f)return o(n).call(c,u)}else if("function"==typeof f){var h=o(f).call(c,u);if(h===s)return h;if(h)return o(n).call(c,u)}else if(r.isObject(u)){for(var d=i(f),p=0;p<d.length;++p){var m=d[p];if(f[m]!=u[m])continue e}return o(n).call(c,u)}}return t}}var r=e("./util"),i=e("./es5").keys,o=r.tryCatch,s=r.errorObj;return n}},{"./es5":13,"./util":36}],8:[function(e,t,n){"use strict";t.exports=function(e){function t(){this._trace=new t.CapturedTrace(r())}function n(){if(i)return new t}function r(){var e=o.length-1;if(e>=0)return o[e]}var i=!1,o=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=o.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=n,t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var n=e.prototype._pushContext,o=e.prototype._popContext,s=e._peekContext,a=e.prototype._peekContext,u=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=n,e.prototype._popContext=o,e._peekContext=s,e.prototype._peekContext=a,e.prototype._promiseCreated=u,i=!1},i=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=r,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t}},{}],9:[function(e,t,n){"use strict";t.exports=function(t,n){function i(e,t){return{promise:t}}function o(){return!1}function s(e,t,n){var r=this;try{e(t,n,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+D.toString(e));r._attachCancellationCallback(e)})}catch(e){return e}}function a(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?D.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function u(){return this._onCancelField}function c(e){this._onCancelField=e}function l(){this._cancellationParent=void 0,this._onCancelField=void 0}function f(e,t){if(0!=(1&t)){this._cancellationParent=e;var n=e._branchesRemainingToCancel;void 0===n&&(n=0),e._branchesRemainingToCancel=n+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function h(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function d(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function p(){this._trace=new P(this._peekContext())}function m(e,t){if(B(e)){var n=this._trace;if(void 0!==n&&t&&(n=n._parent),void 0!==n)n.attachExtraTrace(e);else if(!e.__stackCleaned__){var r=x(e);D.notEnumerableProp(e,"stack",r.message+"\n"+r.stack.join("\n")),D.notEnumerableProp(e,"__stackCleaned__",!0)}}}function v(e,t,n,r,i){if(void 0===e&&null!==t&&Q){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="",s="";if(t._trace){for(var a=t._trace.stack.split("\n"),u=w(a),c=u.length-1;c>=0;--c){var l=u[c];if(!z.test(l)){var f=l.match(H);f&&(o="at "+f[1]+":"+f[2]+":"+f[3]+" ");break}}if(u.length>0)for(var h=u[0],c=0;c<a.length;++c)if(a[c]===h){c>0&&(s="\n"+a[c-1]);break}}var d="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+s;r._warn(d,!0,t)}}function b(e,t){var n=e+" is deprecated and will be removed in a future version.";return t&&(n+=" Use "+t+" instead."),y(n)}function y(e,n,r){if(se.warnings){var i,o=new L(e);if(n)r._attachExtraTrace(o);else if(se.longStackTraces&&(i=t._peekContext()))i.attachExtraTrace(o);else{var s=x(o);o.stack=s.message+"\n"+s.stack.join("\n")}te("warning",o)||j(o,"",!0)}}function _(e,t){for(var n=0;n<t.length-1;++n)t[n].push("From previous event:"),t[n]=t[n].join("\n");return n<t.length&&(t[n]=t[n].join("\n")),e+"\n"+t.join("\n")}function g(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function k(e){for(var t=e[0],n=1;n<e.length;++n){for(var r=e[n],i=t.length-1,o=t[i],s=-1,a=r.length-1;a>=0;--a)if(r[a]===o){s=a;break}for(a=s;a>=0;--a){var u=r[a];if(t[i]!==u)break;t.pop(),i--}t=r}}function w(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],i="    (No stack trace)"===r||W.test(r),o=i&&re(r);i&&!o&&(G&&" "!==r.charAt(0)&&(r="    "+r),t.push(r))}return t}function C(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),n=0;n<t.length;++n){var r=t[n];if("    (No stack trace)"===r||W.test(r))break}return n>0&&"SyntaxError"!=e.name&&(t=t.slice(n)),t}function x(e){var t=e.stack,n=e.toString();return t="string"==typeof t&&t.length>0?C(e):["    (No stack trace)"],{message:n,stack:"SyntaxError"==e.name?t:w(t)}}function j(e,t,n){if("undefined"!=typeof console){var r;if(D.isObject(e)){var i=e.stack;r=t+V(i,e)}else r=t+String(e);"function"==typeof F?F(r,n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(r)}}function E(e,t,n,r){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(r):t(n,r))}catch(e){U.throwLater(e)}"unhandledRejection"===e?te(e,n,r)||i||j(n,"Unhandled rejection "):te(e,r)}function S(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{if(t=e&&"function"==typeof e.toString?e.toString():D.toString(e),/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+T(t)+">, no stack trace)"}function T(e){return e.length<41?e:e.substr(0,38)+"..."}function R(){return"function"==typeof oe}function I(e){var t=e.match(ie);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function A(e,t){if(R()){for(var n,r,i=e.stack.split("\n"),o=t.stack.split("\n"),s=-1,a=-1,u=0;u<i.length;++u)if(c=I(i[u])){n=c.fileName,s=c.line;break}for(u=0;u<o.length;++u){var c=I(o[u]);if(c){r=c.fileName,a=c.line;break}}s<0||a<0||!n||!r||n!==r||s>=a||(re=function(e){if(q.test(e))return!0;var t=I(e);return!!(t&&t.fileName===n&&s<=t.line&&t.line<=a)})}}function P(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);oe(this,P),t>32&&this.uncycle()}var O,M,F,N=t._getDomain,U=t._async,L=e("./errors").Warning,D=e("./util"),B=D.canAttachTrace,q=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,z=/\((?:timers\.js):\d+:\d+\)/,H=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,W=null,V=null,G=!1,J=!(0==D.env("BLUEBIRD_DEBUG")),$=!(0==D.env("BLUEBIRD_WARNINGS")||!J&&!D.env("BLUEBIRD_WARNINGS")),K=!(0==D.env("BLUEBIRD_LONG_STACK_TRACES")||!J&&!D.env("BLUEBIRD_LONG_STACK_TRACES")),Q=0!=D.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&($||!!D.env("BLUEBIRD_W_FORGOTTEN_RETURN"));t.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},t.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),U.invokeLater(this._notifyUnhandledRejection,this,void 0))},t.prototype._notifyUnhandledRejectionIsHandled=function(){E("rejectionHandled",O,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),E("unhandledRejection",M,e,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(e,t,n){return y(e,t,n||this)},t.onPossiblyUnhandledRejection=function(e){var t=N();M="function"==typeof e?null===t?e:D.domainBind(t,e):void 0},t.onUnhandledRejectionHandled=function(e){var t=N();O="function"==typeof e?null===t?e:D.domainBind(t,e):void 0};var X=function(){};t.longStackTraces=function(){if(U.haveItemsQueued()&&!se.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!se.longStackTraces&&R()){var e=t.prototype._captureStackTrace,r=t.prototype._attachExtraTrace;se.longStackTraces=!0,X=function(){if(U.haveItemsQueued()&&!se.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=r,n.deactivateLongStackTraces(),U.enableTrampoline(),se.longStackTraces=!1},t.prototype._captureStackTrace=p,t.prototype._attachExtraTrace=m,n.activateLongStackTraces(),U.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return se.longStackTraces&&R()};var Y=function(){try{if("function"==typeof CustomEvent){e=new CustomEvent("CustomEvent");return D.global.dispatchEvent(e),function(e,t){var n=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!D.global.dispatchEvent(n)}}if("function"==typeof Event){var e=new Event("CustomEvent");return D.global.dispatchEvent(e),function(e,t){var n=new Event(e.toLowerCase(),{cancelable:!0});return n.detail=t,!D.global.dispatchEvent(n)}}return(e=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),D.global.dispatchEvent(e),function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e.toLowerCase(),!1,!0,t),!D.global.dispatchEvent(n)}}catch(e){}return function(){return!1}}(),Z=function(){return D.isNode?function(){return r.emit.apply(r,arguments)}:D.global?function(e){var t="on"+e.toLowerCase(),n=D.global[t];return!!n&&(n.apply(D.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),ee={promiseCreated:i,promiseFulfilled:i,promiseRejected:i,promiseResolved:i,promiseCancelled:i,promiseChained:function(e,t,n){return{promise:t,child:n}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,n){return{reason:t,promise:n}},rejectionHandled:i},te=function(e){var t=!1;try{t=Z.apply(null,arguments)}catch(e){U.throwLater(e),t=!0}var n=!1;try{n=Y(e,ee[e].apply(null,arguments))}catch(e){U.throwLater(e),n=!0}return n||t};t.config=function(e){if("longStackTraces"in(e=Object(e))&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&X()),"warnings"in e){var n=e.warnings;se.warnings=!!n,Q=se.warnings,D.isObject(n)&&"wForgottenReturn"in n&&(Q=!!n.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!se.cancellation){if(U.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=l,t.prototype._propagateFrom=f,t.prototype._onCancel=u,t.prototype._setOnCancel=c,t.prototype._attachCancellationCallback=a,t.prototype._execute=s,ne=f,se.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!se.monitoring?(se.monitoring=!0,t.prototype._fireEvent=te):!e.monitoring&&se.monitoring&&(se.monitoring=!1,t.prototype._fireEvent=o)),t},t.prototype._fireEvent=o,t.prototype._execute=function(e,t,n){try{e(t,n)}catch(e){return e}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(e){},t.prototype._attachCancellationCallback=function(e){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(e,t){};var ne=h,re=function(){return!1},ie=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;D.inherits(P,Error),n.CapturedTrace=P,P.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],n={},r=0,i=this;void 0!==i;++r)t.push(i),i=i._parent;for(r=(e=this._length=r)-1;r>=0;--r){var o=t[r].stack;void 0===n[o]&&(n[o]=r)}for(r=0;r<e;++r){var s=n[t[r].stack];if(void 0!==s&&s!==r){s>0&&(t[s-1]._parent=void 0,t[s-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var a=r>0?t[r-1]:this;s<e-1?(a._parent=t[s+1],a._parent.uncycle(),a._length=a._parent._length+1):(a._parent=void 0,a._length=1);for(var u=a._length+1,c=r-2;c>=0;--c)t[c]._length=u,u++;return}}}},P.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=x(e),n=t.message,r=[t.stack],i=this;void 0!==i;)r.push(w(i.stack.split("\n"))),i=i._parent;k(r),g(r),D.notEnumerableProp(e,"stack",_(n,r)),D.notEnumerableProp(e,"__stackCleaned__",!0)}};var oe=function(){var e=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():S(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,W=/^\s*at\s*/,V=e;var t=Error.captureStackTrace;return re=function(e){return q.test(e)},function(e,n){Error.stackTraceLimit+=6,t(e,n),Error.stackTraceLimit-=6}}var n=new Error;if("string"==typeof n.stack&&n.stack.split("\n")[0].indexOf("stackDetection@")>=0)return W=/@/,V=e,G=!0,function(e){e.stack=(new Error).stack};var r;try{throw new Error}catch(e){r="stack"in e}return"stack"in n||!r||"number"!=typeof Error.stackTraceLimit?(V=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?S(t):t.toString()},null):(W=/^\s*at\s*/,V=e,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(F=function(e){console.warn(e)},D.isNode&&r.stderr.isTTY?F=function(e,t){var n=t?"[33m":"[31m";console.warn(n+e+"[0m\n")}:D.isNode||"string"!=typeof(new Error).stack||(F=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var se={warnings:$,longStackTraces:!1,cancellation:!1,monitoring:!1};return K&&t.longStackTraces(),{longStackTraces:function(){return se.longStackTraces},warnings:function(){return se.warnings},cancellation:function(){return se.cancellation},monitoring:function(){return se.monitoring},propagateFromFunction:function(){return ne},boundValueFunction:function(){return d},checkForgottenReturns:v,setBounds:A,warn:y,deprecated:b,CapturedTrace:P,fireDomEvent:Y,fireGlobalEvent:Z}}},{"./errors":12,"./util":36}],10:[function(e,t,n){"use strict";t.exports=function(e){function t(){return this.value}function n(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(n){return n instanceof e&&n.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:n},void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return this._then(n,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:e},void 0);var t=arguments[1],r=function(){throw t};return this.caught(e,r)},e.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof e&&n.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:n},void 0);var r=arguments[1];r instanceof e&&r.suppressUnhandledRejections();var i=function(){return r};return this.caught(n,i)}}},{}],11:[function(e,t,n){"use strict";t.exports=function(e,t){function n(){return o(this)}function r(e,n){return i(e,n,t,t)}var i=e.reduce,o=e.all;e.prototype.each=function(e){return i(this,e,t,0)._then(n,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return i(this,e,t,t)},e.each=function(e,r){return i(e,r,t,0)._then(n,void 0,void 0,e,void 0)},e.mapSeries=r}},{}],12:[function(e,t,n){"use strict";function r(e,t){function n(r){if(!(this instanceof n))return new n(r);f(this,"message","string"==typeof r?r:t),f(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return l(n,Error),n}function i(e){if(!(this instanceof i))return new i(e);f(this,"name","OperationalError"),f(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(f(this,"message",e.message),f(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var o,s,a=e("./es5"),u=a.freeze,c=e("./util"),l=c.inherits,f=c.notEnumerableProp,h=r("Warning","warning"),d=r("CancellationError","cancellation error"),p=r("TimeoutError","timeout error"),m=r("AggregateError","aggregate error");try{o=TypeError,s=RangeError}catch(e){o=r("TypeError","type error"),s=r("RangeError","range error")}for(var v="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),b=0;b<v.length;++b)"function"==typeof Array.prototype[v[b]]&&(m.prototype[v[b]]=Array.prototype[v[b]]);a.defineProperty(m.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),m.prototype.isOperational=!0;var y=0;m.prototype.toString=function(){var e=Array(4*y+1).join(" "),t="\n"+e+"AggregateError of:\n";y++,e=Array(4*y+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];t+=(r=i.join("\n"))+"\n"}return y--,t},l(i,Error);var _=Error.__BluebirdErrorTypes__;_||(_=u({CancellationError:d,TimeoutError:p,OperationalError:i,RejectionError:i,AggregateError:m}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:_,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:o,RangeError:s,CancellationError:_.CancellationError,OperationalError:_.OperationalError,TimeoutError:_.TimeoutError,AggregateError:_.AggregateError,Warning:h}},{"./es5":13,"./util":36}],13:[function(e,t,n){var r=function(){"use strict";return void 0===this}();if(r)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,o={}.toString,s={}.constructor.prototype,a=function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(n);return t},u=function(e,t){return{value:e[t]}},c=function(e,t,n){return e[t]=n.value,e},l=function(e){return e},f=function(e){try{return Object(e).constructor.prototype}catch(e){return s}},h=function(e){try{return"[object Array]"===o.call(e)}catch(e){return!1}};t.exports={isArray:h,keys:a,names:a,defineProperty:c,getDescriptor:u,freeze:l,getPrototypeOf:f,isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t,n){"use strict";t.exports=function(e,t){var n=e.map;e.prototype.filter=function(e,r){return n(this,e,r,t)},e.filter=function(e,r,i){return n(e,r,i,t)}}},{}],15:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e,t,n){this.promise=e,this.type=t,this.handler=n,this.called=!1,this.cancelPromise=null}function i(e){this.finallyHandler=e}function o(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function s(){return u.call(this,this.promise._target()._settledValue())}function a(e){if(!o(this,e))return f.e=e,f}function u(e){var r=this.promise,u=this.handler;if(!this.called){this.called=!0;var c=this.isFinallyHandler()?u.call(r._boundValue()):u.call(r._boundValue(),e);if(void 0!==c){r._setReturnedNonUndefined();var h=n(c,r);if(h instanceof t){if(null!=this.cancelPromise){if(h._isCancelled()){var d=new l("late cancellation observer");return r._attachExtraTrace(d),f.e=d,f}h.isPending()&&h._attachCancellationCallback(new i(this))}return h._then(s,a,void 0,this,void 0)}}}return r.isRejected()?(o(this),f.e=e,f):(o(this),e)}var c=e("./util"),l=t.CancellationError,f=c.errorObj;return r.prototype.isFinallyHandler=function(){return 0===this.type},i.prototype._resultCancelled=function(){o(this.finallyHandler)},t.prototype._passThrough=function(e,t,n,i){return"function"!=typeof e?this.then():this._then(n,i,void 0,new r(this,t,e),void 0)},t.prototype.lastly=t.prototype.finally=function(e){return this._passThrough(e,0,u,u)},t.prototype.tap=function(e){return this._passThrough(e,1,u)},r}},{"./util":36}],16:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){function a(e,n,r){for(var o=0;o<n.length;++o){r._pushContext();var s=h(n[o])(e);if(r._popContext(),s===f){r._pushContext();var a=t.reject(f.e);return r._popContext(),a}var u=i(s,r);if(u instanceof t)return u}return null}function u(e,n,i,o){if(s.cancellation()){var a=new t(r),u=this._finallyPromise=new t(r);this._promise=a.lastly(function(){return u}),a._captureStackTrace(),a._setOnCancel(this)}else(this._promise=new t(r))._captureStackTrace();this._stack=o,this._generatorFunction=e,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(d):d,this._yieldedPromise=null,this._cancellationPhase=!1}var c=e("./errors").TypeError,l=e("./util"),f=l.errorObj,h=l.tryCatch,d=[];l.inherits(u,o),u.prototype._isResolved=function(){return null===this._promise},u.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},u.prototype._promiseCancelled=function(){if(!this._isResolved()){var e;if(void 0!==this._generator.return)this._promise._pushContext(),e=h(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),e=h(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},u.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=h(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},u.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=h(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},u.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},u.prototype.promise=function(){return this._promise},u.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},u.prototype._continue=function(e){var n=this._promise;if(e===f)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(e.e,!1);var r=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(r);var o=i(r,this._promise);if(o instanceof t||null!==(o=a(o,this._yieldHandlers,this._promise))){var s=(o=o._target())._bitField;0==(50397184&s)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&s)?t._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&s)?t._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()}else this._promiseRejected(new c("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",r)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},t.coroutine=function(e,t){if("function"!=typeof e)throw new c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(t).yieldHandler,r=u,i=(new Error).stack;return function(){var t=e.apply(this,arguments),o=new r(void 0,void 0,n,i),s=o.promise();return o._generator=t,o._promiseFulfilled(void 0),s}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new c("expecting a function but got "+l.classString(e));d.push(e)},t.spawn=function(e){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return n("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new u(e,this),i=r.promise();return r._run(t.spawn),i}}},{"./errors":12,"./util":36}],17:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){var a=e("./util");a.canEvaluate,a.tryCatch,a.errorObj,t.join=function(){var e,t=arguments.length-1;if(t>0&&"function"==typeof arguments[t]){e=arguments[t]}var r=[].slice.call(arguments);e&&r.pop();var i=new n(r).promise();return void 0!==e?i.spread(e):i}}},{"./util":36}],18:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){function a(e,t,n,r){this.constructor$(e),this._promise._captureStackTrace();var i=c();this._callback=null===i?t:l.domainBind(i,t),this._preservedValues=r===o?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],d.invoke(this._asyncInit,this,void 0)}function u(e,n,i,o){if("function"!=typeof n)return r("expecting a function but got "+l.classString(n));var s=0;if(void 0!==i){if("object"!=typeof i||null===i)return t.reject(new TypeError("options argument must be an object but it is "+l.classString(i)));if("number"!=typeof i.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+l.classString(i.concurrency)));s=i.concurrency}return s="number"==typeof s&&isFinite(s)&&s>=1?s:0,new a(e,n,s,o).promise()}var c=t._getDomain,l=e("./util"),f=l.tryCatch,h=l.errorObj,d=t._async;l.inherits(a,n),a.prototype._asyncInit=function(){this._init$(void 0,-2)},a.prototype._init=function(){},a.prototype._promiseFulfilled=function(e,n){var r=this._values,o=this.length(),a=this._preservedValues,u=this._limit;if(n<0){if(n=-1*n-1,r[n]=e,u>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(u>=1&&this._inFlight>=u)return r[n]=e,this._queue.push(n),!1;null!==a&&(a[n]=e);var c=this._promise,l=this._callback,d=c._boundValue();c._pushContext();var p=f(l).call(d,e,n,o),m=c._popContext();if(s.checkForgottenReturns(p,m,null!==a?"Promise.filter":"Promise.map",c),p===h)return this._reject(p.e),!0;var v=i(p,this._promise);if(v instanceof t){var b=(v=v._target())._bitField;if(0==(50397184&b))return u>=1&&this._inFlight++,r[n]=v,v._proxy(this,-1*(n+1)),!1;if(0==(33554432&b))return 0!=(16777216&b)?(this._reject(v._reason()),!0):(this._cancel(),!0);p=v._value()}r[n]=p}return++this._totalResolved>=o&&(null!==a?this._filter(r,a):this._resolve(r),!0)},a.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,n=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(n[r],r)}},a.prototype._filter=function(e,t){for(var n=t.length,r=new Array(n),i=0,o=0;o<n;++o)e[o]&&(r[i++]=t[o]);r.length=i,this._resolve(r)},a.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return u(this,e,t,null)},t.map=function(e,t,n,r){return u(e,t,n,r)}}},{"./util":36}],19:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o){var s=e("./util"),a=s.tryCatch;t.method=function(e){if("function"!=typeof e)throw new t.TypeError("expecting a function but got "+s.classString(e));return function(){var r=new t(n);r._captureStackTrace(),r._pushContext();var i=a(e).apply(this,arguments),s=r._popContext();return o.checkForgottenReturns(i,s,"Promise.method",r),r._resolveFromSyncValue(i),r}},t.attempt=t.try=function(e){if("function"!=typeof e)return i("expecting a function but got "+s.classString(e));var r=new t(n);r._captureStackTrace(),r._pushContext();var u;if(arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var c=arguments[1],l=arguments[2];u=s.isArray(c)?a(e).apply(l,c):a(e).call(l,c)}else u=a(e)();var f=r._popContext();return o.checkForgottenReturns(u,f,"Promise.try",r),r._resolveFromSyncValue(u),r},t.prototype._resolveFromSyncValue=function(e){e===s.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,n){"use strict";function r(e){return e instanceof Error&&c.getPrototypeOf(e)===Error.prototype}function i(e){var t;if(r(e)){(t=new u(e)).name=e.name,t.message=e.message,t.stack=e.stack;for(var n=c.keys(e),i=0;i<n.length;++i){var o=n[i];l.test(o)||(t[o]=e[o])}return t}return s.markAsOriginatingFromRejection(e),e}function o(e,t){return function(n,r){if(null!==e){if(n){var o=i(a(n));e._attachExtraTrace(o),e._reject(o)}else if(t){var s=[].slice.call(arguments,1);e._fulfill(s)}else e._fulfill(r);e=null}}}var s=e("./util"),a=s.maybeWrapAsError,u=e("./errors").OperationalError,c=e("./es5"),l=/^(?:name|message|stack|cause)$/;t.exports=o},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,n){"use strict";t.exports=function(t){function n(e,t){var n=this;if(!o.isArray(e))return r.call(n,e,t);var i=a(t).apply(n._boundValue(),[null].concat(e));i===u&&s.throwLater(i.e)}function r(e,t){var n=this._boundValue(),r=void 0===e?a(t).call(n,null):a(t).call(n,null,e);r===u&&s.throwLater(r.e)}function i(e,t){var n=this;if(!e){var r=new Error(e+"");r.cause=e,e=r}var i=a(t).call(n._boundValue(),e);i===u&&s.throwLater(i.e)}var o=e("./util"),s=t._async,a=o.tryCatch,u=o.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(e,t){if("function"==typeof e){var o=r;void 0!==t&&Object(t).spread&&(o=n),this._then(o,i,void 0,this,e)}return this}}},{"./util":36}],22:[function(e,t,n){"use strict";t.exports=function(){function n(){}function i(e,t){if("function"!=typeof t)throw new _("expecting a function but got "+p.classString(t));if(e.constructor!==o)throw new _("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n")}function o(e){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,e!==k&&(i(this,e),this._resolveFromExecutor(e)),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function s(e){this.promise._resolveCallback(e)}function a(e){this.promise._rejectCallback(e,!1)}function u(e){var t=new o(k);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var c,l=function(){return new _("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},f=function(){return new o.PromiseInspection(this._target())},h=function(e){return o.reject(new _(e))},d={},p=e("./util");c=p.isNode?function(){var e=r.domain;return void 0===e&&(e=null),e}:function(){return null},p.notEnumerableProp(o,"_getDomain",c);var m=e("./es5"),v=e("./async"),b=new v;m.defineProperty(o,"_async",{value:b});var y=e("./errors"),_=o.TypeError=y.TypeError;o.RangeError=y.RangeError;var g=o.CancellationError=y.CancellationError;o.TimeoutError=y.TimeoutError,o.OperationalError=y.OperationalError,o.RejectionError=y.OperationalError,o.AggregateError=y.AggregateError;var k=function(){},w={},C={},x=e("./thenables")(o,k),j=e("./promise_array")(o,k,x,h,n),E=e("./context")(o),S=E.create,T=e("./debuggability")(o,E),R=(T.CapturedTrace,e("./finally")(o,x)),I=e("./catch_filter")(C),A=e("./nodeback"),P=p.errorObj,O=p.tryCatch;return o.prototype.toString=function(){return"[object Promise]"},o.prototype.caught=o.prototype.catch=function(e){var t=arguments.length;if(t>1){var n,r=new Array(t-1),i=0;for(n=0;n<t-1;++n){var o=arguments[n];if(!p.isObject(o))return h("expecting an object but got A catch statement predicate "+p.classString(o));r[i++]=o}return r.length=i,e=arguments[n],this.then(void 0,I(r,e,this))}return this.then(void 0,e)},o.prototype.reflect=function(){return this._then(f,f,void 0,this,void 0)},o.prototype.then=function(e,t){if(T.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var n=".then() only accepts functions but was passed: "+p.classString(e);arguments.length>1&&(n+=", "+p.classString(t)),this._warn(n)}return this._then(e,t,void 0,void 0,void 0)},o.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},o.prototype.spread=function(e){return"function"!=typeof e?h("expecting a function but got "+p.classString(e)):this.all()._then(e,void 0,void 0,w,void 0)},o.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},o.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new j(this).promise()},o.prototype.error=function(e){return this.caught(p.originatesFromRejection,e)},o.getNewLibraryCopy=t.exports,o.is=function(e){return e instanceof o},o.fromNode=o.fromCallback=function(e){var t=new o(k);t._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,r=O(e)(A(t,n));return r===P&&t._rejectCallback(r.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},o.all=function(e){return new j(e).promise()},o.cast=function(e){var t=x(e);return t instanceof o||((t=new o(k))._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},o.resolve=o.fulfilled=o.cast,o.reject=o.rejected=function(e){var t=new o(k);return t._captureStackTrace(),t._rejectCallback(e,!0),t},o.setScheduler=function(e){if("function"!=typeof e)throw new _("expecting a function but got "+p.classString(e));return b.setScheduler(e)},o.prototype._then=function(e,t,n,r,i){var s=void 0!==i,a=s?i:new o(k),u=this._target(),l=u._bitField;s||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&l)?this._boundValue():u===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var f=c();if(0!=(50397184&l)){var h,d,m=u._settlePromiseCtx;0!=(33554432&l)?(d=u._rejectionHandler0,h=e):0!=(16777216&l)?(d=u._fulfillmentHandler0,h=t,u._unsetRejectionIsUnhandled()):(m=u._settlePromiseLateCancellationObserver,d=new g("late cancellation observer"),u._attachExtraTrace(d),h=t),b.invoke(m,u,{handler:null===f?h:"function"==typeof h&&p.domainBind(f,h),promise:a,receiver:r,value:d})}else u._addCallbacks(e,t,a,r,f);return a},o.prototype._length=function(){return 65535&this._bitField},o.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},o.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},o.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},o.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},o.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},o.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},o.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},o.prototype._isFinal=function(){return(4194304&this._bitField)>0},o.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},o.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},o.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},o.prototype._setAsyncGuaranteed=function(){b.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},o.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==d)return void 0===t&&this._isBound()?this._boundValue():t},o.prototype._promiseAt=function(e){return this[4*e-4+2]},o.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},o.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},o.prototype._boundValue=function(){},o.prototype._migrateCallback0=function(e){var t=(e._bitField,e._fulfillmentHandler0),n=e._rejectionHandler0,r=e._promise0,i=e._receiverAt(0);void 0===i&&(i=d),this._addCallbacks(t,n,r,i,null)},o.prototype._migrateCallbackAt=function(e,t){var n=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=d),this._addCallbacks(n,r,i,o,null)},o.prototype._addCallbacks=function(e,t,n,r,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof e&&(this._fulfillmentHandler0=null===i?e:p.domainBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:p.domainBind(i,t));else{var s=4*o-4;this[s+2]=n,this[s+3]=r,"function"==typeof e&&(this[s+0]=null===i?e:p.domainBind(i,e)),"function"==typeof t&&(this[s+1]=null===i?t:p.domainBind(i,t))}return this._setLength(o+1),o},o.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},o.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(l(),!1);var n=x(e,this);if(!(n instanceof o))return this._fulfill(e);t&&this._propagateFrom(n,2);var r=n._target();if(r===this)return void this._reject(l());var i=r._bitField;if(0==(50397184&i)){var s=this._length();s>0&&r._migrateCallback0(this);for(var a=1;a<s;++a)r._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&i))this._fulfill(r._value());else if(0!=(16777216&i))this._reject(r._reason());else{var u=new g("late cancellation observer");r._attachExtraTrace(u),this._reject(u)}}},o.prototype._rejectCallback=function(e,t,n){var r=p.ensureErrorObject(e),i=r===e;if(!i&&!n&&T.warnings()){var o="a promise was rejected with a non-error: "+p.classString(e);this._warn(o,!0)}this._attachExtraTrace(r,!!t&&i),this._reject(e)},o.prototype._resolveFromExecutor=function(e){var t=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,n)});n=!1,this._popContext(),void 0!==r&&t._rejectCallback(r,!0)},o.prototype._settlePromiseFromHandler=function(e,t,n,r){var i=r._bitField;if(0==(65536&i)){r._pushContext();var o;t===w?n&&"number"==typeof n.length?o=O(e).apply(this._boundValue(),n):(o=P,o.e=new _("cannot .spread() a non-array: "+p.classString(n))):o=O(e).call(t,n);var s=r._popContext();0==(65536&(i=r._bitField))&&(o===C?r._reject(n):o===P?r._rejectCallback(o.e,!1):(T.checkForgottenReturns(o,s,"",r,this),r._resolveCallback(o)))}},o.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},o.prototype._followee=function(){return this._rejectionHandler0},o.prototype._setFollowee=function(e){this._rejectionHandler0=e},o.prototype._settlePromise=function(e,t,r,i){var s=e instanceof o,a=this._bitField,u=0!=(134217728&a);0!=(65536&a)?(s&&e._invokeInternalOnCancel(),r instanceof R&&r.isFinallyHandler()?(r.cancelPromise=e,O(t).call(r,i)===P&&e._reject(P.e)):t===f?e._fulfill(f.call(r)):r instanceof n?r._promiseCancelled(e):s||e instanceof j?e._cancel():r.cancel()):"function"==typeof t?s?(u&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,r,i,e)):t.call(r,i,e):r instanceof n?r._isResolved()||(0!=(33554432&a)?r._promiseFulfilled(i,e):r._promiseRejected(i,e)):s&&(u&&e._setAsyncGuaranteed(),0!=(33554432&a)?e._fulfill(i):e._reject(i))},o.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,n=e.promise,r=e.receiver,i=e.value;"function"==typeof t?n instanceof o?this._settlePromiseFromHandler(t,r,i,n):t.call(r,i,n):n instanceof o&&n._reject(i)},o.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},o.prototype._settlePromise0=function(e,t,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,e,i,t)},o.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},o.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var n=l();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():b.settlePromises(this))}},o.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return b.fatalError(e,p.isNode);(65535&t)>0?b.settlePromises(this):this._ensurePossibleRejectionHandled()}},o.prototype._fulfillPromises=function(e,t){for(var n=1;n<e;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},o.prototype._rejectPromises=function(e,t){for(var n=1;n<e;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},o.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!=(16842752&e)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,e),this._rejectPromises(t,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},o.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},o.defer=o.pending=function(){return T.deprecated("Promise.defer","new Promise"),{promise:new o(k),resolve:s,reject:a}},p.notEnumerableProp(o,"_makeSelfResolutionError",l),e("./method")(o,k,x,h,T),e("./bind")(o,k,x,T),e("./cancel")(o,j,h,T),e("./direct_resolve")(o),e("./synchronous_inspection")(o),e("./join")(o,j,x,k,b,c),o.Promise=o,o.version="3.4.7",e("./map.js")(o,j,h,x,k,T),e("./call_get.js")(o),e("./using.js")(o,h,x,S,k,T),e("./timers.js")(o,k,T),e("./generators.js")(o,h,k,x,n,T),e("./nodeify.js")(o),e("./promisify.js")(o,k),e("./props.js")(o,j,x,h),e("./race.js")(o,k,x,h),e("./reduce.js")(o,j,h,x,k,T),e("./settle.js")(o,j,T),e("./some.js")(o,j,h),e("./filter.js")(o,k),e("./each.js")(o,k),e("./any.js")(o),p.toFastProperties(o),p.toFastProperties(o.prototype),u({a:1}),u({b:2}),u({c:3}),u(1),u(function(){}),u(void 0),u(!1),u(new o(k)),T.setBounds(v.firstLineError,p.lastLineError),o}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o){function s(e){switch(e){case-2:return[];case-3:return{}}}function a(e){var r=this._promise=new t(n);e instanceof t&&r._propagateFrom(e,3),r._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var u=e("./util");return u.isArray,u.inherits(a,o),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function e(n,o){var a=r(this._values,this._promise);if(a instanceof t){var c=(a=a._target())._bitField;if(this._values=a,0==(50397184&c))return this._promise._setAsyncGuaranteed(),a._then(e,this._reject,void 0,this,o);if(0==(33554432&c))return 0!=(16777216&c)?this._reject(a._reason()):this._cancel();a=a._value()}if(null===(a=u.asArray(a))){var l=i("expecting an array or an iterable object but got "+u.classString(a)).reason();return void this._promise._rejectCallback(l,!1)}0!==a.length?this._iterate(a):-5===o?this._resolveEmptyArray():this._resolve(s(o))},a.prototype._iterate=function(e){var n=this.getActualLength(e.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var i=this._promise,o=!1,s=null,a=0;a<n;++a){var u=r(e[a],i);u instanceof t?(u=u._target(),s=u._bitField):s=null,o?null!==s&&u.suppressUnhandledRejections():null!==s?0==(50397184&s)?(u._proxy(this,a),this._values[a]=u):o=0!=(33554432&s)?this._promiseFulfilled(u._value(),a):0!=(16777216&s)?this._promiseRejected(u._reason(),a):this._promiseCancelled(a):o=this._promiseFulfilled(u,a)}o||i._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},a.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},a.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var n=0;n<e.length;++n)e[n]instanceof t&&e[n].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(e){return e},a}},{"./util":36}],24:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e){return!g.test(e)}function i(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function o(e,t,n){var r=h.getDataPropertyOrDefault(e,t+n,y);return!!r&&i(r)}function s(e,t,n){for(var r=0;r<e.length;r+=2){var i=e[r];if(n.test(i))for(var o=i.replace(n,""),s=0;s<e.length;s+=2)if(e[s]===o)throw new b("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}function a(e,t,n,r){for(var a=h.inheritedDataKeys(e),u=[],c=0;c<a.length;++c){var l=a[c],f=e[l],d=r===k||k(l,f,e);"function"!=typeof f||i(f)||o(e,l,t)||!r(l,f,e,d)||u.push(l,f)}return s(u,t,n),u}function u(e,r,i,o,s,a){function u(){var i=r;r===f&&(i=this);var o=new t(n);o._captureStackTrace();var s="string"==typeof l&&this!==c?this[l]:e,u=d(o,a);try{s.apply(i,p(arguments,u))}catch(e){o._rejectCallback(m(e),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var c=function(){return this}(),l=e;return"string"==typeof l&&(e=o),h.notEnumerableProp(u,"__isPromisified__",!0),u}function c(e,t,n,r,i){for(var o=new RegExp(w(t)+"$"),s=a(e,t,o,n),u=0,c=s.length;u<c;u+=2){var l=s[u],d=s[u+1],p=l+t;if(r===C)e[p]=C(l,f,l,d,t,i);else{var m=r(d,function(){return C(l,f,l,d,t,i)});h.notEnumerableProp(m,"__isPromisified__",!0),e[p]=m}}return h.toFastProperties(e),e}function l(e,t,n){return C(e,t,void 0,e,null,n)}var f={},h=e("./util"),d=e("./nodeback"),p=h.withAppended,m=h.maybeWrapAsError,v=h.canEvaluate,b=e("./errors").TypeError,y={__isPromisified__:!0},_=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],g=new RegExp("^(?:"+_.join("|")+")$"),k=function(e){return h.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},w=function(e){return e.replace(/([$])/,"\\$")},C=v?void 0:u;t.promisify=function(e,t){if("function"!=typeof e)throw new b("expecting a function but got "+h.classString(e));if(i(e))return e;var n=l(e,void 0===(t=Object(t)).context?f:t.context,!!t.multiArgs);return h.copyDescriptors(e,n,r),n},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new b("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var n=!!(t=Object(t)).multiArgs,r=t.suffix;"string"!=typeof r&&(r="Async");var i=t.filter;"function"!=typeof i&&(i=k);var o=t.promisifier;if("function"!=typeof o&&(o=C),!h.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=h.inheritedDataKeys(e),a=0;a<s.length;++a){var u=e[s[a]];"constructor"!==s[a]&&h.isClass(u)&&(c(u.prototype,r,i,o,n),c(u,r,i,o,n))}return c(e,r,i,o,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){function o(e){var t,n=!1;if(void 0!==a&&e instanceof a)t=f(e),n=!0;else{var r=l.keys(e),i=r.length;t=new Array(2*i);for(var o=0;o<i;++o){var s=r[o];t[o]=e[s],t[o+i]=s}}this.constructor$(t),this._isMap=n,this._init$(void 0,-3)}function s(e){var n,s=r(e);return c(s)?(n=s instanceof t?s._then(t.props,void 0,void 0,void 0,void 0):new o(s).promise(),s instanceof t&&n._propagateFrom(s,2),n):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var a,u=e("./util"),c=u.isObject,l=e("./es5");"function"==typeof Map&&(a=Map);var f=function(){function e(e,r){this[t]=e,this[t+n]=r,t++}var t=0,n=0;return function(r){n=r.size,t=0;var i=new Array(2*r.size);return r.forEach(e,i),i}}(),h=function(e){for(var t=new a,n=e.length/2|0,r=0;r<n;++r){var i=e[n+r],o=e[r];t.set(i,o)}return t};u.inherits(o,n),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var n;if(this._isMap)n=h(this._values);else{n={};for(var r=this.length(),i=0,o=this.length();i<o;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return s(this)},t.props=function(e){return s(e)}}},{"./es5":13,"./util":36}],26:[function(e,t,n){"use strict";function r(e,t,n,r,i){for(var o=0;o<i;++o)n[o+r]=e[o+t],e[o+t]=void 0}function i(e){this._capacity=e,this._length=0,this._front=0}i.prototype._willBeOverCapacity=function(e){return this._capacity<e},i.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},i.prototype.push=function(e,t,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=n,this._length=r},i.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},i.prototype.length=function(){return this._length},i.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},i.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,r(this,0,this,t,this._front+this._length&t-1)},t.exports=i},{}],27:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){function o(e,o){var u=r(e);if(u instanceof t)return a(u);if(null===(e=s.asArray(e)))return i("expecting an array or an iterable object but got "+s.classString(e));var c=new t(n);void 0!==o&&c._propagateFrom(o,3);for(var l=c._fulfill,f=c._reject,h=0,d=e.length;h<d;++h){var p=e[h];(void 0!==p||h in e)&&t.cast(p)._then(l,f,void 0,c,null)}return c}var s=e("./util"),a=function(e){return e.then(function(t){return o(t,e)})};t.race=function(e){return o(e,void 0)},t.prototype.race=function(){return o(this,void 0)}}},{"./util":36}],28:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){function a(e,n,r,i){this.constructor$(e);var s=h();this._fn=null===s?n:d.domainBind(s,n),void 0!==r&&(r=t.resolve(r))._attachCancellationCallback(this),this._initialValue=r,this._currentCancellable=null,this._eachValues=i===o?Array(this._length):0===i?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function u(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function c(e,t,n,i){return"function"!=typeof t?r("expecting a function but got "+d.classString(t)):new a(e,t,n,i).promise()}function l(e){this.accum=e,this.array._gotAccum(e);var n=i(this.value,this.array._promise);return n instanceof t?(this.array._currentCancellable=n,n._then(f,void 0,void 0,this,void 0)):f.call(this,n)}function f(e){var n=this.array,r=n._promise,i=p(n._fn);r._pushContext();var o;(o=void 0!==n._eachValues?i.call(r._boundValue(),e,this.index,this.length):i.call(r._boundValue(),this.accum,e,this.index,this.length))instanceof t&&(n._currentCancellable=o);var a=r._popContext();return s.checkForgottenReturns(o,a,void 0!==n._eachValues?"Promise.each":"Promise.reduce",r),o}var h=t._getDomain,d=e("./util"),p=d.tryCatch;d.inherits(a,n),a.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==o&&this._eachValues.push(e)},a.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},a.prototype._init=function(){},a.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},a.prototype.shouldCopyValues=function(){return!1},a.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},a.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel())},a.prototype._iterate=function(e){this._values=e;var n,r,i=e.length;if(void 0!==this._initialValue?(n=this._initialValue,r=0):(n=t.resolve(e[0]),r=1),this._currentCancellable=n,!n.isRejected())for(;r<i;++r){var o={accum:null,value:e[r],index:r,length:i,array:this};n=n._then(l,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(u,u,void 0,n,this)},t.prototype.reduce=function(e,t){return c(this,e,t,null)},t.reduce=function(e,t,n,r){return c(e,t,n,r)}}},{"./util":36}],29:[function(e,t,n){"use strict";var o,s=e("./util"),a=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},u=s.getNativePromise();if(s.isNode&&"undefined"==typeof MutationObserver){var c=i.setImmediate,l=r.nextTick;o=s.isRecentNode?function(e){c.call(i,e)}:function(e){l.call(r,e)}}else if("function"==typeof u&&"function"==typeof u.resolve){var f=u.resolve();o=function(e){f.then(e)}}else o="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:a:function(){var e=document.createElement("div"),t={attributes:!0},n=!1,r=document.createElement("div");new MutationObserver(function(){e.classList.toggle("foo"),n=!1}).observe(r,t);var i=function(){n||(n=!0,r.classList.toggle("foo"))};return function(n){var r=new MutationObserver(function(){r.disconnect(),n()});r.observe(e,t),i()}}();t.exports=o},{"./util":36}],30:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.constructor$(e)}var o=t.PromiseInspection;e("./util").inherits(i,n),i.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(e,t){var n=new o;return n._bitField=33554432,n._settledValueField=e,this._promiseResolved(t,n)},i.prototype._promiseRejected=function(e,t){var n=new o;return n._bitField=16777216,n._settledValueField=e,this._promiseResolved(t,n)},t.settle=function(e){return r.deprecated(".settle()",".reflect()"),new i(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(e,t){if((0|t)!==t||t<0)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new i(e),o=n.promise();return n.setHowMany(t),n.init(),o}var s=e("./util"),a=e("./errors").RangeError,u=e("./errors").AggregateError,c=s.isArray,l={};s.inherits(i,n),i.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=c(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},i.prototype.init=function(){this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(e){this._howMany=e},i.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},i.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},i.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(l),this._checkOutcome())},i.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new u,t=this.length();t<this._values.length;++t)this._values[t]!==l&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(e){this._values.push(e)},i.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new a(t)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return o(e,t)},t.prototype.some=function(e){return o(this,e)},t._SomePromiseArray=i}},{"./errors":12,"./util":36}],32:[function(e,t,n){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var n=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return s.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return a.call(this._target())},e.prototype.value=function(){return n.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e,r){if(l(e)){if(e instanceof t)return e;var i=o(e);if(i===c){r&&r._pushContext();u=t.reject(i.e);return r&&r._popContext(),u}if("function"==typeof i){if(s(e)){var u=new t(n);return e._then(u._fulfill,u._reject,void 0,u,null),u}return a(e,i,r)}}return e}function i(e){return e.then}function o(e){try{return i(e)}catch(e){return c.e=e,c}}function s(e){try{return f.call(e,"_promise0")}catch(e){return!1}}function a(e,r,i){function o(e){a&&(a._resolveCallback(e),a=null)}function s(e){a&&(a._rejectCallback(e,f,!0),a=null)}var a=new t(n),l=a;i&&i._pushContext(),a._captureStackTrace(),i&&i._popContext();var f=!0,h=u.tryCatch(r).call(e,o,s);return f=!1,a&&h===c&&(a._rejectCallback(h.e,!0,!0),a=null),l}var u=e("./util"),c=u.errorObj,l=u.isObject,f={}.hasOwnProperty;return r}},{"./util":36}],34:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.handle=e}function o(e){return clearTimeout(this.handle),e}function s(e){throw clearTimeout(this.handle),e}var a=e("./util"),u=t.TimeoutError;i.prototype._resultCancelled=function(){clearTimeout(this.handle)};var c=function(e){return l(+this).thenReturn(e)},l=t.delay=function(e,o){var s,a;return void 0!==o?(s=t.resolve(o)._then(c,null,null,e,void 0),r.cancellation()&&o instanceof t&&s._setOnCancel(o)):(s=new t(n),a=setTimeout(function(){s._fulfill()},+e),r.cancellation()&&s._setOnCancel(new i(a)),s._captureStackTrace()),s._setAsyncGuaranteed(),s};t.prototype.delay=function(e){return l(e,this)};var f=function(e,t,n){var r;r="string"!=typeof t?t instanceof Error?t:new u("operation timed out"):new u(t),a.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._reject(r),null!=n&&n.cancel()};t.prototype.timeout=function(e,t){e=+e;var n,a,u=new i(setTimeout(function(){n.isPending()&&f(n,t,a)},e));return r.cancellation()?(a=this.then(),(n=a._then(o,s,void 0,u,void 0))._setOnCancel(u)):n=this._then(o,s,void 0,u,void 0),n}}},{"./util":36}],35:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){function a(e){setTimeout(function(){throw e},0)}function u(e){var t=r(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function c(e,n){function i(){if(s>=c)return l._fulfill();var o=u(e[s++]);if(o instanceof t&&o._isDisposable()){try{o=r(o._getDisposer().tryDispose(n),e.promise)}catch(e){return a(e)}if(o instanceof t)return o._then(i,a,null,null,null)}i()}var s=0,c=e.length,l=new t(o);return i(),l}function l(e,t,n){this._data=e,this._promise=t,this._context=n}function f(e,t,n){this.constructor$(e,t,n)}function h(e){return l.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function d(e){this.length=e,this.promise=null,this[e-1]=null}var p=e("./util"),m=e("./errors").TypeError,v=e("./util").inherits,b=p.errorObj,y=p.tryCatch,_={};l.prototype.data=function(){return this._data},l.prototype.promise=function(){return this._promise},l.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():_},l.prototype.tryDispose=function(e){var t=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=t!==_?this.doDispose(t,e):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},l.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},v(f,l),f.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},d.prototype._resultCancelled=function(){for(var e=this.length,n=0;n<e;++n){var r=this[n];r instanceof t&&r.cancel()}},t.using=function(){var e=arguments.length;if(e<2)return n("you must pass at least 2 arguments to Promise.using");var i=arguments[e-1];if("function"!=typeof i)return n("expecting a function but got "+p.classString(i));var o,a=!0;2===e&&Array.isArray(arguments[0])?(o=arguments[0],e=o.length,a=!1):(o=arguments,e--);for(var u=new d(e),f=0;f<e;++f){var m=o[f];if(l.isDisposer(m)){var v=m;(m=m.promise())._setDisposable(v)}else{var _=r(m);_ instanceof t&&(m=_._then(h,null,null,{resources:u,index:f},void 0))}u[f]=m}for(var g=new Array(u.length),f=0;f<g.length;++f)g[f]=t.resolve(u[f]).reflect();var k=t.all(g).then(function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.isRejected())return b.e=n.error(),b;if(!n.isFulfilled())return void k.cancel();e[t]=n.value()}w._pushContext(),i=y(i);var r=a?i.apply(void 0,e):i(e),o=w._popContext();return s.checkForgottenReturns(r,o,"Promise.using",w),r}),w=k.lastly(function(){var e=new t.PromiseInspection(k);return c(u,e)});return u.promise=w,w._setOnCancel(u),w},t.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new f(e,this,i());throw new m}}},{"./errors":12,"./util":36}],36:[function(e,t,n){"use strict";function o(){try{var e=T;return T=null,e.apply(this,arguments)}catch(e){return A.e=e,A}}function s(e){return T=e,o}function a(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function u(e){return"function"==typeof e||"object"==typeof e&&null!==e}function c(e){return a(e)?new Error(y(e)):e}function l(e,t){var n,r=e.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=e[n];return i[n]=t,i}function f(e,t,n){if(!R.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var r=Object.getOwnPropertyDescriptor(e,t);return null!=r?null==r.get&&null==r.set?r.value:n:void 0}function h(e,t,n){if(a(e))return e;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return R.defineProperty(e,t,r),e}function d(e){throw e}function p(e){try{if("function"==typeof e){var t=R.names(e.prototype),n=R.isES5&&t.length>1,r=t.length>0&&!(1===t.length&&"constructor"===t[0]),i=F.test(e+"")&&R.names(e).length>0;if(n||r||i)return!0}return!1}catch(e){return!1}}function m(e){function t(){}t.prototype=e;for(var n=8;n--;)new t;return e}function v(e){return N.test(e)}function b(e,t,n){for(var r=new Array(e),i=0;i<e;++i)r[i]=t+i+n;return r}function y(e){try{return e+""}catch(e){return"[no string representation]"}}function _(e){return null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function g(e){try{h(e,"isOperational",!0)}catch(e){}}function k(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function w(e){return _(e)&&R.propertyIsWritable(e,"stack")}function C(e){return{}.toString.call(e)}function x(e,t,n){for(var r=R.names(e),i=0;i<r.length;++i){var o=r[i];if(n(o))try{R.defineProperty(t,o,R.getDescriptor(e,o))}catch(e){}}}function j(e){return q?r.env[e]:void 0}function E(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}}function S(e,t){return e.bind(t)}var T,R=e("./es5"),I="undefined"==typeof navigator,A={e:{}},P="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:void 0!==this?this:null,O=function(e,t){function n(){this.constructor=e,this.constructor$=t;for(var n in t.prototype)r.call(t.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=t.prototype[n])}var r={}.hasOwnProperty;return n.prototype=t.prototype,e.prototype=new n,e.prototype},M=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1};if(R.isES5){var n=Object.getOwnPropertyNames;return function(e){for(var r=[],i=Object.create(null);null!=e&&!t(e);){var o;try{o=n(e)}catch(e){return r}for(var s=0;s<o.length;++s){var a=o[s];if(!i[a]){i[a]=!0;var u=Object.getOwnPropertyDescriptor(e,a);null!=u&&null==u.get&&null==u.set&&r.push(a)}}e=R.getPrototypeOf(e)}return r}}var r={}.hasOwnProperty;return function(n){if(t(n))return[];var i=[];e:for(var o in n)if(r.call(n,o))i.push(o);else{for(var s=0;s<e.length;++s)if(r.call(e[s],o))continue e;i.push(o)}return i}}(),F=/this\s*\.\s*\S+\s*=/,N=/^[a-z$_][a-z$_0-9]*$/i,U=function(){return"stack"in new Error?function(e){return w(e)?e:new Error(y(e))}:function(e){if(w(e))return e;try{throw new Error(y(e))}catch(e){return e}}}(),L=function(e){return R.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var D="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,n=[],r=e[Symbol.iterator]();!(t=r.next()).done;)n.push(t.value);return n};L=function(e){return R.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?D(e):null}}var B=void 0!==r&&"[object process]"===C(r).toLowerCase(),q=void 0!==r&&void 0!==r.env,z={isClass:p,isIdentifier:v,inheritedDataKeys:M,getDataPropertyOrDefault:f,thrower:d,isArray:R.isArray,asArray:L,notEnumerableProp:h,isPrimitive:a,isObject:u,isError:_,canEvaluate:I,errorObj:A,tryCatch:s,inherits:O,withAppended:l,maybeWrapAsError:c,toFastProperties:m,filledRange:b,toString:y,canAttachTrace:w,ensureErrorObject:U,originatesFromRejection:k,markAsOriginatingFromRejection:g,classString:C,copyDescriptors:x,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:B,hasEnvVariables:q,env:j,global:P,getNativePromise:E,domainBind:S};z.isRecentNode=z.isNode&&function(){var e=r.versions.node.split(".").map(Number);return 0===e[0]&&e[1]>10||e[0]>0}(),z.isNode&&z.toFastProperties(r);try{throw new Error}catch(e){z.lastLineError=e}t.exports=z},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:204}],57:[function(e,t,n){(function(){var n,r=function(e,t){return function(){return e.apply(t,arguments)}},i=[].slice;n=function(){function t(e,n,i,o,s){this.maxNb=null!=e?e:0,this.minTime=null!=n?n:0,this.highWater=null!=i?i:-1,this.strategy=null!=o?o:t.prototype.strategy.LEAK,this.rejectOnDrop=null!=s&&s,this.schedulePriority=r(this.schedulePriority,this),this.submitPriority=r(this.submitPriority,this),this.submit=r(this.submit,this),this._nextRequest=Date.now(),this._nbRunning=0,this._queues=this._makeQueues(),this._running={},this._nextIndex=0,this._unblockTime=0,this.penalty=15*this.minTime||5e3,this.interrupt=!1,this.reservoir=null,this.limiter=null,this.events={}}var n;return t.strategy=t.prototype.strategy={LEAK:1,OVERFLOW:2,OVERFLOW_PRIORITY:4,BLOCK:3},t.Cluster=t.prototype.Cluster=e("./Cluster"),t.DLList=t.prototype.DLList=e("./DLList"),t.Promise=t.prototype.Promise=function(){try{return e("bluebird")}catch(e){return n=e,"undefined"!=typeof Promise&&null!==Promise?Promise:function(){throw new Error("Bottleneck: install 'bluebird' or use Node 0.12 or higher for Promise support")}}}(),t.prototype._trigger=function(e,t){return this.rejectOnDrop&&"dropped"===e&&t[0].cb.apply({},[new Error("This job has been dropped by Bottleneck")]),setTimeout(function(n){return function(){var r;return null!=(r=n.events[e])?r.forEach(function(e){return e.apply({},t)}):void 0}}(this),0)},t.prototype._makeQueues=function(){var e,n;for(n=[],e=1,10;e<=10;++e)n.push(new t.prototype.DLList);return n},t.prototype.chain=function(e){return this.limiter=e,this},t.prototype.isBlocked=function(){return this._unblockTime>=Date.now()},t.prototype._sanitizePriority=function(e){var t;return t=~~e!==e?5:e,t<0?0:t>9?9:t},t.prototype._find=function(e,t){var n,r,i,o;for(n=r=0,i=e.length;r<i;n=++r)if(o=e[n],t(o))return o;return[]},t.prototype.nbQueued=function(e){return null!=e?this._queues[this._sanitizePriority(e)].length:this._queues.reduce(function(e,t){return e+t.length},0)},t.prototype.nbRunning=function(){return this._nbRunning},t.prototype._getFirst=function(e){return this._find(e,function(e){return e.length>0})},t.prototype._conditionsCheck=function(){return(this.nbRunning()<this.maxNb||this.maxNb<=0)&&(null==this.reservoir||this.reservoir>0)},t.prototype.check=function(){return this._conditionsCheck()&&this._nextRequest-Date.now()<=0},t.prototype._tryToRun=function(){var e,t,n,r,i;return!!(this._conditionsCheck()&&(r=this.nbQueued())>0)&&(this._nbRunning++,null!=this.reservoir&&this.reservoir--,i=Math.max(this._nextRequest-Date.now(),0),this._nextRequest=Date.now()+i+this.minTime,n=this._getFirst(this._queues).shift(),1===r&&this._trigger("empty",[]),e=!1,t=this._nextIndex++,this._running[t]={timeout:setTimeout(function(r){return function(){var i;return i=function(){var i;if(!e&&(e=!0,delete r._running[t],r._nbRunning--,r._tryToRun(),0===r.nbRunning()&&0===r.nbQueued()&&r._trigger("idle",[]),!r.interrupt))return null!=(i=n.cb)?i.apply({},Array.prototype.slice.call(arguments,0)):void 0},null!=r.limiter?r.limiter.submit.apply(r.limiter,Array.prototype.concat(n.task,n.args,i)):n.task.apply({},n.args.concat(i))}}(this),i),job:n},!0)},t.prototype.submit=function(){var e;return e=1<=arguments.length?i.call(arguments,0):[],this.submitPriority.apply({},Array.prototype.concat(5,e))},t.prototype.submitPriority=function(){var e,n,r,o,s,a,u,c;return s=arguments[0],c=arguments[1],e=4<=arguments.length?i.call(arguments,2,r=arguments.length-1):(r=2,[]),n=arguments[r++],o={task:c,args:e,cb:n},s=this._sanitizePriority(s),a=this.highWater>=0&&this.nbQueued()===this.highWater&&!this.check(),this.strategy===t.prototype.strategy.BLOCK&&(a||this.isBlocked())?(this._unblockTime=Date.now()+this.penalty,this._nextRequest=this._unblockTime+this.minTime,this._queues=this._makeQueues(),this._trigger("dropped",[o]),!0):a&&(null!=(u=this.strategy===t.prototype.strategy.LEAK?this._getFirst(this._queues.slice(s).reverse()).shift():this.strategy===t.prototype.strategy.OVERFLOW_PRIORITY?this._getFirst(this._queues.slice(s+1).reverse()).shift():this.strategy===t.prototype.strategy.OVERFLOW?o:void 0)&&this._trigger("dropped",[u]),null==u||this.strategy===t.prototype.strategy.OVERFLOW)?a:(this._queues[s].push(o),this._tryToRun(),a)},t.prototype.schedule=function(){var e;return e=1<=arguments.length?i.call(arguments,0):[],this.schedulePriority.apply({},Array.prototype.concat(5,e))},t.prototype.schedulePriority=function(){var e,n,r,o;return n=arguments[0],r=arguments[1],e=3<=arguments.length?i.call(arguments,2):[],o=function(){var e,t,n;return e=2<=arguments.length?i.call(arguments,0,n=arguments.length-1):(n=0,[]),t=arguments[n++],r.apply({},e).then(function(){var e;return e=1<=arguments.length?i.call(arguments,0):[],t.apply({},Array.prototype.concat(null,e))}).catch(function(){var e;return e=1<=arguments.length?i.call(arguments,0):[],t.apply({},e)})},new t.prototype.Promise(function(t){return function(r,s){return t.submitPriority.apply({},Array.prototype.concat(n,o,e,function(){var e;return e=1<=arguments.length?i.call(arguments,0):[],(null!=e[0]?s:(e.shift(),r)).apply({},e)}))}}(this))},t.prototype.changeSettings=function(e,t,n,r,i){for(this.maxNb=null!=e?e:this.maxNb,this.minTime=null!=t?t:this.minTime,this.highWater=null!=n?n:this.highWater,this.strategy=null!=r?r:this.strategy,this.rejectOnDrop=null!=i?i:this.rejectOnDrop;this._tryToRun(););return this},t.prototype.changePenalty=function(e){return this.penalty=null!=e?e:this.penalty,this},t.prototype.changeReservoir=function(e){for(this.reservoir=e;this._tryToRun(););return this},t.prototype.incrementReservoir=function(e){return null==e&&(e=0),this.changeReservoir(this.reservoir+e),this},t.prototype.on=function(e,t){return null!=this.events[e]?this.events[e].push(t):this.events[e]=[t],this},t.prototype.removeAllListeners=function(e){return null==e&&(e=null),null!=e?delete this.events[e]:this.events={},this},t.prototype.stopAll=function(e){var t,n,r,o,s,a,u;for(this.interrupt=null!=e?e:this.interrupt,t=0,a=(o=Object.keys(this._running)).length;t<a;t++)r=o[t],clearTimeout(this._running[r].timeout);if(this._tryToRun=function(){},this.check=function(){return!1},this.submit=this.submitPriority=function(){var e;return 2<=arguments.length?i.call(arguments,0,e=arguments.length-1):e=0,(0,arguments[e++])(new Error("This limiter is stopped"))},this.schedule=this.schedulePriority=function(){return Promise.reject(new Error("This limiter is stopped"))},this.interrupt)for(s=0,u=o.length;s<u;s++)r=o[s],this._trigger("dropped",[this._running[r].job]);for(;n=this._getFirst(this._queues).shift();)this._trigger("dropped",[n]);return this._trigger("empty",[]),0===this.nbRunning()&&this._trigger("idle",[]),this},t}(),t.exports=n}).call(this)},{"./Cluster":58,"./DLList":59,bluebird:56}],58:[function(e,t,n){(function(){var n,r={}.hasOwnProperty;n=function(){function t(t,n,r,i,o){this.maxNb=t,this.minTime=n,this.highWater=r,this.strategy=i,this.rejectOnDrop=o,this.limiters={},this.Bottleneck=e("./Bottleneck"),this.startAutoCleanup()}return t.prototype.key=function(e){var t;return null==e&&(e=""),null!=(t=this.limiters[e])?t:this.limiters[e]=new this.Bottleneck(this.maxNb,this.minTime,this.highWater,this.strategy,this.rejectOnDrop)},t.prototype.deleteKey=function(e){return null==e&&(e=""),delete this.limiters[e]},t.prototype.all=function(e){var t,n,i,o;n=this.limiters,i=[];for(t in n)r.call(n,t)&&(o=n[t],i.push(e(o)));return i},t.prototype.keys=function(){return Object.keys(this.limiters)},t.prototype.startAutoCleanup=function(){var e;return this.stopAutoCleanup(),"function"==typeof(e=this.interval=setInterval(function(e){return function(){var t,n,r,i,o;i=Date.now(),n=e.limiters,r=[];for(t in n)o=n[t],o._nextRequest+3e5<i?r.push(e.deleteKey(t)):r.push(void 0);return r}}(this),3e4)).unref?e.unref():void 0},t.prototype.stopAutoCleanup=function(){return clearInterval(this.interval)},t}(),t.exports=n}).call(this)},{"./Bottleneck":57}],59:[function(e,t,n){(function(){var e;e=function(){function e(){this._first=null,this._last=null,this.length=0}return e.prototype.push=function(e){var t;this.length++,t={value:e,next:null},null!=this._last?(this._last.next=t,this._last=t):this._first=this._last=t},e.prototype.shift=function(){var e,t;if(null!=this._first)return this.length--,t=this._first.value,this._first=null!=(e=this._first.next)?e:this._last=null,t},e.prototype.getArray=function(){var e,t,n;for(e=this._first,n=[];null!=e;)n.push((t=e,e=e.next,t.value));return n},e}(),t.exports=e}).call(this)},{}],60:[function(e,t,n){(function(n){(function(){t.exports=e("./Bottleneck"),null!=n.window&&(n.window.Bottleneck=t.exports)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Bottleneck":57}],61:[function(e,t,n){},{}],62:[function(e,t,n){"use strict";function r(e){if(e>K)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.__proto__=i.prototype,t}function i(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(e)}return o(e,t,n)}function o(e,t,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return e instanceof ArrayBuffer?f(e,t,n):"string"==typeof e?c(e,t):h(e)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function a(e,t,n){return s(e),e<=0?r(e):void 0!==t?"string"==typeof n?r(e).fill(t,n):r(e).fill(t):r(e)}function u(e){return s(e),r(e<0?0:0|d(e))}function c(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!i.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');var n=0|m(e,t),o=r(n),s=o.write(e,t);return s!==n&&(o=o.slice(0,s)),o}function l(e){for(var t=e.length<0?0:0|d(e.length),n=r(t),i=0;i<t;i+=1)n[i]=255&e[i];return n}function f(e,t,n){if(t<0||e.byteLength<t)throw new RangeError("'offset' is out of bounds");if(e.byteLength<t+(n||0))throw new RangeError("'length' is out of bounds");var r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),r.__proto__=i.prototype,r}function h(e){if(i.isBuffer(e)){var t=0|d(e.length),n=r(t);return 0===n.length?n:(e.copy(n,0,0,t),n)}if(e){if(ArrayBuffer.isView(e)||"length"in e)return"number"!=typeof e.length||G(e.length)?r(0):l(e);if("Buffer"===e.type&&Array.isArray(e.data))return l(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function d(e){if(e>=K)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K.toString(16)+" bytes");return 0|e}function p(e){return+e!=e&&(e=0),i.alloc(+e)}function m(e,t){if(i.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer)return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return W(e).length;default:if(r)return q(e).length;t=(""+t).toLowerCase(),r=!0}}function v(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return R(this,t,n);case"latin1":case"binary":return I(this,t,n);case"base64":return E(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function b(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,o){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=i.from(t,r)),i.isBuffer(t))return 0===t.length?-1:_(e,t,n,r,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):_(e,[t],n,r,o);throw new TypeError("val must be string, number or Buffer")}function _(e,t,n,r,i){function o(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var s=1,a=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,n/=2}var c;if(i){var l=-1;for(c=n;c<a;c++)if(o(e,c)===o(t,-1===l?0:c-l)){if(-1===l&&(l=c),c-l+1===u)return l*s}else-1!==l&&(c-=c-l),l=-1}else for(n+u>a&&(n=a-u),c=n;c>=0;c--){for(var f=!0,h=0;h<u;h++)if(o(e,c+h)!==o(t,h)){f=!1;break}if(f)return c}return-1}function g(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function k(e,t,n,r){return V(q(t,e.length-n),e,n,r)}function w(e,t,n,r){return V(z(t),e,n,r)}function C(e,t,n,r){return w(e,t,n,r)}function x(e,t,n,r){return V(W(t),e,n,r)}function j(e,t,n,r){return V(H(t,e.length-n),e,n,r)}function E(e,t,n){return 0===t&&n===e.length?J.fromByteArray(e):J.fromByteArray(e.slice(t,n))}function S(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o=e[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a<=n){var u,c,l,f;switch(a){case 1:o<128&&(s=o);break;case 2:128==(192&(u=e[i+1]))&&(f=(31&o)<<6|63&u)>127&&(s=f);break;case 3:u=e[i+1],c=e[i+2],128==(192&u)&&128==(192&c)&&(f=(15&o)<<12|(63&u)<<6|63&c)>2047&&(f<55296||f>57343)&&(s=f);break;case 4:u=e[i+1],c=e[i+2],l=e[i+3],128==(192&u)&&128==(192&c)&&128==(192&l)&&(f=(15&o)<<18|(63&u)<<12|(63&c)<<6|63&l)>65535&&f<1114112&&(s=f)}}null===s?(s=65533,a=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=a}return T(r)}function T(e){var t=e.length;if(t<=Q)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=Q));return n}function R(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function I(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function A(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=B(e[o]);return i}function P(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function O(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,n,r,o,s){if(!i.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<s)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function F(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function N(e,t,n,r,i){return t=+t,n>>>=0,i||F(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),$.write(e,t,n,r,23,4),n+4}function U(e,t,n,r,i){return t=+t,n>>>=0,i||F(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),$.write(e,t,n,r,52,8),n+8}function L(e){if((e=D(e).replace(X,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function D(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function q(e,t){t=t||1/0;for(var n,r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function z(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function H(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}function W(e){return J.toByteArray(L(e))}function V(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function G(e){return e!==e}var J=e("base64-js"),$=e("ieee754");n.Buffer=i,n.SlowBuffer=p,n.INSPECT_MAX_BYTES=50;var K=2147483647;n.kMaxLength=K,i.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),i.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&i[Symbol.species]===i&&Object.defineProperty(i,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),i.poolSize=8192,i.from=function(e,t,n){return o(e,t,n)},i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array,i.alloc=function(e,t,n){return a(e,t,n)},i.allocUnsafe=function(e){return u(e)},i.allocUnsafeSlow=function(e){return u(e)},i.isBuffer=function(e){return null!=e&&!0===e._isBuffer},i.compare=function(e,t){if(!i.isBuffer(e)||!i.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,o=0,s=Math.min(n,r);o<s;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0},i.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return i.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=i.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var s=e[n];if(!i.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,o),o+=s.length}return r},i.byteLength=m,i.prototype._isBuffer=!0,i.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)b(this,t,t+1);return this},i.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},i.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)b(this,t,t+7),b(this,t+1,t+6),b(this,t+2,t+5),b(this,t+3,t+4);return this},i.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?S(this,0,e):v.apply(this,arguments)},i.prototype.equals=function(e){if(!i.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===i.compare(this,e)},i.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},i.prototype.compare=function(e,t,n,r,o){if(!i.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),t<0||n>e.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&t>=n)return 0;if(r>=o)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,o>>>=0,this===e)return 0;for(var s=o-r,a=n-t,u=Math.min(s,a),c=this.slice(r,o),l=e.slice(t,n),f=0;f<u;++f)if(c[f]!==l[f]){s=c[f],a=l[f];break}return s<a?-1:a<s?1:0},i.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},i.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},i.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},i.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return g(this,e,t,n);case"utf8":case"utf-8":return k(this,e,t,n);case"ascii":return w(this,e,t,n);case"latin1":case"binary":return C(this,e,t,n);case"base64":return x(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Q=4096;i.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return r.__proto__=i.prototype,r},i.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},i.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},i.prototype.readUInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),this[e]},i.prototype.readUInt16LE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]|this[e+1]<<8},i.prototype.readUInt16BE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]<<8|this[e+1]},i.prototype.readUInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},i.prototype.readUInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},i.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},i.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||O(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},i.prototype.readInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},i.prototype.readInt16LE=function(e,t){e>>>=0,t||O(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},i.prototype.readInt16BE=function(e,t){e>>>=0,t||O(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},i.prototype.readInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},i.prototype.readInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},i.prototype.readFloatLE=function(e,t){return e>>>=0,t||O(e,4,this.length),$.read(this,e,!0,23,4)},i.prototype.readFloatBE=function(e,t){return e>>>=0,t||O(e,4,this.length),$.read(this,e,!1,23,4)},i.prototype.readDoubleLE=function(e,t){return e>>>=0,t||O(e,8,this.length),$.read(this,e,!0,52,8)},i.prototype.readDoubleBE=function(e,t){return e>>>=0,t||O(e,8,this.length),$.read(this,e,!1,52,8)},i.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||M(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},i.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||M(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},i.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,1,255,0),this[t]=255&e,t+1},i.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},i.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},i.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},i.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);M(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},i.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);M(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},i.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},i.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},i.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},i.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},i.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i.prototype.writeFloatLE=function(e,t,n){return N(this,e,t,!0,n)},i.prototype.writeFloatBE=function(e,t,n){return N(this,e,t,!1,n)},i.prototype.writeDoubleLE=function(e,t,n){return U(this,e,t,!0,n)},i.prototype.writeDoubleBE=function(e,t,n){return U(this,e,t,!1,n)},i.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},i.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!i.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0);var s;if("number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var a=i.isBuffer(e)?e:new i(e,r),u=a.length;for(s=0;s<n-t;++s)this[s+t]=a[s%u]}return this};var X=/[^+\/0-9A-Za-z-_]/g},{"base64-js":55,ieee754:195}],63:[function(e,t,n){e("../../modules/es6.string.iterator"),e("../../modules/es6.array.from"),t.exports=e("../../modules/_core").Array.from},{"../../modules/_core":97,"../../modules/es6.array.from":166,"../../modules/es6.string.iterator":182}],64:[function(e,t,n){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":164,"../modules/es6.string.iterator":182,"../modules/web.dom.iterable":188}],65:[function(e,t,n){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.is-iterable")},{"../modules/core.is-iterable":165,"../modules/es6.string.iterator":182,"../modules/web.dom.iterable":188}],66:[function(e,t,n){var r=e("../../modules/_core"),i=r.JSON||(r.JSON={stringify:JSON.stringify});t.exports=function(e){return i.stringify.apply(i,arguments)}},{"../../modules/_core":97}],67:[function(e,t,n){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.map"),e("../modules/es7.map.to-json"),t.exports=e("../modules/_core").Map},{"../modules/_core":97,"../modules/es6.map":168,"../modules/es6.object.to-string":178,"../modules/es6.string.iterator":182,"../modules/es7.map.to-json":184,"../modules/web.dom.iterable":188}],68:[function(e,t,n){e("../../modules/es6.number.is-integer"),t.exports=e("../../modules/_core").Number.isInteger},{"../../modules/_core":97,"../../modules/es6.number.is-integer":169}],69:[function(e,t,n){e("../../modules/es6.object.assign"),t.exports=e("../../modules/_core").Object.assign},{"../../modules/_core":97,"../../modules/es6.object.assign":170}],70:[function(e,t,n){e("../../modules/es6.object.create");var r=e("../../modules/_core").Object;t.exports=function(e,t){return r.create(e,t)}},{"../../modules/_core":97,"../../modules/es6.object.create":171}],71:[function(e,t,n){e("../../modules/es6.object.define-properties");var r=e("../../modules/_core").Object;t.exports=function(e,t){return r.defineProperties(e,t)}},{"../../modules/_core":97,"../../modules/es6.object.define-properties":172}],72:[function(e,t,n){e("../../modules/es6.object.define-property");var r=e("../../modules/_core").Object;t.exports=function(e,t,n){return r.defineProperty(e,t,n)}},{"../../modules/_core":97,"../../modules/es6.object.define-property":173}],73:[function(e,t,n){e("../../modules/es6.object.freeze"),t.exports=e("../../modules/_core").Object.freeze},{"../../modules/_core":97,"../../modules/es6.object.freeze":174}],74:[function(e,t,n){e("../../modules/es6.object.get-prototype-of"),t.exports=e("../../modules/_core").Object.getPrototypeOf},{"../../modules/_core":97,"../../modules/es6.object.get-prototype-of":175}],75:[function(e,t,n){e("../../modules/es6.object.keys"),t.exports=e("../../modules/_core").Object.keys},{"../../modules/_core":97,"../../modules/es6.object.keys":176}],76:[function(e,t,n){e("../../modules/es6.object.set-prototype-of"),t.exports=e("../../modules/_core").Object.setPrototypeOf},{"../../modules/_core":97,"../../modules/es6.object.set-prototype-of":177}],77:[function(e,t,n){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.promise"),t.exports=e("../modules/_core").Promise},{"../modules/_core":97,"../modules/es6.object.to-string":178,"../modules/es6.promise":179,"../modules/es6.string.iterator":182,"../modules/web.dom.iterable":188}],78:[function(e,t,n){e("../../modules/es6.reflect.construct"),t.exports=e("../../modules/_core").Reflect.construct},{"../../modules/_core":97,"../../modules/es6.reflect.construct":180}],79:[function(e,t,n){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.set"),e("../modules/es7.set.to-json"),t.exports=e("../modules/_core").Set},{"../modules/_core":97,"../modules/es6.object.to-string":178,"../modules/es6.set":181,"../modules/es6.string.iterator":182,"../modules/es7.set.to-json":185,"../modules/web.dom.iterable":188}],80:[function(e,t,n){e("../../modules/es6.symbol"),e("../../modules/es6.object.to-string"),e("../../modules/es7.symbol.async-iterator"),e("../../modules/es7.symbol.observable"),t.exports=e("../../modules/_core").Symbol},{"../../modules/_core":97,"../../modules/es6.object.to-string":178,"../../modules/es6.symbol":183,"../../modules/es7.symbol.async-iterator":186,"../../modules/es7.symbol.observable":187}],81:[function(e,t,n){e("../../modules/es6.string.iterator"),e("../../modules/web.dom.iterable"),t.exports=e("../../modules/_wks-ext").f("iterator")},{"../../modules/_wks-ext":161,"../../modules/es6.string.iterator":182,"../../modules/web.dom.iterable":188}],82:[function(e,t,n){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],83:[function(e,t,n){t.exports=function(){}},{}],84:[function(e,t,n){t.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},{}],85:[function(e,t,n){var r=e("./_is-object");t.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":118}],86:[function(e,t,n){var r=e("./_for-of");t.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},{"./_for-of":107}],87:[function(e,t,n){var r=e("./_to-iobject"),i=e("./_to-length"),o=e("./_to-index");t.exports=function(e){return function(t,n,s){var a,u=r(t),c=i(u.length),l=o(s,c);if(e&&n!=n){for(;c>l;)if((a=u[l++])!=a)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}},{"./_to-index":153,"./_to-iobject":155,"./_to-length":156}],88:[function(e,t,n){var r=e("./_ctx"),i=e("./_iobject"),o=e("./_to-object"),s=e("./_to-length"),a=e("./_array-species-create");t.exports=function(e,t){var n=1==e,u=2==e,c=3==e,l=4==e,f=6==e,h=5==e||f,d=t||a;return function(t,a,p){for(var m,v,b=o(t),y=i(b),_=r(a,p,3),g=s(y.length),k=0,w=n?d(t,g):u?d(t,0):void 0;g>k;k++)if((h||k in y)&&(m=y[k],v=_(m,k,b),e))if(n)w[k]=v;else if(v)switch(e){case 3:return!0;case 5:return m;case 6:return k;case 2:w.push(m)}else if(l)return!1;return f?-1:c||l?l:w}}},{"./_array-species-create":90,"./_ctx":99,"./_iobject":114,"./_to-length":156,"./_to-object":157}],89:[function(e,t,n){var r=e("./_is-object"),i=e("./_is-array"),o=e("./_wks")("species");t.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},{"./_is-array":116,"./_is-object":118,"./_wks":162}],90:[function(e,t,n){var r=e("./_array-species-constructor");t.exports=function(e,t){return new(r(e))(t)}},{"./_array-species-constructor":89}],91:[function(e,t,n){"use strict";var r=e("./_a-function"),i=e("./_is-object"),o=e("./_invoke"),s=[].slice,a={},u=function(e,t,n){if(!(t in a)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";a[t]=Function("F,a","return new F("+r.join(",")+")")}return a[t](e,n)};t.exports=Function.bind||function(e){var t=r(this),n=s.call(arguments,1),a=function(){var r=n.concat(s.call(arguments));return this instanceof a?u(t,r.length,r):o(t,r,e)};return i(t.prototype)&&(a.prototype=t.prototype),a}},{"./_a-function":82,"./_invoke":113,"./_is-object":118}],92:[function(e,t,n){var r=e("./_cof"),i=e("./_wks")("toStringTag"),o="Arguments"==r(function(){return arguments}()),s=function(e,t){try{return e[t]}catch(e){}};t.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=s(t=Object(e),i))?n:o?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},{"./_cof":93,"./_wks":162}],93:[function(e,t,n){var r={}.toString;t.exports=function(e){return r.call(e).slice(8,-1)}},{}],94:[function(e,t,n){"use strict";var r=e("./_object-dp").f,i=e("./_object-create"),o=e("./_redefine-all"),s=e("./_ctx"),a=e("./_an-instance"),u=e("./_defined"),c=e("./_for-of"),l=e("./_iter-define"),f=e("./_iter-step"),h=e("./_set-species"),d=e("./_descriptors"),p=e("./_meta").fastKey,m=d?"_s":"size",v=function(e,t){var n,r=p(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};t.exports={getConstructor:function(e,t,n,l){var f=e(function(e,r){a(e,f,t,"_i"),e._i=i(null),e._f=void 0,e._l=void 0,e[m]=0,void 0!=r&&c(r,n,e[l],e)});return o(f.prototype,{clear:function(){for(var e=this,t=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete t[n.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var t=this,n=v(t,e);if(n){var r=n.n,i=n.p;delete t._i[n.i],n.r=!0,i&&(i.n=r),r&&(r.p=i),t._f==n&&(t._f=r),t._l==n&&(t._l=i),t[m]--}return!!n},forEach:function(e){a(this,f,"forEach");for(var t,n=s(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.n:this._f;)for(n(t.v,t.k,this);t&&t.r;)t=t.p},has:function(e){return!!v(this,e)}}),d&&r(f.prototype,"size",{get:function(){return u(this[m])}}),f},def:function(e,t,n){var r,i,o=v(e,t);return o?o.v=n:(e._l=o={i:i=p(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=o),r&&(r.n=o),e[m]++,"F"!==i&&(e._i[i]=o)),e},getEntry:v,setStrong:function(e,t,n){l(e,t,function(e,t){this._t=e,this._k=t,this._l=void 0},function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?"keys"==t?f(0,n.k):"values"==t?f(0,n.v):f(0,[n.k,n.v]):(e._t=void 0,f(1))},n?"entries":"values",!n,!0),h(t)}}},{"./_an-instance":84,"./_ctx":99,"./_defined":100,"./_descriptors":101,"./_for-of":107,"./_iter-define":121,"./_iter-step":123,"./_meta":127,"./_object-create":130,"./_object-dp":131,"./_redefine-all":143,"./_set-species":146}],95:[function(e,t,n){var r=e("./_classof"),i=e("./_array-from-iterable");t.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},{"./_array-from-iterable":86,"./_classof":92}],96:[function(e,t,n){"use strict";var r=e("./_global"),i=e("./_export"),o=e("./_meta"),s=e("./_fails"),a=e("./_hide"),u=e("./_redefine-all"),c=e("./_for-of"),l=e("./_an-instance"),f=e("./_is-object"),h=e("./_set-to-string-tag"),d=e("./_object-dp").f,p=e("./_array-methods")(0),m=e("./_descriptors");t.exports=function(e,t,n,v,b,y){var _=r[e],g=_,k=b?"set":"add",w=g&&g.prototype,C={};return m&&"function"==typeof g&&(y||w.forEach&&!s(function(){(new g).entries().next()}))?(g=t(function(t,n){l(t,g,e,"_c"),t._c=new _,void 0!=n&&c(n,b,t[k],t)}),p("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in w&&(!y||"clear"!=e)&&a(g.prototype,e,function(n,r){if(l(this,g,e),!t&&y&&!f(n))return"get"==e&&void 0;var i=this._c[e](0===n?0:n,r);return t?this:i})}),"size"in w&&d(g.prototype,"size",{get:function(){return this._c.size}})):(g=v.getConstructor(t,e,b,k),u(g.prototype,n),o.NEED=!0),h(g,e),C[e]=g,i(i.G+i.W+i.F,C),y||v.setStrong(g,e,b),g}},{"./_an-instance":84,"./_array-methods":88,"./_descriptors":101,"./_export":105,"./_fails":106,"./_for-of":107,"./_global":108,"./_hide":110,"./_is-object":118,"./_meta":127,"./_object-dp":131,"./_redefine-all":143,"./_set-to-string-tag":147}],97:[function(e,t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},{}],98:[function(e,t,n){"use strict";var r=e("./_object-dp"),i=e("./_property-desc");t.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},{"./_object-dp":131,"./_property-desc":142}],99:[function(e,t,n){var r=e("./_a-function");t.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":82}],100:[function(e,t,n){t.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},{}],101:[function(e,t,n){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":106}],102:[function(e,t,n){var r=e("./_is-object"),i=e("./_global").document,o=r(i)&&r(i.createElement);t.exports=function(e){return o?i.createElement(e):{}}},{"./_global":108,"./_is-object":118}],103:[function(e,t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],104:[function(e,t,n){var r=e("./_object-keys"),i=e("./_object-gops"),o=e("./_object-pie");t.exports=function(e){var t=r(e),n=i.f;if(n)for(var s,a=n(e),u=o.f,c=0;a.length>c;)u.call(e,s=a[c++])&&t.push(s);return t}},{"./_object-gops":136,"./_object-keys":139,"./_object-pie":140}],105:[function(e,t,n){var r=e("./_global"),i=e("./_core"),o=e("./_ctx"),s=e("./_hide"),a=function(e,t,n){var u,c,l,f=e&a.F,h=e&a.G,d=e&a.S,p=e&a.P,m=e&a.B,v=e&a.W,b=h?i:i[t]||(i[t]={}),y=b.prototype,_=h?r:d?r[t]:(r[t]||{}).prototype;h&&(n=t);for(u in n)(c=!f&&_&&void 0!==_[u])&&u in b||(l=c?_[u]:n[u],b[u]=h&&"function"!=typeof _[u]?n[u]:m&&c?o(l,r):v&&_[u]==l?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(l):p&&"function"==typeof l?o(Function.call,l):l,p&&((b.virtual||(b.virtual={}))[u]=l,e&a.R&&y&&!y[u]&&s(y,u,l)))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},{"./_core":97,"./_ctx":99,"./_global":108,"./_hide":110}],106:[function(e,t,n){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],107:[function(e,t,n){var r=e("./_ctx"),i=e("./_iter-call"),o=e("./_is-array-iter"),s=e("./_an-object"),a=e("./_to-length"),u=e("./core.get-iterator-method"),c={},l={};(n=t.exports=function(e,t,n,f,h){var d,p,m,v,b=h?function(){return e}:u(e),y=r(n,f,t?2:1),_=0;if("function"!=typeof b)throw TypeError(e+" is not iterable!");if(o(b)){for(d=a(e.length);d>_;_++)if((v=t?y(s(p=e[_])[0],p[1]):y(e[_]))===c||v===l)return v}else for(m=b.call(e);!(p=m.next()).done;)if((v=i(m,y,p.value,t))===c||v===l)return v}).BREAK=c,n.RETURN=l},{"./_an-object":85,"./_ctx":99,"./_is-array-iter":115,"./_iter-call":119,"./_to-length":156,"./core.get-iterator-method":163}],108:[function(e,t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},{}],109:[function(e,t,n){var r={}.hasOwnProperty;t.exports=function(e,t){return r.call(e,t)}},{}],110:[function(e,t,n){var r=e("./_object-dp"),i=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},{"./_descriptors":101,"./_object-dp":131,"./_property-desc":142}],111:[function(e,t,n){t.exports=e("./_global").document&&document.documentElement},{"./_global":108}],112:[function(e,t,n){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":101,"./_dom-create":102,"./_fails":106}],113:[function(e,t,n){t.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},{}],114:[function(e,t,n){var r=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},{"./_cof":93}],115:[function(e,t,n){var r=e("./_iterators"),i=e("./_wks")("iterator"),o=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||o[i]===e)}},{"./_iterators":124,"./_wks":162}],116:[function(e,t,n){var r=e("./_cof");t.exports=Array.isArray||function(e){return"Array"==r(e)}},{"./_cof":93}],117:[function(e,t,n){var r=e("./_is-object"),i=Math.floor;t.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},{"./_is-object":118}],118:[function(e,t,n){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],119:[function(e,t,n){var r=e("./_an-object");t.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},{"./_an-object":85}],120:[function(e,t,n){"use strict";var r=e("./_object-create"),i=e("./_property-desc"),o=e("./_set-to-string-tag"),s={};e("./_hide")(s,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,n){e.prototype=r(s,{next:i(1,n)}),o(e,t+" Iterator")}},{"./_hide":110,"./_object-create":130,"./_property-desc":142,"./_set-to-string-tag":147,"./_wks":162}],121:[function(e,t,n){"use strict";var r=e("./_library"),i=e("./_export"),o=e("./_redefine"),s=e("./_hide"),a=e("./_has"),u=e("./_iterators"),c=e("./_iter-create"),l=e("./_set-to-string-tag"),f=e("./_object-gpo"),h=e("./_wks")("iterator"),d=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(e,t,n,m,v,b,y){c(n,t,m);var _,g,k,w=function(e){if(!d&&e in E)return E[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},C=t+" Iterator",x="values"==v,j=!1,E=e.prototype,S=E[h]||E["@@iterator"]||v&&E[v],T=S||w(v),R=v?x?w("entries"):T:void 0,I="Array"==t?E.entries||S:S;if(I&&(k=f(I.call(new e)))!==Object.prototype&&(l(k,C,!0),r||a(k,h)||s(k,h,p)),x&&S&&"values"!==S.name&&(j=!0,T=function(){return S.call(this)}),r&&!y||!d&&!j&&E[h]||s(E,h,T),u[t]=T,u[C]=p,v)if(_={values:x?T:w("values"),keys:b?T:w("keys"),entries:R},y)for(g in _)g in E||o(E,g,_[g]);else i(i.P+i.F*(d||j),t,_);return _}},{"./_export":105,"./_has":109,"./_hide":110,"./_iter-create":120,"./_iterators":124,"./_library":126,"./_object-gpo":137,"./_redefine":144,"./_set-to-string-tag":147,"./_wks":162}],122:[function(e,t,n){var r=e("./_wks")("iterator"),i=!1;try{var o=[7][r]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(e){}t.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o=[7],s=o[r]();s.next=function(){return{done:n=!0}},o[r]=function(){return s},e(o)}catch(e){}return n}},{"./_wks":162}],123:[function(e,t,n){t.exports=function(e,t){return{value:t,done:!!e}}},{}],124:[function(e,t,n){t.exports={}},{}],125:[function(e,t,n){var r=e("./_object-keys"),i=e("./_to-iobject");t.exports=function(e,t){for(var n,o=i(e),s=r(o),a=s.length,u=0;a>u;)if(o[n=s[u++]]===t)return n}},{"./_object-keys":139,"./_to-iobject":155}],126:[function(e,t,n){t.exports=!0},{}],127:[function(e,t,n){var r=e("./_uid")("meta"),i=e("./_is-object"),o=e("./_has"),s=e("./_object-dp").f,a=0,u=Object.isExtensible||function(){return!0},c=!e("./_fails")(function(){return u(Object.preventExtensions({}))}),l=function(e){s(e,r,{value:{i:"O"+ ++a,w:{}}})},f=function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,r)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[r].i},h=function(e,t){if(!o(e,r)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[r].w},d=function(e){return c&&p.NEED&&u(e)&&!o(e,r)&&l(e),e},p=t.exports={KEY:r,NEED:!1,fastKey:f,getWeak:h,onFreeze:d}},{"./_fails":106,"./_has":109,"./_is-object":118,"./_object-dp":131,"./_uid":159}],128:[function(e,t,n){var r=e("./_global"),i=e("./_task").set,o=r.MutationObserver||r.WebKitMutationObserver,s=r.process,a=r.Promise,u="process"==e("./_cof")(s);t.exports=function(){var e,t,n,c=function(){var r,i;for(u&&(r=s.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){s.nextTick(c)};else if(o){var l=!0,f=document.createTextNode("");new o(c).observe(f,{characterData:!0}),n=function(){f.data=l=!l}}else if(a&&a.resolve){var h=a.resolve();n=function(){h.then(c)}}else n=function(){i.call(r,c)};return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},{"./_cof":93,"./_global":108,"./_task":152}],129:[function(e,t,n){"use strict";var r=e("./_object-keys"),i=e("./_object-gops"),o=e("./_object-pie"),s=e("./_to-object"),a=e("./_iobject"),u=Object.assign;t.exports=!u||e("./_fails")(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r})?function(e,t){for(var n=s(e),u=arguments.length,c=1,l=i.f,f=o.f;u>c;)for(var h,d=a(arguments[c++]),p=l?r(d).concat(l(d)):r(d),m=p.length,v=0;m>v;)f.call(d,h=p[v++])&&(n[h]=d[h]);return n}:u},{"./_fails":106,"./_iobject":114,"./_object-gops":136,"./_object-keys":139,"./_object-pie":140,"./_to-object":157}],130:[function(e,t,n){var r=e("./_an-object"),i=e("./_object-dps"),o=e("./_enum-bug-keys"),s=e("./_shared-key")("IE_PROTO"),a=function(){},u=function(){var t,n=e("./_dom-create")("iframe"),r=o.length;for(n.style.display="none",e("./_html").appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),u=t.F;r--;)delete u.prototype[o[r]];return u()};t.exports=Object.create||function(e,t){var n;return null!==e?(a.prototype=r(e),n=new a,a.prototype=null,n[s]=e):n=u(),void 0===t?n:i(n,t)}},{"./_an-object":85,"./_dom-create":102,"./_enum-bug-keys":103,"./_html":111,"./_object-dps":132,"./_shared-key":148}],131:[function(e,t,n){var r=e("./_an-object"),i=e("./_ie8-dom-define"),o=e("./_to-primitive"),s=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},{"./_an-object":85,"./_descriptors":101,"./_ie8-dom-define":112,"./_to-primitive":158}],132:[function(e,t,n){var r=e("./_object-dp"),i=e("./_an-object"),o=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){i(e);for(var n,s=o(t),a=s.length,u=0;a>u;)r.f(e,n=s[u++],t[n]);return e}},{"./_an-object":85,"./_descriptors":101,"./_object-dp":131,"./_object-keys":139}],133:[function(e,t,n){var r=e("./_object-pie"),i=e("./_property-desc"),o=e("./_to-iobject"),s=e("./_to-primitive"),a=e("./_has"),u=e("./_ie8-dom-define"),c=Object.getOwnPropertyDescriptor;n.f=e("./_descriptors")?c:function(e,t){if(e=o(e),t=s(t,!0),u)try{return c(e,t)}catch(e){}if(a(e,t))return i(!r.f.call(e,t),e[t])}},{"./_descriptors":101,"./_has":109,"./_ie8-dom-define":112,"./_object-pie":140,"./_property-desc":142,"./_to-iobject":155,"./_to-primitive":158}],134:[function(e,t,n){var r=e("./_to-iobject"),i=e("./_object-gopn").f,o={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(e){try{return i(e)}catch(e){return s.slice()}};t.exports.f=function(e){return s&&"[object Window]"==o.call(e)?a(e):i(r(e))}},{"./_object-gopn":135,"./_to-iobject":155}],135:[function(e,t,n){var r=e("./_object-keys-internal"),i=e("./_enum-bug-keys").concat("length","prototype");n.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},{"./_enum-bug-keys":103,"./_object-keys-internal":138}],136:[function(e,t,n){n.f=Object.getOwnPropertySymbols},{}],137:[function(e,t,n){var r=e("./_has"),i=e("./_to-object"),o=e("./_shared-key")("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},{"./_has":109,"./_shared-key":148,"./_to-object":157}],138:[function(e,t,n){var r=e("./_has"),i=e("./_to-iobject"),o=e("./_array-includes")(!1),s=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var n,a=i(e),u=0,c=[];for(n in a)n!=s&&r(a,n)&&c.push(n);for(;t.length>u;)r(a,n=t[u++])&&(~o(c,n)||c.push(n));return c}},{"./_array-includes":87,"./_has":109,"./_shared-key":148,"./_to-iobject":155}],139:[function(e,t,n){var r=e("./_object-keys-internal"),i=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return r(e,i)}},{"./_enum-bug-keys":103,"./_object-keys-internal":138}],140:[function(e,t,n){n.f={}.propertyIsEnumerable},{}],141:[function(e,t,n){var r=e("./_export"),i=e("./_core"),o=e("./_fails");t.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],s={};s[e]=t(n),r(r.S+r.F*o(function(){n(1)}),"Object",s)}},{"./_core":97,"./_export":105,"./_fails":106}],142:[function(e,t,n){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],143:[function(e,t,n){var r=e("./_hide");t.exports=function(e,t,n){for(var i in t)n&&e[i]?e[i]=t[i]:r(e,i,t[i]);return e}},{"./_hide":110}],144:[function(e,t,n){t.exports=e("./_hide")},{"./_hide":110}],145:[function(e,t,n){var r=e("./_is-object"),i=e("./_an-object"),o=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,r){try{(r=e("./_ctx")(Function.call,e("./_object-gopd").f(Object.prototype,"__proto__").set,2))(t,[]),n=!(t instanceof Array)}catch(e){n=!0}return function(e,t){return o(e,t),n?e.__proto__=t:r(e,t),e}}({},!1):void 0),check:o}},{"./_an-object":85,"./_ctx":99,"./_is-object":118,"./_object-gopd":133}],146:[function(e,t,n){"use strict";var r=e("./_global"),i=e("./_core"),o=e("./_object-dp"),s=e("./_descriptors"),a=e("./_wks")("species");t.exports=function(e){var t="function"==typeof i[e]?i[e]:r[e];s&&t&&!t[a]&&o.f(t,a,{configurable:!0,get:function(){return this}})}},{"./_core":97,"./_descriptors":101,"./_global":108,"./_object-dp":131,"./_wks":162}],147:[function(e,t,n){var r=e("./_object-dp").f,i=e("./_has"),o=e("./_wks")("toStringTag");t.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},{"./_has":109,"./_object-dp":131,"./_wks":162}],148:[function(e,t,n){var r=e("./_shared")("keys"),i=e("./_uid");t.exports=function(e){return r[e]||(r[e]=i(e))}},{"./_shared":149,"./_uid":159}],149:[function(e,t,n){var r=e("./_global"),i=r["__core-js_shared__"]||(r["__core-js_shared__"]={});t.exports=function(e){return i[e]||(i[e]={})}},{"./_global":108}],150:[function(e,t,n){var r=e("./_an-object"),i=e("./_a-function"),o=e("./_wks")("species");t.exports=function(e,t){var n,s=r(e).constructor;return void 0===s||void 0==(n=r(s)[o])?t:i(n)}},{"./_a-function":82,"./_an-object":85,"./_wks":162}],151:[function(e,t,n){var r=e("./_to-integer"),i=e("./_defined");t.exports=function(e){return function(t,n){var o,s,a=String(i(t)),u=r(n),c=a.length;return u<0||u>=c?e?"":void 0:(o=a.charCodeAt(u),o<55296||o>56319||u+1===c||(s=a.charCodeAt(u+1))<56320||s>57343?e?a.charAt(u):o:e?a.slice(u,u+2):s-56320+(o-55296<<10)+65536)}}},{"./_defined":100,"./_to-integer":154}],152:[function(e,t,n){var r,i,o,s=e("./_ctx"),a=e("./_invoke"),u=e("./_html"),c=e("./_dom-create"),l=e("./_global"),f=l.process,h=l.setImmediate,d=l.clearImmediate,p=l.MessageChannel,m=0,v={},b=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},y=function(e){b.call(e.data)};h&&d||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return v[++m]=function(){a("function"==typeof e?e:Function(e),t)},r(m),m},d=function(e){delete v[e]},"process"==e("./_cof")(f)?r=function(e){f.nextTick(s(b,e,1))}:p?(i=new p,o=i.port2,i.port1.onmessage=y,r=s(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",y,!1)):r="onreadystatechange"in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this),b.call(e)}}:function(e){setTimeout(s(b,e,1),0)}),t.exports={set:h,clear:d}},{"./_cof":93,"./_ctx":99,"./_dom-create":102,"./_global":108,"./_html":111,"./_invoke":113}],153:[function(e,t,n){var r=e("./_to-integer"),i=Math.max,o=Math.min;t.exports=function(e,t){return e=r(e),e<0?i(e+t,0):o(e,t)}},{"./_to-integer":154}],154:[function(e,t,n){var r=Math.ceil,i=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?i:r)(e)}},{}],155:[function(e,t,n){var r=e("./_iobject"),i=e("./_defined");t.exports=function(e){return r(i(e))}},{"./_defined":100,"./_iobject":114}],156:[function(e,t,n){var r=e("./_to-integer"),i=Math.min;t.exports=function(e){return e>0?i(r(e),9007199254740991):0}},{"./_to-integer":154}],157:[function(e,t,n){var r=e("./_defined");t.exports=function(e){return Object(r(e))}},{"./_defined":100}],158:[function(e,t,n){var r=e("./_is-object");t.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":118}],159:[function(e,t,n){var r=0,i=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+i).toString(36))}},{}],160:[function(e,t,n){var r=e("./_global"),i=e("./_core"),o=e("./_library"),s=e("./_wks-ext"),a=e("./_object-dp").f;t.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:s.f(e)})}},{"./_core":97,"./_global":108,"./_library":126,"./_object-dp":131,"./_wks-ext":161}],161:[function(e,t,n){n.f=e("./_wks")},{"./_wks":162}],162:[function(e,t,n){var r=e("./_shared")("wks"),i=e("./_uid"),o=e("./_global").Symbol,s="function"==typeof o;(t.exports=function(e){return r[e]||(r[e]=s&&o[e]||(s?o:i)("Symbol."+e))}).store=r},{"./_global":108,"./_shared":149,"./_uid":159}],163:[function(e,t,n){var r=e("./_classof"),i=e("./_wks")("iterator"),o=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||o[r(e)]}},{"./_classof":92,"./_core":97,"./_iterators":124,"./_wks":162}],164:[function(e,t,n){var r=e("./_an-object"),i=e("./core.get-iterator-method");t.exports=e("./_core").getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},{"./_an-object":85,"./_core":97,"./core.get-iterator-method":163}],165:[function(e,t,n){var r=e("./_classof"),i=e("./_wks")("iterator"),o=e("./_iterators");t.exports=e("./_core").isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||o.hasOwnProperty(r(t))}},{"./_classof":92,"./_core":97,"./_iterators":124,"./_wks":162}],166:[function(e,t,n){"use strict";var r=e("./_ctx"),i=e("./_export"),o=e("./_to-object"),s=e("./_iter-call"),a=e("./_is-array-iter"),u=e("./_to-length"),c=e("./_create-property"),l=e("./core.get-iterator-method");i(i.S+i.F*!e("./_iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,i,f,h=o(e),d="function"==typeof this?this:Array,p=arguments.length,m=p>1?arguments[1]:void 0,v=void 0!==m,b=0,y=l(h);if(v&&(m=r(m,p>2?arguments[2]:void 0,2)),void 0==y||d==Array&&a(y))for(t=u(h.length),n=new d(t);t>b;b++)c(n,b,v?m(h[b],b):h[b]);else for(f=y.call(h),n=new d;!(i=f.next()).done;b++)c(n,b,v?s(f,m,[i.value,b],!0):i.value);return n.length=b,n}})},{"./_create-property":98,"./_ctx":99,"./_export":105,"./_is-array-iter":115,"./_iter-call":119,"./_iter-detect":122,"./_to-length":156,"./_to-object":157,"./core.get-iterator-method":163}],167:[function(e,t,n){"use strict";var r=e("./_add-to-unscopables"),i=e("./_iter-step"),o=e("./_iterators"),s=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):"keys"==t?i(0,n):"values"==t?i(0,e[n]):i(0,[n,e[n]])},"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},{"./_add-to-unscopables":83,"./_iter-define":121,"./_iter-step":123,"./_iterators":124,"./_to-iobject":155}],168:[function(e,t,n){"use strict";var r=e("./_collection-strong");t.exports=e("./_collection")("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=r.getEntry(this,e);return t&&t.v},set:function(e,t){return r.def(this,0===e?0:e,t)}},r,!0)},{"./_collection":96,"./_collection-strong":94}],169:[function(e,t,n){var r=e("./_export");r(r.S,"Number",{isInteger:e("./_is-integer")})},{"./_export":105,"./_is-integer":117}],170:[function(e,t,n){var r=e("./_export");r(r.S+r.F,"Object",{assign:e("./_object-assign")})},{"./_export":105,"./_object-assign":129}],171:[function(e,t,n){var r=e("./_export");r(r.S,"Object",{create:e("./_object-create")})},{"./_export":105,"./_object-create":130}],172:[function(e,t,n){var r=e("./_export");r(r.S+r.F*!e("./_descriptors"),"Object",{defineProperties:e("./_object-dps")})},{"./_descriptors":101,"./_export":105,"./_object-dps":132}],173:[function(e,t,n){var r=e("./_export");r(r.S+r.F*!e("./_descriptors"),"Object",{defineProperty:e("./_object-dp").f})},{"./_descriptors":101,"./_export":105,"./_object-dp":131}],174:[function(e,t,n){var r=e("./_is-object"),i=e("./_meta").onFreeze;e("./_object-sap")("freeze",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},{"./_is-object":118,"./_meta":127,"./_object-sap":141}],175:[function(e,t,n){var r=e("./_to-object"),i=e("./_object-gpo");e("./_object-sap")("getPrototypeOf",function(){return function(e){return i(r(e))}})},{"./_object-gpo":137,"./_object-sap":141,"./_to-object":157}],176:[function(e,t,n){var r=e("./_to-object"),i=e("./_object-keys");e("./_object-sap")("keys",function(){return function(e){return i(r(e))}})},{"./_object-keys":139,"./_object-sap":141,"./_to-object":157}],177:[function(e,t,n){var r=e("./_export");r(r.S,"Object",{setPrototypeOf:e("./_set-proto").set})},{"./_export":105,"./_set-proto":145}],178:[function(e,t,n){arguments[4][61][0].apply(n,arguments)},{dup:61}],179:[function(e,t,n){"use strict";var r,i,o,s=e("./_library"),a=e("./_global"),u=e("./_ctx"),c=e("./_classof"),l=e("./_export"),f=e("./_is-object"),h=e("./_a-function"),d=e("./_an-instance"),p=e("./_for-of"),m=e("./_species-constructor"),v=e("./_task").set,b=e("./_microtask")(),y=a.TypeError,_=a.process,g=a.Promise,k="process"==c(_=a.process),w=function(){},C=!!function(){try{var t=g.resolve(1),n=(t.constructor={})[e("./_wks")("species")]=function(e){e(w,w)};return(k||"function"==typeof PromiseRejectionEvent)&&t.then(w)instanceof n}catch(e){}}(),x=function(e,t){return e===t||e===g&&t===o},j=function(e){var t;return!(!f(e)||"function"!=typeof(t=e.then))&&t},E=function(e){return x(g,e)?new S(e):new i(e)},S=i=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw y("Bad Promise constructor");t=e,n=r}),this.resolve=h(t),this.reject=h(n)},T=function(e){try{e()}catch(e){return{error:e}}},R=function(e,t){if(!e._n){e._n=!0;var n=e._c;b(function(){for(var r=e._v,i=1==e._s,o=0;n.length>o;)!function(t){var n,o,s=i?t.ok:t.fail,a=t.resolve,u=t.reject,c=t.domain;try{s?(i||(2==e._h&&P(e),e._h=1),!0===s?n=r:(c&&c.enter(),n=s(r),c&&c.exit()),n===t.promise?u(y("Promise-chain cycle")):(o=j(n))?o.call(n,a,u):a(n)):u(r)}catch(e){u(e)}}(n[o++]);e._c=[],e._n=!1,t&&!e._h&&I(e)})}},I=function(e){v.call(a,function(){var t,n,r,i=e._v;if(A(e)&&(t=T(function(){k?_.emit("unhandledRejection",i,e):(n=a.onunhandledrejection)?n({promise:e,reason:i}):(r=a.console)&&r.error&&r.error("Unhandled promise rejection",i)}),e._h=k||A(e)?2:1),e._a=void 0,t)throw t.error})},A=function(e){if(1==e._h)return!1;for(var t,n=e._a||e._c,r=0;n.length>r;)if((t=n[r++]).fail||!A(t.promise))return!1;return!0},P=function(e){v.call(a,function(){var t;k?_.emit("rejectionHandled",e):(t=a.onrejectionhandled)&&t({promise:e,reason:e._v})})},O=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),R(t,!0))},M=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw y("Promise can't be resolved itself");(t=j(e))?b(function(){var r={_w:n,_d:!1};try{t.call(e,u(M,r,1),u(O,r,1))}catch(e){O.call(r,e)}}):(n._v=e,n._s=1,R(n,!1))}catch(e){O.call({_w:n,_d:!1},e)}}};C||(g=function(e){d(this,g,"Promise","_h"),h(e),r.call(this);try{e(u(M,this,1),u(O,this,1))}catch(e){O.call(this,e)}},r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},r.prototype=e("./_redefine-all")(g.prototype,{then:function(e,t){var n=E(m(this,g));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=k?_.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&R(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),S=function(){var e=new r;this.promise=e,this.resolve=u(M,e,1),this.reject=u(O,e,1)}),l(l.G+l.W+l.F*!C,{Promise:g}),e("./_set-to-string-tag")(g,"Promise"),e("./_set-species")("Promise"),o=e("./_core").Promise,l(l.S+l.F*!C,"Promise",{reject:function(e){var t=E(this);return(0,t.reject)(e),t.promise}}),l(l.S+l.F*(s||!C),"Promise",{resolve:function(e){if(e instanceof g&&x(e.constructor,this))return e;var t=E(this);return(0,t.resolve)(e),t.promise}}),l(l.S+l.F*!(C&&e("./_iter-detect")(function(e){g.all(e).catch(w)})),"Promise",{all:function(e){var t=this,n=E(t),r=n.resolve,i=n.reject,o=T(function(){var n=[],o=0,s=1;p(e,!1,function(e){var a=o++,u=!1;n.push(void 0),s++,t.resolve(e).then(function(e){u||(u=!0,n[a]=e,--s||r(n))},i)}),--s||r(n)});return o&&i(o.error),n.promise},race:function(e){var t=this,n=E(t),r=n.reject,i=T(function(){p(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return i&&r(i.error),n.promise}})},{"./_a-function":82,"./_an-instance":84,"./_classof":92,"./_core":97,"./_ctx":99,"./_export":105,"./_for-of":107,"./_global":108,"./_is-object":118,"./_iter-detect":122,"./_library":126,"./_microtask":128,"./_redefine-all":143,"./_set-species":146,"./_set-to-string-tag":147,"./_species-constructor":150,"./_task":152,"./_wks":162}],180:[function(e,t,n){var r=e("./_export"),i=e("./_object-create"),o=e("./_a-function"),s=e("./_an-object"),a=e("./_is-object"),u=e("./_fails"),c=e("./_bind"),l=(e("./_global").Reflect||{}).construct,f=u(function(){function e(){}return!(l(function(){},[],e)instanceof e)}),h=!u(function(){l(function(){})});r(r.S+r.F*(f||h),"Reflect",{construct:function(e,t){o(e),s(t);var n=arguments.length<3?e:o(arguments[2]);if(h&&!f)return l(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(c.apply(e,r))}var u=n.prototype,d=i(a(u)?u:Object.prototype),p=Function.apply.call(e,d,t);return a(p)?p:d}})},{"./_a-function":82,"./_an-object":85,"./_bind":91,"./_export":105,"./_fails":106,"./_global":108,"./_is-object":118,"./_object-create":130}],181:[function(e,t,n){"use strict";var r=e("./_collection-strong");t.exports=e("./_collection")("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return r.def(this,e=0===e?0:e,e)}},r)},{"./_collection":96,"./_collection-strong":94}],182:[function(e,t,n){"use strict";var r=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},{"./_iter-define":121,"./_string-at":151}],183:[function(e,t,n){"use strict";var r=e("./_global"),i=e("./_has"),o=e("./_descriptors"),s=e("./_export"),a=e("./_redefine"),u=e("./_meta").KEY,c=e("./_fails"),l=e("./_shared"),f=e("./_set-to-string-tag"),h=e("./_uid"),d=e("./_wks"),p=e("./_wks-ext"),m=e("./_wks-define"),v=e("./_keyof"),b=e("./_enum-keys"),y=e("./_is-array"),_=e("./_an-object"),g=e("./_to-iobject"),k=e("./_to-primitive"),w=e("./_property-desc"),C=e("./_object-create"),x=e("./_object-gopn-ext"),j=e("./_object-gopd"),E=e("./_object-dp"),S=e("./_object-keys"),T=j.f,R=E.f,I=x.f,A=r.Symbol,P=r.JSON,O=P&&P.stringify,M=d("_hidden"),F=d("toPrimitive"),N={}.propertyIsEnumerable,U=l("symbol-registry"),L=l("symbols"),D=l("op-symbols"),B=Object.prototype,q="function"==typeof A,z=r.QObject,H=!z||!z.prototype||!z.prototype.findChild,W=o&&c(function(){return 7!=C(R({},"a",{get:function(){return R(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=T(B,t);r&&delete B[t],R(e,t,n),r&&e!==B&&R(B,t,r)}:R,V=function(e){var t=L[e]=C(A.prototype);return t._k=e,t},G=q&&"symbol"==typeof A.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof A},J=function(e,t,n){return e===B&&J(D,t,n),_(e),t=k(t,!0),_(n),i(L,t)?(n.enumerable?(i(e,M)&&e[M][t]&&(e[M][t]=!1),n=C(n,{enumerable:w(0,!1)})):(i(e,M)||R(e,M,w(1,{})),e[M][t]=!0),W(e,t,n)):R(e,t,n)},$=function(e,t){_(e);for(var n,r=b(t=g(t)),i=0,o=r.length;o>i;)J(e,n=r[i++],t[n]);return e},K=function(e,t){return void 0===t?C(e):$(C(e),t)},Q=function(e){var t=N.call(this,e=k(e,!0));return!(this===B&&i(L,e)&&!i(D,e))&&(!(t||!i(this,e)||!i(L,e)||i(this,M)&&this[M][e])||t)},X=function(e,t){if(e=g(e),t=k(t,!0),e!==B||!i(L,t)||i(D,t)){var n=T(e,t);return!n||!i(L,t)||i(e,M)&&e[M][t]||(n.enumerable=!0),n}},Y=function(e){for(var t,n=I(g(e)),r=[],o=0;n.length>o;)i(L,t=n[o++])||t==M||t==u||r.push(t);return r},Z=function(e){for(var t,n=e===B,r=I(n?D:g(e)),o=[],s=0;r.length>s;)!i(L,t=r[s++])||n&&!i(B,t)||o.push(L[t]);return o};q||(A=function(){if(this instanceof A)throw TypeError("Symbol is not a constructor!");var e=h(arguments.length>0?arguments[0]:void 0),t=function(n){this===B&&t.call(D,n),i(this,M)&&i(this[M],e)&&(this[M][e]=!1),W(this,e,w(1,n))};return o&&H&&W(B,e,{configurable:!0,set:t}),V(e)},a(A.prototype,"toString",function(){return this._k}),j.f=X,E.f=J,e("./_object-gopn").f=x.f=Y,e("./_object-pie").f=Q,e("./_object-gops").f=Z,o&&!e("./_library")&&a(B,"propertyIsEnumerable",Q,!0),p.f=function(e){return V(d(e))}),s(s.G+s.W+s.F*!q,{Symbol:A});for(var ee="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),te=0;ee.length>te;)d(ee[te++]);for(var ee=S(d.store),te=0;ee.length>te;)m(ee[te++]);s(s.S+s.F*!q,"Symbol",{for:function(e){return i(U,e+="")?U[e]:U[e]=A(e)},keyFor:function(e){if(G(e))return v(U,e);throw TypeError(e+" is not a symbol!")},useSetter:function(){H=!0},useSimple:function(){H=!1}}),s(s.S+s.F*!q,"Object",{create:K,defineProperty:J,defineProperties:$,getOwnPropertyDescriptor:X,getOwnPropertyNames:Y,getOwnPropertySymbols:Z}),P&&s(s.S+s.F*(!q||c(function(){var e=A();return"[null]"!=O([e])||"{}"!=O({a:e})||"{}"!=O(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!G(e)){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);return"function"==typeof(t=r[1])&&(n=t),!n&&y(t)||(t=function(e,t){if(n&&(t=n.call(this,e,t)),!G(t))return t}),r[1]=t,O.apply(P,r)}}}),A.prototype[F]||e("./_hide")(A.prototype,F,A.prototype.valueOf),f(A,"Symbol"),f(Math,"Math",!0),f(r.JSON,"JSON",!0)},{"./_an-object":85,"./_descriptors":101,"./_enum-keys":104,"./_export":105,"./_fails":106,"./_global":108,"./_has":109,"./_hide":110,"./_is-array":116,"./_keyof":125,"./_library":126,"./_meta":127,"./_object-create":130,"./_object-dp":131,"./_object-gopd":133,"./_object-gopn":135,"./_object-gopn-ext":134,"./_object-gops":136,"./_object-keys":139,"./_object-pie":140,"./_property-desc":142,"./_redefine":144,"./_set-to-string-tag":147,"./_shared":149,"./_to-iobject":155,"./_to-primitive":158,"./_uid":159,"./_wks":162,"./_wks-define":160,"./_wks-ext":161}],184:[function(e,t,n){var r=e("./_export");r(r.P+r.R,"Map",{toJSON:e("./_collection-to-json")("Map")})},{"./_collection-to-json":95,"./_export":105}],185:[function(e,t,n){var r=e("./_export");r(r.P+r.R,"Set",{toJSON:e("./_collection-to-json")("Set")})},{"./_collection-to-json":95,"./_export":105}],186:[function(e,t,n){e("./_wks-define")("asyncIterator")},{"./_wks-define":160}],187:[function(e,t,n){e("./_wks-define")("observable")},{"./_wks-define":160}],188:[function(e,t,n){e("./es6.array.iterator");for(var r=e("./_global"),i=e("./_hide"),o=e("./_iterators"),s=e("./_wks")("toStringTag"),a=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],u=0;u<5;u++){var c=a[u],l=r[c],f=l&&l.prototype;f&&!f[s]&&i(f,s,c),o[c]=o.Array}},{"./_global":108,"./_hide":110,"./_iterators":124,"./_wks":162,"./es6.array.iterator":167}],189:[function(e,t,n){n.UINT32=e("./lib/uint32"),n.UINT64=e("./lib/uint64")},{"./lib/uint32":190,"./lib/uint64":191}],190:[function(e,t,n){!function(e){function n(e,t){return this instanceof n?(this._low=0,this._high=0,this.remainder=null,void 0===t?i.call(this,e):"string"==typeof e?o.call(this,e,t):void r.call(this,e,t)):new n(e,t)}function r(e,t){return this._low=0|e,this._high=0|t,this}function i(e){return this._low=65535&e,this._high=e>>>16,this}function o(e,t){var n=parseInt(e,t||10);return this._low=65535&n,this._high=n>>>16,this}n(Math.pow(36,5)),n(Math.pow(16,7)),n(Math.pow(10,9)),n(Math.pow(2,30)),n(36),n(16),n(10),n(2),n.prototype.fromBits=r,n.prototype.fromNumber=i,n.prototype.fromString=o,n.prototype.toNumber=function(){return 65536*this._high+this._low},n.prototype.toString=function(e){return this.toNumber().toString(e||10)},n.prototype.add=function(e){var t=this._low+e._low,n=t>>>16;return n+=this._high+e._high,this._low=65535&t,this._high=65535&n,this},n.prototype.subtract=function(e){return this.add(e.clone().negate())},n.prototype.multiply=function(e){var t,n,r=this._high,i=this._low,o=e._high,s=e._low;return n=i*s,t=n>>>16,t+=r*s,t&=65535,t+=i*o,this._low=65535&n,this._high=65535&t,this},n.prototype.div=function(e){if(0==e._low&&0==e._high)throw Error("division by zero");if(0==e._high&&1==e._low)return this.remainder=new n(0),this;if(e.gt(this))return this.remainder=this.clone(),this._low=0,this._high=0,this;if(this.eq(e))return this.remainder=new n(0),this._low=1,this._high=0,this;for(var t=e.clone(),r=-1;!this.lt(t);)t.shiftLeft(1,!0),r++;for(this.remainder=this.clone(),this._low=0,this._high=0;r>=0;r--)t.shiftRight(1),this.remainder.lt(t)||(this.remainder.subtract(t),r>=16?this._high|=1<<r-16:this._low|=1<<r);return this},n.prototype.negate=function(){var e=1+(65535&~this._low);return this._low=65535&e,this._high=~this._high+(e>>>16)&65535,this},n.prototype.equals=n.prototype.eq=function(e){return this._low==e._low&&this._high==e._high},n.prototype.greaterThan=n.prototype.gt=function(e){return this._high>e._high||!(this._high<e._high)&&this._low>e._low},n.prototype.lessThan=n.prototype.lt=function(e){return this._high<e._high||!(this._high>e._high)&&this._low<e._low},n.prototype.or=function(e){return this._low|=e._low,this._high|=e._high,this},n.prototype.and=function(e){return this._low&=e._low,this._high&=e._high,this},n.prototype.not=function(){return this._low=65535&~this._low,this._high=65535&~this._high,this},n.prototype.xor=function(e){return this._low^=e._low,this._high^=e._high,this},n.prototype.shiftRight=n.prototype.shiftr=function(e){return e>16?(this._low=this._high>>e-16,this._high=0):16==e?(this._low=this._high,this._high=0):(this._low=this._low>>e|this._high<<16-e&65535,this._high>>=e),this},n.prototype.shiftLeft=n.prototype.shiftl=function(e,t){return e>16?(this._high=this._low<<e-16,this._low=0,t||(this._high&=65535)):16==e?(this._high=this._low,this._low=0):(this._high=this._high<<e|this._low>>16-e,this._low=this._low<<e&65535,t||(this._high&=65535)),this},n.prototype.rotateLeft=n.prototype.rotl=function(e){var t=this._high<<16|this._low;return t=t<<e|t>>>32-e,this._low=65535&t,this._high=t>>>16,this},n.prototype.rotateRight=n.prototype.rotr=function(e){var t=this._high<<16|this._low;return t=t>>>e|t<<32-e,this._low=65535&t,this._high=t>>>16,this},n.prototype.clone=function(){return new n(this._low,this._high)},void 0!==t&&t.exports?t.exports=n:e.UINT32=n}(this)},{}],191:[function(e,t,n){!function(e){function n(e,t,s,a){return this instanceof n?(this.remainder=null,"string"==typeof e?o.call(this,e,t):void 0===t?i.call(this,e):void r.apply(this,arguments)):new n(e,t,s,a)}function r(e,t,n,r){return void 0===n?(this._a00=65535&e,this._a16=e>>>16,this._a32=65535&t,this._a48=t>>>16,this):(this._a00=0|e,this._a16=0|t,this._a32=0|n,this._a48=0|r,this)}function i(e){return this._a00=65535&e,this._a16=e>>>16,this._a32=0,this._a48=0,this}function o(e,t){t=t||10,this._a00=0,this._a16=0,this._a32=0,this._a48=0;for(var r=s[t]||new n(Math.pow(t,5)),i=0,o=e.length;i<o;i+=5){var a=Math.min(5,o-i),u=parseInt(e.slice(i,i+a),t);this.multiply(a<5?new n(Math.pow(t,a)):r).add(new n(u))}return this}var s={16:n(Math.pow(16,5)),10:n(Math.pow(10,5)),2:n(Math.pow(2,5))},a={16:n(16),10:n(10),2:n(2)};n.prototype.fromBits=r,n.prototype.fromNumber=i,n.prototype.fromString=o,n.prototype.toNumber=function(){return 65536*this._a16+this._a00},n.prototype.toString=function(e){var t=a[e=e||10]||new n(e);if(!this.gt(t))return this.toNumber().toString(e);for(var r=this.clone(),i=new Array(64),o=63;o>=0&&(r.div(t),i[o]=r.remainder.toNumber().toString(e),r.gt(t));o--);return i[o-1]=r.toNumber().toString(e),i.join("")},n.prototype.add=function(e){var t=this._a00+e._a00,n=t>>>16,r=(n+=this._a16+e._a16)>>>16,i=(r+=this._a32+e._a32)>>>16;return i+=this._a48+e._a48,this._a00=65535&t,this._a16=65535&n,this._a32=65535&r,this._a48=65535&i,this},n.prototype.subtract=function(e){return this.add(e.clone().negate())},n.prototype.multiply=function(e){var t=this._a00,n=this._a16,r=this._a32,i=this._a48,o=e._a00,s=e._a16,a=e._a32,u=t*o,c=u>>>16,l=(c+=t*s)>>>16;c&=65535,l+=(c+=n*o)>>>16;var f=(l+=t*a)>>>16;return l&=65535,l+=n*s,f+=l>>>16,l&=65535,l+=r*o,f+=l>>>16,f+=t*e._a48,f&=65535,f+=n*a,f&=65535,f+=r*s,f&=65535,f+=i*o,this._a00=65535&u,this._a16=65535&c,this._a32=65535&l,this._a48=65535&f,this},n.prototype.div=function(e){if(0==e._a16&&0==e._a32&&0==e._a48){if(0==e._a00)throw Error("division by zero");if(1==e._a00)return this.remainder=new n(0),this}if(e.gt(this))return this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0,this;if(this.eq(e))return this.remainder=new n(0),this._a00=1,this._a16=0,this._a32=0,this._a48=0,this;for(var t=e.clone(),r=-1;!this.lt(t);)t.shiftLeft(1,!0),r++;for(this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0;r>=0;r--)t.shiftRight(1),this.remainder.lt(t)||(this.remainder.subtract(t),r>=48?this._a48|=1<<r-48:r>=32?this._a32|=1<<r-32:r>=16?this._a16|=1<<r-16:this._a00|=1<<r);return this},n.prototype.negate=function(){var e=1+(65535&~this._a00);return this._a00=65535&e,e=(65535&~this._a16)+(e>>>16),this._a16=65535&e,e=(65535&~this._a32)+(e>>>16),this._a32=65535&e,this._a48=~this._a48+(e>>>16)&65535,this},n.prototype.equals=n.prototype.eq=function(e){return this._a48==e._a48&&this._a00==e._a00&&this._a32==e._a32&&this._a16==e._a16},n.prototype.greaterThan=n.prototype.gt=function(e){return this._a48>e._a48||!(this._a48<e._a48)&&(this._a32>e._a32||!(this._a32<e._a32)&&(this._a16>e._a16||!(this._a16<e._a16)&&this._a00>e._a00))},n.prototype.lessThan=n.prototype.lt=function(e){return this._a48<e._a48||!(this._a48>e._a48)&&(this._a32<e._a32||!(this._a32>e._a32)&&(this._a16<e._a16||!(this._a16>e._a16)&&this._a00<e._a00))},n.prototype.or=function(e){return this._a00|=e._a00,this._a16|=e._a16,this._a32|=e._a32,this._a48|=e._a48,this},n.prototype.and=function(e){return this._a00&=e._a00,this._a16&=e._a16,this._a32&=e._a32,this._a48&=e._a48,this},n.prototype.xor=function(e){return this._a00^=e._a00,this._a16^=e._a16,this._a32^=e._a32,this._a48^=e._a48,this},n.prototype.not=function(){return this._a00=65535&~this._a00,this._a16=65535&~this._a16,this._a32=65535&~this._a32,this._a48=65535&~this._a48,this},n.prototype.shiftRight=n.prototype.shiftr=function(e){return e%=64,e>=48?(this._a00=this._a48>>e-48,this._a16=0,this._a32=0,this._a48=0):e>=32?(e-=32,this._a00=65535&(this._a32>>e|this._a48<<16-e),this._a16=this._a48>>e&65535,this._a32=0,this._a48=0):e>=16?(e-=16,this._a00=65535&(this._a16>>e|this._a32<<16-e),this._a16=65535&(this._a32>>e|this._a48<<16-e),this._a32=this._a48>>e&65535,this._a48=0):(this._a00=65535&(this._a00>>e|this._a16<<16-e),this._a16=65535&(this._a16>>e|this._a32<<16-e),this._a32=65535&(this._a32>>e|this._a48<<16-e),this._a48=this._a48>>e&65535),this},n.prototype.shiftLeft=n.prototype.shiftl=function(e,t){return e%=64,e>=48?(this._a48=this._a00<<e-48,this._a32=0,this._a16=0,this._a00=0):e>=32?(e-=32,this._a48=this._a16<<e|this._a00>>16-e,this._a32=this._a00<<e&65535,this._a16=0,this._a00=0):e>=16?(e-=16,this._a48=this._a32<<e|this._a16>>16-e,this._a32=65535&(this._a16<<e|this._a00>>16-e),this._a16=this._a00<<e&65535,this._a00=0):(this._a48=this._a48<<e|this._a32>>16-e,this._a32=65535&(this._a32<<e|this._a16>>16-e),this._a16=65535&(this._a16<<e|this._a00>>16-e),this._a00=this._a00<<e&65535),t||(this._a48&=65535),this},n.prototype.rotateLeft=n.prototype.rotl=function(e){if(0==(e%=64))return this;if(e>=32){var t=this._a00;if(this._a00=this._a32,this._a32=t,t=this._a48,this._a48=this._a16,this._a16=t,32==e)return this;e-=32}var n=this._a48<<16|this._a32,r=this._a16<<16|this._a00,i=n<<e|r>>>32-e,o=r<<e|n>>>32-e;return this._a00=65535&o,this._a16=o>>>16,this._a32=65535&i,this._a48=i>>>16,this},n.prototype.rotateRight=n.prototype.rotr=function(e){if(0==(e%=64))return this;if(e>=32){var t=this._a00;if(this._a00=this._a32,this._a32=t,t=this._a48,this._a48=this._a16,this._a16=t,32==e)return this;e-=32}var n=this._a48<<16|this._a32,r=this._a16<<16|this._a00,i=n>>>e|r<<32-e,o=r>>>e|n<<32-e;return this._a00=65535&o,this._a16=o>>>16,this._a32=65535&i,this._a48=i>>>16,this},n.prototype.clone=function(){return new n(this._a00,this._a16,this._a32,this._a48)},void 0!==t&&t.exports?t.exports=n:e.UINT64=n}(this)},{}],192:[function(e,t,n){t.exports=e("./lib")},{"./lib":193}],193:[function(e,t,n){function r(e){return void 0===e?0:parseInt(e,10)}n.fromSeconds=function(e){if("number"!=typeof e)throw new TypeError("Argument `seconds` must be a number");var t=e%60,n=(e-t)%3600;return{hours:(e-t-n)/3600,minutes:n/60,seconds:t}},n.fromString=function(e){if("string"!=typeof e)throw new TypeError("Argument `string` must be a string");var t=e.match(/^PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?$/);if(null===t||void 0===t[1]&&void 0===t[2]&&void 0===t[3])throw new Error('Could not parse "'+e+'" as a duration.');return{hours:r(t[1]),minutes:r(t[2]),seconds:r(t[3])}},n.toString=function(e){"number"==typeof e&&(e=n.fromSeconds(e));var t="PT";return e.hours>0&&(t+=e.hours+"H"),e.minutes>0&&(t+=e.minutes+"M"),e.seconds>0&&(t+=e.seconds+"S"),"PT"===t&&(t+="0S"),t},n.toSeconds=function(e){var t=e;return"string"==typeof e&&(t=n.fromString(e)),3600*t.hours+60*t.minutes+t.seconds}},{}],194:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,o,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(n=this._events[e],a(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(s(n))for(o=Array.prototype.slice.call(arguments,1),c=n.slice(),r=c.length,u=0;u<r;u++)c[u].apply(this,o);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],195:[function(e,t,n){n.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?i-1:0,h=n?-1:1,d=e[t+f];for(f+=h,o=d&(1<<-l)-1,d>>=-l,l+=a;l>0;o=256*o+e[t+f],f+=h,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;l>0;s=256*s+e[t+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=c}return(d?-1:1)*s*Math.pow(2,o-r)},n.write=function(e,t,n,r,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(s++,u/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(t*u-1)*Math.pow(2,i),s+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;e[n+d]=255&a,d+=p,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[n+d]=255&s,d+=p,s/=256,c-=8);e[n+d-p]|=128*m}},{}],196:[function(e,t,n){!function(){var e={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(t,n){var r="string"==typeof t.initial?{state:t.initial}:t.initial,i=t.terminal||t.final,o=n||t.target||{},s=t.events||[],a=t.callbacks||{},u={},c={},l=function(t){var n=Array.isArray(t.from)?t.from:t.from?[t.from]:[e.WILDCARD];u[t.name]=u[t.name]||{};for(var r=0;r<n.length;r++)c[n[r]]=c[n[r]]||[],c[n[r]].push(t.name),u[t.name][n[r]]=t.to||n[r];t.to&&(c[t.to]=c[t.to]||[])};r&&(r.event=r.event||"startup",l({name:r.event,from:"none",to:r.state}));for(var f=0;f<s.length;f++)l(s[f]);for(var h in u)u.hasOwnProperty(h)&&(o[h]=e.buildEvent(h,u[h]));for(var h in a)a.hasOwnProperty(h)&&(o[h]=a[h]);return o.current="none",o.is=function(e){return Array.isArray(e)?e.indexOf(this.current)>=0:this.current===e},o.can=function(t){return!this.transition&&void 0!==u[t]&&(u[t].hasOwnProperty(this.current)||u[t].hasOwnProperty(e.WILDCARD))},o.cannot=function(e){return!this.can(e)},o.transitions=function(){return(c[this.current]||[]).concat(c[e.WILDCARD]||[])},o.isFinished=function(){return this.is(i)},o.error=t.error||function(e,t,n,r,i,o,s){throw s||o},o.states=function(){return Object.keys(c).sort()},r&&!r.defer&&o[r.event](),o},doCallback:function(t,n,r,i,o,s){if(n)try{return n.apply(t,[r,i,o].concat(s))}catch(n){return t.error(r,i,o,s,e.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",n)}},beforeAnyEvent:function(t,n,r,i,o){return e.doCallback(t,t.onbeforeevent,n,r,i,o)},afterAnyEvent:function(t,n,r,i,o){return e.doCallback(t,t.onafterevent||t.onevent,n,r,i,o)},leaveAnyState:function(t,n,r,i,o){return e.doCallback(t,t.onleavestate,n,r,i,o)},enterAnyState:function(t,n,r,i,o){return e.doCallback(t,t.onenterstate||t.onstate,n,r,i,o)},changeState:function(t,n,r,i,o){return e.doCallback(t,t.onchangestate,n,r,i,o)},beforeThisEvent:function(t,n,r,i,o){return e.doCallback(t,t["onbefore"+n],n,r,i,o)},afterThisEvent:function(t,n,r,i,o){return e.doCallback(t,t["onafter"+n]||t["on"+n],n,r,i,o)},leaveThisState:function(t,n,r,i,o){return e.doCallback(t,t["onleave"+r],n,r,i,o)},enterThisState:function(t,n,r,i,o){return e.doCallback(t,t["onenter"+i]||t["on"+i],n,r,i,o)},beforeEvent:function(t,n,r,i,o){if(!1===e.beforeThisEvent(t,n,r,i,o)||!1===e.beforeAnyEvent(t,n,r,i,o))return!1},afterEvent:function(t,n,r,i,o){e.afterThisEvent(t,n,r,i,o),e.afterAnyEvent(t,n,r,i,o)},leaveState:function(t,n,r,i,o){var s=e.leaveThisState(t,n,r,i,o),a=e.leaveAnyState(t,n,r,i,o);return!1!==s&&!1!==a&&(e.ASYNC===s||e.ASYNC===a?e.ASYNC:void 0)},enterState:function(t,n,r,i,o){e.enterThisState(t,n,r,i,o),e.enterAnyState(t,n,r,i,o)},buildEvent:function(t,n){return function(){var r=this.current,i=n[r]||(n[e.WILDCARD]!=e.WILDCARD?n[e.WILDCARD]:r)||r,o=Array.prototype.slice.call(arguments);if(this.transition)return this.error(t,r,i,o,e.Error.PENDING_TRANSITION,"event "+t+" inappropriate because previous transition did not complete");if(this.cannot(t))return this.error(t,r,i,o,e.Error.INVALID_TRANSITION,"event "+t+" inappropriate in current state "+this.current);if(!1===e.beforeEvent(this,t,r,i,o))return e.Result.CANCELLED;if(r===i)return e.afterEvent(this,t,r,i,o),e.Result.NOTRANSITION;var s=this;this.transition=function(){return s.transition=null,s.current=i,e.enterState(s,t,r,i,o),e.changeState(s,t,r,i,o),e.afterEvent(s,t,r,i,o),e.Result.SUCCEEDED},this.transition.cancel=function(){s.transition=null,e.afterEvent(s,t,r,i,o)};var a=e.leaveState(this,t,r,i,o);return!1===a?(this.transition=null,e.Result.CANCELLED):e.ASYNC===a?e.Result.PENDING:this.transition?this.transition():void 0}}};void 0!==n?(void 0!==t&&t.exports&&(n=t.exports=e),n.StateMachine=e):"undefined"!=typeof window?window.StateMachine=e:"undefined"!=typeof self&&(self.StateMachine=e)}()},{}],197:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/regenerator")),o=r(e("babel-runtime/core-js/get-iterator")),s=r(e("babel-runtime/core-js/symbol/iterator")),a=r(e("babel-runtime/helpers/classCallCheck")),u=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function e(t,n){(0,a.default)(this,e),this.balanceFactor=0,this.key=t,this.value=n,this.parent=null,this.left=null,this.right=null}return(0,u.default)(e,[{key:"update",value:function(e){this.value=e}},{key:"replace",value:function(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}},{key:"isRoot",get:function(){return null===this.parent}},{key:"isLeaf",get:function(){return null===this.left&&null===this.right}},{key:"isLeftChild",get:function(){return this.parent.left===this}}]),e}(),l=function(){function e(t,n){(0,a.default)(this,e),this.isLessThan=t||function(e,t){return e<t},this.isEqual=n||function(e,t){return e===t},this.root=null,this.count=null}return(0,u.default)(e,[{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(e,t){var n=this.getNode(e);n?n.update(t):this.insert(e,t)}},{key:"insert",value:function(e,t){var n=new c(e,t);if(this.count++,this.root){for(var r=this.root;;)if(this.isLessThan(e,r.key)){if(!r.left){r.left=n;break}r=r.left}else{if(!r.right){r.right=n;break}r=r.right}for(n.parent=r,r=n;r.parent;){var i=r.parent,o=i.balanceFactor;if(r.isLeftChild?i.balanceFactor++:i.balanceFactor--,Math.abs(i.balanceFactor)<Math.abs(o))break;if(i.balanceFactor<-1||i.balanceFactor>1){this.rebalance(i);break}r=i}}else this.root=n}},{key:"get",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"delete",value:function(e){var t=this.getNode(e);if(!t||t.key!==e)return null;var n=t.parent,r=t.left,i=t.right;if(!!r!=!!i){var o=r||i;n||o?n&&!o?this.root=o:(n.replace(t,null),this.rebalance(n)):this.root=null}else{for(var s=t.left;s.right;)s=s.right;if(t.left===s)t.isRoot?(this.root=s,s.parent=null):(t.isLeftChild?t.parent.left=s:t.parent.right=s,s.parent=t.parent),s.right=t.right,s.right.parent=s,s.balanceFactor=t.balanceFactor,t={parent:s,isLeftChild:!0};else{var a=s.parent,u=s.left;a.right=u,u&&(u.parent=a),t.isRoot?(this.root=s,s.parent=null):(t.isLeftChild?t.parent.left=s:t.parent.right=s,s.parent=t.parent),s.right=t.right,s.right.parent=s,s.left=t.left,s.left.parent=s,s.balanceFactor=t.balanceFactor,t={parent:a,isLeftChild:!1}}}for(this.count--;t.parent;){var c=t.parent,l=c.balanceFactor;if(t.isLeftChild?c.balanceFactor-=1:c.balanceFactor+=1,Math.abs(c.balanceFactor)>Math.abs(l)){if(!(c.balanceFactor<-1||c.balanceFactor>1))break;if(this.rebalance(c),0!==c.parent.balanceFactor)break;t=c.parent}else t=c}return null}},{key:"getNode",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"rebalance",value:function(e){e.balanceFactor<0?e.right.balanceFactor>0?(this.rotateRight(e.right),this.rotateLeft(e)):this.rotateLeft(e):e.balanceFactor>0&&(e.left.balanceFactor<0?(this.rotateLeft(e.left),this.rotateRight(e)):this.rotateRight(e))}},{key:"rotateLeft",value:function(e){var t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=e,e.parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}},{key:"rotateRight",value:function(e){var t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=e,e.parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}},{key:s.default,value:i.default.mark(function e(){var t,n,r,s,a,u;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,r=void 0,e.prev=3,s=(0,o.default)(this.getIterator());case 5:if(t=(a=s.next()).done){e.next=12;break}return u=a.value,e.next=9,u;case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,r=e.t0;case 18:e.prev=18,e.prev=19,!t&&s.return&&s.return();case 21:if(e.prev=21,!n){e.next=24;break}throw r;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])})},{key:"getIterator",value:i.default.mark(function e(){var t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.root;case 1:if(!t){e.next=7;break}if(!this.isEqual(r,t.key)&&(null!==r||t.left)){e.next=4;break}return e.abrupt("break",7);case 4:t=this.isLessThan(r,t.key)||null===r?t.left:t.right,e.next=1;break;case 7:if(t){e.next=9;break}return e.abrupt("return",null);case 9:n=!0;case 10:if(!n){e.next=28;break}return e.next=13,[t.key,t.value];case 13:if(n=!1,!t.right){e.next=20;break}for(t=t.right;t.left;)t=t.left;n=!0,e.next=26;break;case 20:if(!t.parent){e.next=25;break}n=t.parent.left===t,t=t.parent,e.next=26;break;case 25:return e.abrupt("break",36);case 26:e.next=34;break;case 28:if(!t.parent){e.next=33;break}n=t.parent.left===t,t=t.parent,e.next=34;break;case 33:return e.abrupt("break",36);case 34:e.next=10;break;case 36:return e.abrupt("return",null);case 37:case"end":return e.stop()}},e,this)})},{key:"getReverseIterator",value:i.default.mark(function e(){var t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.root;case 1:if(!t){e.next=7;break}if(!this.isEqual(r,t.key)&&(null!==r||t.right)){e.next=4;break}return e.abrupt("break",7);case 4:t=this.isLessThan(r,t.key)&&null!==r?t.left:t.right,e.next=1;break;case 7:if(t){e.next=9;break}return e.abrupt("return",null);case 9:n=!0;case 10:if(!n){e.next=28;break}return e.next=13,[t.key,t.value];case 13:if(n=!1,!t.left){e.next=20;break}for(t=t.left;t.right;)t=t.right;n=!0,e.next=26;break;case 20:if(!t.parent){e.next=25;break}n=t.parent.right===t,t=t.parent,e.next=26;break;case 25:return e.abrupt("break",36);case 26:e.next=34;break;case 28:if(!t.parent){e.next=33;break}n=t.parent.right===t,t=t.parent,e.next=34;break;case 33:return e.abrupt("break",36);case 34:e.next=10;break;case 36:return e.abrupt("return",null);case 37:case"end":return e.stop()}},e,this)})},{key:"size",get:function(){return this.count}}]),e}();n.TreeMap=l},{"babel-runtime/core-js/get-iterator":23,"babel-runtime/core-js/symbol/iterator":40,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/regenerator":48}],198:[function(e,t,n){!function(e,n){"use strict";"object"==typeof t&&t.exports?t.exports=n():e.log=n()}(this,function(){"use strict";function e(e){return typeof console!==a&&(void 0!==console[e]?t(console,e):void 0!==console.log?t(console,"log"):s)}function t(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function n(e,t,n){return function(){typeof console!==a&&(r.call(this,t,n),this[e].apply(this,arguments))}}function r(e,t){for(var n=0;n<u.length;n++){var r=u[n];this[r]=n<e?s:this.methodFactory(r,e,t)}}function i(t,r,i){return e(t)||n.apply(this,arguments)}function o(e,t,n){function o(e){var t=(u[e]||"silent").toUpperCase();try{return void(window.localStorage[f]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(f)+"="+t+";"}catch(e){}}function s(){var e;try{e=window.localStorage[f]}catch(e){}if(typeof e===a)try{var t=window.document.cookie,n=t.indexOf(encodeURIComponent(f)+"=");n&&(e=/^([^;]+)/.exec(t.slice(n))[1])}catch(e){}return void 0===l.levels[e]&&(e=void 0),e}var c,l=this,f="loglevel";e&&(f+=":"+e),l.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},l.methodFactory=n||i,l.getLevel=function(){return c},l.setLevel=function(t,n){if("string"==typeof t&&void 0!==l.levels[t.toUpperCase()]&&(t=l.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=l.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(c=t,!1!==n&&o(t),r.call(l,t,e),typeof console===a&&t<l.levels.SILENT)return"No console available for logging"},l.setDefaultLevel=function(e){s()||l.setLevel(e,!1)},l.enableAll=function(e){l.setLevel(l.levels.TRACE,e)},l.disableAll=function(e){l.setLevel(l.levels.SILENT,e)};var h=s();null==h&&(h=null==t?"WARN":t),l.setLevel(h,!1)}var s=function(){},a="undefined",u=["trace","debug","info","warn","error"],c=new o,l={};c.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=l[e];return t||(t=l[e]=new o(e,c.getLevel(),c.methodFactory)),t};var f=typeof window!==a?window.log:void 0;return c.noConflict=function(){return typeof window!==a&&window.log===c&&(window.log=f),c},c})},{}],199:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(e){function t(t){var n=e.call(this)||this;return n.minDelay=t.min,n.maxDelay=t.max,n.initialDelay=t.initial||0,n.maxAttemptsCount=t.maxAttemptsCount||0,n.maxAttemptsTime=t.maxAttemptsTime||0,n.randomness=t.randomness||0,n.inProgress=!1,n.attemptNum=0,n.prevDelay=0,n.currDelay=0,n}return r(t,e),t.prototype.attempt=function(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt",this)},t.prototype.nextDelay=function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;var t=this.currDelay+this.prevDelay;return this.prevDelay=this.currDelay,this.currDelay=t,t},t.prototype.randomize=function(e){var t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)},t.prototype.scheduleAttempt=function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));var n=this.nextDelay(e);n=this.randomize(n),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+n&&(this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),this.reject(new Error("Maximum attempt time limit reached"))),this.timeout=setTimeout(function(){return t.attempt()},n)},t.prototype.cleanup=function(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0},t.prototype.start=function(){var e=this;if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new Promise(function(t,n){e.resolve=t,e.reject=n,e.startTimestamp=Date.now(),e.scheduleAttempt(e.initialDelay)})},t.prototype.cancel=function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))},t.prototype.succeeded=function(e){this.emit("succeeded",e),this.resolve(e)},t.prototype.failed=function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)},t.prototype.run=function(e){var t=this;return this.on("attempt",function(){e().then(function(e){return t.succeeded(e)}).catch(function(e){return t.failed(e)})}),this.start()},t}(e("events").EventEmitter);n.Retrier=i,n.default=i},{events:194}],200:[function(e,t,n){(function(e){(function(){"use strict";function r(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function i(e,t,n){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\d.]+$/.exec(e)])&&(e="Windows "+r),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),e=s(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function o(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&r<=g)for(;++n<r;)t(e[n],n,e);else a(e,t)}function s(e){return e=h(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:r(e)}function a(e,t){for(var n in e)x.call(e,n)&&t(e[n],n,e)}function u(e){return null==e?r(e):j.call(e).slice(8,-1)}function c(e,t){var n=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[t])}function l(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function f(e,t){var n=null;return o(e,function(r,i){n=t(n,r,i,e)}),n}function h(e){return String(e).replace(/^ +| +$/g,"")}function d(e){function t(t){return f(t,function(t,n){var r=n.pattern||l(n);return!t&&(t=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((t=String(n.label&&!RegExp(r,"i").test(n.label)?n.label:t).split("/"))[1]&&!/[\d.]+/.test(t[0])&&(t[0]+=" "+t[1]),n=n.label||n,t=s(t[0].replace(RegExp(r,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),t})}function n(){return this.description||""}var r=m,o=e&&"object"==typeof e&&"String"!=u(e);o&&(r=e,e=null);var p=r.navigator||{},b=p.userAgent||"";e||(e=b);var y,_,g=o||w==v,C=o?!!p.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(j.toString()),x=o?"Object":"ScriptBridgingProxyObject",E=o?"Object":"Environment",S=o&&r.java?"JavaPackage":u(r.java),T=o?"Object":"RuntimeObject",R=/\bJava/.test(S)&&r.java,I=R&&u(r.environment)==E,A=R?"a":"",P=R?"b":"",O=r.document||{},M=r.operamini||r.opera,F=k.test(F=o&&M?M["[[Class]]"]:u(M))?F:M=null,N=e,U=[],L=null,D=e==b,B=D&&M&&"function"==typeof M.version&&M.version(),q=function(t){return f(t,function(t,n){return t||RegExp("\\b"+(n.pattern||l(n))+"\\b","i").exec(e)&&(n.label||n)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),z=function(t){return f(t,function(t,n){return t||RegExp("\\b"+(n.pattern||l(n))+"\\b","i").exec(e)&&(n.label||n)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt","SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),H=t([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation 3","PlayStation 4","PlayStation Vita","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),W=function(t){return f(t,function(t,n,r){return t||(n[H]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(H)]||RegExp("\\b"+l(r)+"(?:\\b|\\w*\\d)","i").exec(e))&&r})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{"PlayStation 4":1,"PlayStation 3":1,"PlayStation Vita":1}}),V=function(t){return f(t,function(t,n){var r=n.pattern||l(n);return!t&&(t=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(t=i(t,r,n.label||n)),t})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(q&&(q=[q]),W&&!H&&(H=t([W])),(y=/\bGoogle TV\b/.exec(H))&&(H=y[0]),/\bSimulator\b/i.test(e)&&(H=(H?H+" ":"")+"Simulator"),"Opera Mini"==z&&/\bOPiOS\b/.test(e)&&U.push("running in Turbo/Uncompressed mode"),"IE"==z&&/\blike iPhone OS\b/.test(e)?(y=d(e.replace(/like iPhone OS/,"")),W=y.manufacturer,H=y.product):/^iP/.test(H)?(z||(z="Safari"),V="iOS"+((y=/ OS ([\d_]+)/i.exec(e))?" "+y[1].replace(/_/g,"."):"")):"Konqueror"!=z||/buntu/i.test(V)?W&&"Google"!=W&&(/Chrome/.test(z)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(H))||/\bAndroid\b/.test(V)&&/^Chrome/.test(z)&&/\bVersion\//i.test(e)?(z="Android Browser",V=/\bAndroid\b/.test(V)?V:"Android"):"Silk"==z?(/\bMobi/i.test(e)||(V="Android",U.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&U.unshift("accelerated")):"PaleMoon"==z&&(y=/\bFirefox\/([\d.]+)\b/.exec(e))?U.push("identifying as Firefox "+y[1]):"Firefox"==z&&(y=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(V||(V="Firefox OS"),H||(H=y[1])):z&&!(y=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec(z))||(z&&!H&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(y+"/")+8))&&(z=null),(y=H||W||V)&&(H||W||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(V))&&(z=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(V)?V:y)+" Browser")):V="Kubuntu",B||(B=function(t){return f(t,function(t,n){return t||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null})}(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|Silk(?!/[\\d.]+$))","Version",l(z),"(?:Firefox|Minefield|NetFront)"])),(y="iCab"==q&&parseFloat(B)>3&&"WebKit"||/\bOpera\b/.test(z)&&(/\bOPR\b/.test(e)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(q)&&"WebKit"||!q&&/\bMSIE\b/i.test(e)&&("Mac OS"==V?"Tasman":"Trident")||"WebKit"==q&&/\bPlayStation\b(?! Vita\b)/i.test(z)&&"NetFront")&&(q=[y]),"IE"==z&&(y=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(z+=" Mobile",V="Windows Phone "+(/\+$/.test(y)?y:y+".x"),U.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(z="IE Mobile",V="Windows Phone 8.x",U.unshift("desktop mode"),B||(B=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=z&&"Trident"==q&&(y=/\brv:([\d.]+)/.exec(e))&&(z&&U.push("identifying as "+z+(B?" "+B:"")),z="IE",B=y[1]),D){if(c(r,"global"))if(R&&(y=R.lang.System,N=y.getProperty("os.arch"),V=V||y.getProperty("os.name")+" "+y.getProperty("os.version")),g&&c(r,"system")&&(y=[r.system])[0]){V||(V=y[0].os||null);try{y[1]=r.require("ringo/engine").version,B=y[1].join("."),z="RingoJS"}catch(e){y[0].global.system==r.system&&(z="Narwhal")}}else"object"==typeof r.process&&!r.process.browser&&(y=r.process)?(z="Node.js",N=y.arch,V=y.platform,B=/[\d.]+/.exec(y.version)[0]):I&&(z="Rhino");else u(y=r.runtime)==x?(z="Adobe AIR",V=y.flash.system.Capabilities.os):u(y=r.phantom)==T?(z="PhantomJS",B=(y=y.version||null)&&y.major+"."+y.minor+"."+y.patch):"number"==typeof O.documentMode&&(y=/\bTrident\/(\d+)/i.exec(e))&&(B=[B,O.documentMode],(y=+y[1]+4)!=B[1]&&(U.push("IE "+B[1]+" mode"),q&&(q[1]=""),B[1]=y),B="IE"==z?String(B[1].toFixed(1)):B[0]);V=V&&s(V)}B&&(y=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(B)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(D&&p.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&(L=/b/i.test(y)?"beta":"alpha",B=B.replace(RegExp(y+"\\+?$"),"")+("beta"==L?P:A)+(/\d+\+?/.exec(y)||"")),"Fennec"==z||"Firefox"==z&&/\b(?:Android|Firefox OS)\b/.test(V)?z="Firefox Mobile":"Maxthon"==z&&B?B=B.replace(/\.[\d.]+/,".x"):/\bXbox\b/i.test(H)?(V=null,"Xbox 360"==H&&/\bIEMobile\b/.test(e)&&U.unshift("mobile mode")):!/^(?:Chrome|IE|Opera)$/.test(z)&&(!z||H||/Browser|Mobi/.test(z))||"Windows CE"!=V&&!/Mobi/i.test(e)?"IE"==z&&D&&null===r.external?U.unshift("platform preview"):(/\bBlackBerry\b/.test(H)||/\bBB10\b/.test(e))&&(y=(RegExp(H.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||B)?(y=[y,/BB10/.test(e)],V=(y[1]?(H=null,W="BlackBerry"):"Device Software")+" "+y[0],B=null):this!=a&&"Wii"!=H&&(D&&M||/Opera/.test(z)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==z&&/\bOS X (?:\d+\.){2,}/.test(V)||"IE"==z&&(V&&!/^Win/.test(V)&&B>5.5||/\bWindows XP\b/.test(V)&&B>8||8==B&&!/\bTrident\b/.test(e)))&&!k.test(y=d.call(a,e.replace(k,"")+";"))&&y.name&&(y="ing as "+y.name+((y=y.version)?" "+y:""),k.test(z)?(/\bIE\b/.test(y)&&"Mac OS"==V&&(V=null),y="identify"+y):(y="mask"+y,z=F?s(F.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(y)&&(V=null),D||(B=null)),q=["Presto"],U.push(y)):z+=" Mobile",(y=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(y=[parseFloat(y.replace(/\.(\d)$/,".0$1")),y],"Safari"==z&&"+"==y[1].slice(-1)?(z="WebKit Nightly",L="alpha",B=y[1].slice(0,-1)):B!=y[1]&&B!=(y[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1])||(B=null),y[1]=(/\bChrome\/([\d.]+)/i.exec(e)||0)[1],537.36==y[0]&&537.36==y[2]&&parseFloat(y[1])>=28&&"WebKit"==q&&(q=["Blink"]),D&&(C||y[1])?(q&&(q[1]="like Chrome"),y=y[1]||(y=y[0],y<530?1:y<532?2:y<532.05?3:y<533?4:y<534.03?5:y<534.07?6:y<534.1?7:y<534.13?8:y<534.16?9:y<534.24?10:y<534.3?11:y<535.01?12:y<535.02?"13+":y<535.07?15:y<535.11?16:y<535.19?17:y<536.05?18:y<536.1?19:y<537.01?20:y<537.11?"21+":y<537.13?23:y<537.18?24:y<537.24?25:y<537.36?26:"Blink"!=q?"27":"28")):(q&&(q[1]="like Safari"),y=y[0],y=y<400?1:y<500?2:y<526?3:y<533?4:y<534?"4+":y<535?5:y<537?6:y<538?7:y<601?8:"8"),q&&(q[1]+=" "+(y+="number"==typeof y?".x":/[.+]/.test(y)?"":"+")),"Safari"==z&&(!B||parseInt(B)>45)&&(B=y)),"Opera"==z&&(y=/\bzbov|zvav$/.exec(V))?(z+=" ",U.unshift("desktop mode"),"zvav"==y?(z+="Mini",B=null):z+="Mobile",V=V.replace(RegExp(" *"+y+"$"),"")):"Safari"==z&&/\bChrome\b/.exec(q&&q[1])&&(U.unshift("desktop mode"),z="Chrome Mobile",B=null,/\bOS X\b/.test(V)?(W="Apple",V="iOS 4.3+"):V=null),B&&0==B.indexOf(y=/[\d.]+$/.exec(V))&&e.indexOf("/"+y+"-")>-1&&(V=h(V.replace(y,""))),q&&!/\b(?:Avant|Nook)\b/.test(z)&&(/Browser|Lunascape|Maxthon/.test(z)||"Safari"!=z&&/^iOS/.test(V)&&/\bSafari\b/.test(q[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Sleipnir|Web)/.test(z)&&q[1])&&(y=q[q.length-1])&&U.push(y),U.length&&(U=["("+U.join("; ")+")"]),W&&H&&H.indexOf(W)<0&&U.push("on "+W),H&&U.push((/^on /.test(U[U.length-1])?"":"on ")+H),V&&(y=/ ([\d.+]+)$/.exec(V),_=y&&"/"==V.charAt(V.length-y[0].length-1),V={architecture:32,family:y&&!_?V.replace(y[0],""):V,version:y?y[1]:null,toString:function(){var e=this.version;return this.family+(e&&!_?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(y=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(N))&&!/\bi686\b/i.test(N)?(V&&(V.architecture=64,V.family=V.family.replace(RegExp(" *"+y),"")),z&&(/\bWOW64\b/i.test(e)||D&&/\w(?:86|32)$/.test(p.cpuClass||p.platform)&&!/\bWin64; x64\b/i.test(e))&&U.unshift("32-bit")):V&&/^OS X/.test(V.family)&&"Chrome"==z&&parseFloat(B)>=39&&(V.architecture=64),e||(e=null);var G={};return G.description=e,G.layout=q&&q[0],G.manufacturer=W,G.name=z,G.prerelease=L,G.product=H,G.ua=e,G.version=z&&B,G.os=V||{architecture:null,family:null,version:null,toString:function(){return"null"}},G.parse=d,G.toString=n,G.version&&U.unshift(B),G.name&&U.unshift(z),V&&z&&(V!=String(V).split(" ")[0]||V!=z.split(" ")[0]&&!H)&&U.push(H?"("+V+")":"on "+V),U.length&&(G.description=U.join(" ")),G}var p={function:!0,object:!0},m=p[typeof window]&&window||this,v=m,b=p[typeof n]&&n,y=p[typeof t]&&t&&!t.nodeType&&t,_=b&&y&&"object"==typeof e&&e;!_||_.global!==_&&_.window!==_&&_.self!==_||(m=_);var g=Math.pow(2,53)-1,k=/\bOpera/,w=this,C=Object.prototype,x=C.hasOwnProperty,j=C.toString,E=d();b&&y?a(E,function(e,t){b[t]=e}):m.platform=E}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],201:[function(e,t,n){t.exports=e("./lib/checks")},{"./lib/checks":202}],202:[function(e,t,n){function r(e,t,n,r){n=n||"";var i=new e(u.format.apply(this,[n].concat(r)));throw Error.captureStackTrace(i,t),i}function i(e,t,n){r(c.IllegalArgumentError,e,t,n)}function o(e,t,n){r(c.IllegalStateError,e,t,n)}function s(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array"}return t}function a(e){return function(t,n){var r=s(t);if(r==e)return t;i(arguments.callee,n||'Expected "'+e+'" but got "'+r+'".',Array.prototype.slice.call(arguments,2))}}var u=e("util"),c=t.exports=e("./errors");t.exports.checkArgument=function(e,t){e||i(arguments.callee,t,Array.prototype.slice.call(arguments,2))},t.exports.checkState=function(e,t){e||o(arguments.callee,t,Array.prototype.slice.call(arguments,2))},t.exports.checkIsDef=function(e,t){if(void 0!==e)return e;i(arguments.callee,t||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},t.exports.checkIsDefAndNotNull=function(e,t){if(null!=e)return e;i(arguments.callee,t||'Expected value to be defined and not null but got "'+s(e)+'".',Array.prototype.slice.call(arguments,2))},t.exports.checkIsString=a("string"),t.exports.checkIsArray=a("array"),t.exports.checkIsNumber=a("number"),t.exports.checkIsBoolean=a("boolean"),t.exports.checkIsFunction=a("function"),t.exports.checkIsObject=a("object")},{"./errors":203,util:253}],203:[function(e,t,n){function r(e){Error.call(this,e),this.message=e}function i(e){Error.call(this,e),this.message=e}var o=e("util");o.inherits(r,Error),r.prototype.name="IllegalArgumentError",o.inherits(i,Error),i.prototype.name="IllegalStateError",t.exports.IllegalStateError=i,t.exports.IllegalArgumentError=r},{util:253}],204:[function(e,t,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(f===setTimeout)return setTimeout(e,0);if((f===r||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function s(e){if(h===clearTimeout)return clearTimeout(e);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function a(){v&&p&&(v=!1,p.length?m=p.concat(m):b=-1,m.length&&u())}function u(){if(!v){var e=o(a);v=!0;for(var t=m.length;t;){for(p=m,m=[];++b<t;)p&&p[b].run();b=-1,t=m.length}p=null,v=!1,s(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var f,h,d=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:r}catch(e){f=r}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(e){h=i}}();var p,m=[],v=!1,b=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];m.push(new c(e,t)),1!==m.length||v||o(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],205:[function(e,t,n){(function(n){var r="object"==typeof n?n:"object"==typeof window?window:"object"==typeof self?self:this,i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,o=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,t.exports=e("./runtime"),i)r.regeneratorRuntime=o;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./runtime":206}],206:[function(e,t,n){(function(e,n){!function(n){"use strict";function r(e,t,n,r){var i=t&&t.prototype instanceof o?t:o,s=Object.create(i.prototype),a=new p(r||[]);return s._invoke=l(e,n,a),s}function i(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function o(){}function s(){}function a(){}function u(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function c(t){function n(e,r,o,s){var a=i(t[e],t,r);if("throw"!==a.type){var u=a.arg,c=u.value;return c&&"object"==typeof c&&_.call(c,"__await")?Promise.resolve(c.__await).then(function(e){n("next",e,o,s)},function(e){n("throw",e,o,s)}):Promise.resolve(c).then(function(e){u.value=e,o(u)},s)}s(a.arg)}function r(e,t){function r(){return new Promise(function(r,i){n(e,t,r,i)})}return o=o?o.then(r,r):r()}"object"==typeof e&&e.domain&&(n=e.domain.bind(n));var o;this._invoke=r}function l(e,t,n){var r=j;return function(o,s){if(r===S)throw new Error("Generator is already running");if(r===T){if("throw"===o)throw s;return v()}for(n.method=o,n.arg=s;;){var a=n.delegate;if(a){var u=f(a,n);if(u){if(u===R)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===j)throw r=T,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=S;var c=i(e,t,n);if("normal"===c.type){if(r=n.done?T:E,c.arg===R)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=T,n.method="throw",n.arg=c.arg)}}}function f(e,t){var n=e.iterator[t.method];if(n===b){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=b,f(e,t),"throw"===t.method))return R;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return R}var r=i(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,R;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=b),t.delegate=null,R):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,R)}function h(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function d(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(h,this),this.reset(!0)}function m(e){if(e){var t=e[k];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(_.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=b,t.done=!0,t};return r.next=r}}return{next:v}}function v(){return{value:b,done:!0}}var b,y=Object.prototype,_=y.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},k=g.iterator||"@@iterator",w=g.toStringTag||"@@toStringTag",C="object"==typeof t,x=n.regeneratorRuntime;if(x)C&&(t.exports=x);else{(x=n.regeneratorRuntime=C?t.exports:{}).wrap=r;var j="suspendedStart",E="suspendedYield",S="executing",T="completed",R={},I={};I[k]=function(){return this};var A=Object.getPrototypeOf,P=A&&A(A(m([])));P&&P!==y&&_.call(P,k)&&(I=P);var O=a.prototype=o.prototype=Object.create(I);s.prototype=O.constructor=a,a.constructor=s,a[w]=s.displayName="GeneratorFunction",x.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===s||"GeneratorFunction"===(t.displayName||t.name))},x.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,w in e||(e[w]="GeneratorFunction")),e.prototype=Object.create(O),e},x.awrap=function(e){return{__await:e}},u(c.prototype),x.AsyncIterator=c,x.async=function(e,t,n,i){var o=new c(r(e,t,n,i));return x.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},u(O),O[w]="Generator",O.toString=function(){return"[object Generator]"},x.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},x.values=m,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=b,this.done=!1,this.delegate=null,this.method="next",this.arg=b,this.tryEntries.forEach(d),!e)for(var t in this)"t"===t.charAt(0)&&_.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=b)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,r){return o.type="throw",o.arg=e,n.next=t,r&&(n.method="next",n.arg=b),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var s=_.call(i,"catchLoc"),a=_.call(i,"finallyLoc");if(s&&a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&_.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,R):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),R},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),d(n),R}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;d(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:m(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=b),R}}}}("object"==typeof n?n:"object"==typeof window?window:"object"==typeof self?self:this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:204}],207:[function(e,t,n){(function(r){!function(e){if("object"==typeof n&&void 0!==t)t.exports=e();else{("undefined"!=typeof window?window:void 0!==r?r:"undefined"!=typeof self?self:this).rfc6902=e()}}(function(){return function t(n,r,i){function o(a,u){if(!r[a]){if(!n[a]){var c="function"==typeof e&&e;if(!u&&c)return c(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=r[a]={exports:{}};n[a][0].call(f.exports,function(e){return o(n[a][1][e]||e)},f,f.exports,t,n,r,i)}return r[a].exports}for(var s="function"==typeof e&&e,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){"use strict";function r(e){var t=e.op;return"remove"===t||"replace"===t||"copy"===t||"move"===t}function i(e,t){var n={};for(var r in e)n[r]=1;for(var i in t)delete n[i];return Object.keys(n)}function o(e){var t={};e.forEach(function(e){for(var n in e)t[n]=(t[n]||0)+1});var n=e.length;for(var r in t)t[r]<n&&delete t[r];return Object.keys(t)}function s(e){return void 0===e?"undefined":null===e?"null":Array.isArray(e)?"array":typeof e}function a(e){return"add"===e.op}function u(e){return"remove"===e.op}function c(e,t,n){function r(n,o){var s=i[n+","+o];if(void 0===s){if(m(e[n-1],t[o-1]))s=r(n-1,o-1);else{var a=[];if(n>0){var u=r(n-1,o);a.push({operations:u.operations.concat({op:"remove",index:n-1}),cost:u.cost+1})}if(o>0){var c=r(n,o-1);a.push({operations:c.operations.concat({op:"add",index:n-1,value:t[o-1]}),cost:c.cost+1})}if(n>0&&o>0){var l=r(n-1,o-1);a.push({operations:l.operations.concat({op:"replace",index:n-1,original:e[n-1],value:t[o-1]}),cost:l.cost+1})}s=a.sort(function(e,t){return e.cost-t.cost})[0]}i[n+","+o]=s}return s}var i={"0,0":{operations:[],cost:0}},o=isNaN(e.length)||e.length<=0?0:e.length,s=isNaN(t.length)||t.length<=0?0:t.length,c=r(o,s).operations.reduce(function(e,t){var r=d(e,2),i=r[0],s=r[1];if(a(t)){var c=t.index+1+s,l=c<o+s?String(c):"-",f={op:t.op,path:n.add(l).toString(),value:t.value};return[i.concat(f),s+1]}if(u(t)){f={op:t.op,path:n.add(String(t.index+s)).toString()};return[i.concat(f),s-1]}var m=n.add(String(t.index+s)),v=h(t.original,t.value,m);return[i.concat.apply(i,p(v)),s]},[[],0]),l=d(c,2),f=l[0];return l[1],f}function l(e,t,n){var r=[];return i(e,t).forEach(function(e){r.push({op:"remove",path:n.add(e).toString()})}),i(t,e).forEach(function(e){r.push({op:"add",path:n.add(e).toString(),value:t[e]})}),o([e,t]).forEach(function(i){r.push.apply(r,p(h(e[i],t[i],n.add(i))))}),r}function f(e,t,n){return m(e,t)?[]:[{op:"replace",path:n.toString(),value:t}]}function h(e,t,n){var r=s(e),i=s(t);return"array"==r&&"array"==i?c(e,t,n):"object"==r&&"object"==i?l(e,t,n):f(e,t,n)}var d=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){for(var n,r=[],i=e[Symbol.iterator]();!(n=i.next()).done&&(r.push(n.value),!t||r.length!==t););return r}throw new TypeError("Invalid attempt to destructure non-iterable instance")},p=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)};n.isDestructive=r,n.subtract=i,n.intersection=o,n.objectType=s,n.diffArrays=c,n.diffObjects=l,n.diffValues=f,n.diffAny=h,Object.defineProperty(n,"__esModule",{value:!0});var m=e("./equal").compare},{"./equal":2}],2:[function(e,t,n){"use strict";function r(e,t){for(var n=[],r=0,i=e.length;r<i;r++)n.push([e[r],t[r]]);return n}function i(e,t){return e.length===t.length&&r(e,t).every(function(e){return s(e[0],e[1])})}function o(e,t){var n=Object.keys(e);return!!i(n,Object.keys(t))&&n.every(function(n){return s(e[n],t[n])})}function s(e,t){return e===t||(Array.isArray(e)&&Array.isArray(t)?i(e,t):Object(e)===e&&Object(t)===t&&o(e,t))}n.compare=s,Object.defineProperty(n,"__esModule",{value:!0})},{}],3:[function(e,t,n){"use strict";var r=function e(t,n,r){var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i&&i.writable)return i.value;var s=i.get;return void 0!==s?s.call(r):void 0},i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};Object.defineProperty(n,"__esModule",{value:!0}),n.MissingError=function(e){function t(e){o(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,"Value required at path: "+e),this.path=e,this.name=this.constructor.name}return i(t,e),t}(Error),n.InvalidOperationError=function(e){function t(e){o(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,"Invalid operation: "+e),this.op=e,this.name=this.constructor.name}return i(t,e),t}(Error),n.TestError=function(e){function t(e,n){o(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,"Test failed: "+e+" != "+n),this.actual=e,this.expected=n,this.name=this.constructor.name,this.actual=e,this.expected=n}return i(t,e),t}(Error)},{}],4:[function(e,t,n){"use strict";function r(e,t){return t.map(function(t){var n=c[t.op];return void 0===n?new a(t.op):n(e,t)})}function i(e,t){var n=new u;return f(e,t,n)}function o(e,t){var n=u.fromJSON(t).evaluate(e);if(void 0!==n)return{op:"test",path:t,value:n.value}}function s(e,t){var n=new Array;return t.filter(h).forEach(function(t){var r=o(e,t.path);if(r&&n.push(r),"from"in t){var i=o(e,t.from);i&&n.push(i)}}),n}n.applyPatch=r,n.createPatch=i,n.createTests=s,Object.defineProperty(n,"__esModule",{value:!0});var a=e("./errors").InvalidOperationError,u=e("./pointer").Pointer,c=function(e){return e&&e.__esModule?e:{default:e}}(e("./patch")),l=e("./diff"),f=l.diffAny,h=l.isDestructive},{"./diff":1,"./errors":3,"./patch":5,"./pointer":6}],5:[function(e,t,n){"use strict";function r(e,t,n){Array.isArray(e)?"-"==t?e.push(n):e.splice(t,0,n):e[t]=n}function i(e,t){Array.isArray(e)?e.splice(t,1):delete e[t]}function o(e,t){var n=f.fromJSON(t.path).evaluate(e);return void 0===n.parent?new p(t.path):(r(n.parent,n.key,t.value),null)}function s(e,t){var n=f.fromJSON(t.path).evaluate(e);return void 0===n.value?new p(t.path):(i(n.parent,n.key),null)}function a(e,t){var n=f.fromJSON(t.path).evaluate(e);return void 0===n.value?new p(t.path):(n.parent[n.key]=t.value,null)}function u(e,t){var n=f.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new p(t.from);var o=f.fromJSON(t.path).evaluate(e);return void 0===o.parent?new p(t.path):(i(n.parent,n.key),r(o.parent,o.key,n.value),null)}function c(e,t){var n=f.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new p(t.from);var o=f.fromJSON(t.path).evaluate(e);return void 0===o.parent?new p(t.path):(i(n.parent,n.key),r(o.parent,o.key,n.value),null)}function l(e,t){var n=f.fromJSON(t.path).evaluate(e);return h(n.value,t.value)?null:new m(n.value,t.value)}n.add=o,n.remove=s,n.replace=a,n.move=u,n.copy=c,n.test=l,Object.defineProperty(n,"__esModule",{value:!0});var f=e("./pointer").Pointer,h=e("./equal").compare,d=e("./errors"),p=d.MissingError,m=d.TestError},{"./equal":2,"./errors":3,"./pointer":6}],6:[function(e,t,n){"use strict";function r(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function i(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}var o=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};Object.defineProperty(n,"__esModule",{value:!0}),n.Pointer=function(){function e(){var t=void 0===arguments[0]?[""]:arguments[0];s(this,e),this.tokens=t}return o(e,{toString:{value:function(){return this.tokens.map(i).join("/")}},evaluate:{value:function(e){for(var t=null,n=null,r=1,i=this.tokens.length;r<i;r++)t=e,n=this.tokens[r],e=(t||{})[n];return{parent:t,key:n,value:e}}},push:{value:function(e){this.tokens.push(e)}},add:{value:function(t){return new e(this.tokens.concat(String(t)))}}},{fromJSON:{value:function(t){var n=t.split("/").map(r);if(""!==n[0])throw new Error("Invalid JSON Pointer: "+t);return new e(n)}}}),e}()},{}]},{},[4])(4)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],208:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/regenerator")),o=r(e("babel-runtime/core-js/object/get-prototype-of")),s=r(e("babel-runtime/helpers/createClass")),a=r(e("babel-runtime/helpers/possibleConstructorReturn")),u=r(e("babel-runtime/helpers/inherits")),c=r(e("babel-runtime/helpers/classCallCheck")),l=r(e("babel-runtime/core-js/promise")),f=function(e,t,n,r){return new(n||(n=l.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var h=e("events"),d=e("operation-retrier"),p=e("./configuration"),m=e("./logger"),v=e("./persistentState"),b=e("twilio-transport"),y=function e(){(0,c.default)(this,e)},_=function(e){function t(e){(0,c.default)(this,t);var n=(0,a.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return e=e||{},e.transport=e.transport||new b.Transport(e.twilsockClient||null),n.state=new v.PersistentState,n.config=new p.default(e),n.twilsock=e.twilsockClient,n.transport=e.transport,n}return(0,u.default)(t,e),(0,s.default)(t,[{key:"setToken",value:function(e){return f(this,void 0,void 0,i.default.mark(function t(){var n;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.currentFpaToken!==e&&(this.currentFpaToken=e,n=this.currentTokenRequest,this.currentTokenRequest=this.establishToken(e),this.notifyRejected(n)),t.abrupt("return",this.currentTokenRequest.promise);case 2:case"end":return t.stop()}},t,this)}))}},{key:"notifyRejected",value:function(e){e&&setTimeout(function(){return e.reject(new Error("Operation has been cancelled by next token"))},0)}},{key:"establishToken",value:function(e){var t=this,n=new y,r=new l.default(function(r,i){t.establishTokenImpl(e).then(r).catch(i),n.resolve=r,n.reject=i});return n.promise=r,n}},{key:"establishTokenImpl",value:function(e){return f(this,void 0,void 0,i.default.mark(function t(){var n=this;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new d.default({min:500,max:2e3}).run(function(){return n.requestRtdToken(e)}).then(function(t){if("ok"!=t.status)throw t.exception;if(n.currentFpaToken===e){n.state.continuationToken=t.response.continuation_token;var r=t.response.twilio_rtd_token;"NEW"===t.response.status.status?n.emit("tokenCreated",r):n.emit("tokenUpdated",r),n.emit("token",r);var i={token:t.response.twilio_rtd_token,ttl:t.response.ttl,status:t.response.status.status,reason:t.response.status.reason||null,identity:t.response.identity||null,accountSid:t.response.account_sid,serviceSids:t.response.instance_sids};return n.emit("response",i),i}}).catch(function(e){throw m.default.error(e),e}));case 1:case"end":return t.stop()}},t,this)}))}},{key:"requestRtdToken",value:function(e){return f(this,void 0,void 0,i.default.mark(function t(){var n,r,o;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={"Content-Type":"application/json"},r={fpa_token:e,continuation_token:this.state.continuationToken},m.default.debug("Token request",r),t.prev=3,t.next=6,this.transport.post(this.config.url,n,r);case 6:return o=t.sent,m.default.debug("Token response:",o),t.abrupt("return",{status:"ok",token:e,response:o.body});case 11:if(t.prev=11,t.t0=t.catch(3),401!==t.t0.status&&403!==t.t0.status){t.next=16;break}return t.t0 instanceof Error||(t.t0.body?t.t0=new Error(t.t0.body.message):t.t0.description&&(t.t0=new Error(t.t0.description))),t.abrupt("return",{status:"denied",exception:t.t0,token:null,response:null});case 16:throw t.t0;case 17:case"end":return t.stop()}},t,this,[[3,11]])}))}}]),t}(h.EventEmitter);n.EmsClient=_;var g=_;n.EMSClient=g,n.default=g},{"./configuration":209,"./logger":210,"./persistentState":211,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,"babel-runtime/regenerator":48,events:194,"operation-retrier":199,"twilio-transport":244}],209:[function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(e("babel-runtime/helpers/classCallCheck"));Object.defineProperty(n,"__esModule",{value:!0});var i=function e(t){(0,r.default)(this,e);var n=t.emsClient||{},i="https://ems."+(t.realm||"us1")+".twilio.com",o=n.url||n.emsUri||n.emsUrl||i+"/v1/token";this.url=o};n.default=i},{"babel-runtime/helpers/classCallCheck":41}],210:[function(e,t,n){"use strict";function r(e,t){return[e].concat((0,i.default)(t))}var i=function(e){return e&&e.__esModule?e:{default:e}}(e("babel-runtime/core-js/array/from"));Object.defineProperty(n,"__esModule",{value:!0});var o=e("loglevel");n.default={setLevel:function(e){o.setLevel(e)},trace:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.trace.apply(null,r("EMS T:",t))},debug:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.debug.apply(null,r("EMS D:",t))},info:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.info.apply(null,r("EMS I:",t))},warn:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.warn.apply(null,r("EMS W:",t))},error:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.error.apply(null,r("EMS E:",t))}}},{"babel-runtime/core-js/array/from":22,loglevel:198}],211:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/helpers/classCallCheck")),o=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var s=e("./logger"),a=function(){function e(){(0,i.default)(this,e),this.cachedContinuationToken=null,this.myInstanceNumber=this.initializeInstanceId()}return(0,o.default)(e,[{key:"initializeInstanceId",value:function(){var t=function(){try{if(sessionStorage)return parseInt(sessionStorage.getItem("Twilio::RTD::EmsClient::InstanceId"))||0}catch(e){return 0}}();t>e.instancesCounter&&(e.instancesCounter=t);var n=e.instancesCounter++;try{sessionStorage&&(sessionStorage.setItem("Twilio::RTD::EmsClient::InstanceId",e.instancesCounter.toString()),window&&window.addEventListener("beforeunload",function(){sessionStorage.removeItem("Twilio::RTD::EmsClient::InstanceId")}))}catch(e){}return n}},{key:"shouldUsePersistentToken",get:function(){return 0===this.myInstanceNumber}},{key:"continuationToken",get:function(){if(this.cachedContinuationToken)return this.cachedContinuationToken;try{if(this.shouldUsePersistentToken&&sessionStorage)return this.cachedContinuationToken=sessionStorage.getItem("Twilio::RTD::EndpointId"),this.cachedContinuationToken}catch(e){s.default.info("Can't access persistent storage",e.message)}return null},set:function(e){this.cachedContinuationToken=e;try{this.shouldUsePersistentToken&&sessionStorage&&sessionStorage.setItem("Twilio::RTD::EndpointId",e)}catch(e){s.default.info("Can't access persistent storage",e.message)}}}]),e}();a.instancesCounter=0,n.PersistentState=a},{"./logger":210,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],212:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){var r=new m.default(t,n,1,m.default.strategy.LEAK);return function(){var t=Array.prototype.slice.call(arguments,0);return t.unshift(e),r.schedule.apply(r,t)}}Object.defineProperty(n,"__esModule",{value:!0});var o=r(e("babel-runtime/core-js/promise")),s=r(e("babel-runtime/core-js/object/define-properties")),a=r(e("babel-runtime/core-js/object/get-prototype-of")),u=r(e("babel-runtime/helpers/classCallCheck")),c=r(e("babel-runtime/helpers/createClass")),l=r(e("babel-runtime/helpers/possibleConstructorReturn")),f=r(e("babel-runtime/helpers/inherits")),h=r(e("./configuration")),d=r(e("events")),p=r(e("./logger")),m=r(e("bottleneck")),v=r(e("./registrar")),b=r(e("twilsock")),y=r(e("twilio-transport")),_=e("twilio-ems-client"),g=function(e){function t(e,n){(0,u.default)(this,t);var r=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this));if(!e)throw new Error("Token is required for Notifications client");(n=n||{}).logLevel=n.logLevel||"error",p.default.setLevel(n.logLevel);var o=n.minTokenRefreshInterval||1e4,c=n.productId||"notifications";n.twilsockClient=n.twilsockClient||new b.default(e,n),n.transport=n.transport||new y.default(n.twilsockClient),n.emsClient=n.emsClient||new _.EMSClient(n);var f=n.twilsockClient,d=n.transport,m={overall:!1,transport:!1,registration:!1,lastEmitted:null},g=new h.default(null,n);return(0,s.default)(r,{_config:{value:g},_emsClient:{value:n.emsClient},_registrar:{value:new v.default(c,d,f,g)},_twilsock:{value:f},_reliableTransportState:{value:m},updateToken:{value:i(r._updateToken.bind(r),1,o),enumerable:!0},connectionState:{get:function(){return"disconnected"===r._twilsock.state?"disconnected":"disconnecting"===r._twilsock.state?"disconnecting":"connected"===r._twilsock.state&&r._reliableTransportState.registration?"connected":"rejected"===r._twilsock.state?"denied":"connecting"}}}),r._emsClient.setToken(e).then(function(e){r._config.updateToken(e.token),r._registrar.updateToken()}).catch(function(e){p.default.warn("Failed to set token",e)}),r._onTransportStateChange(r._twilsock.connected),r._registrar.on("transportReady",function(e){r._onRegistrationStateChange(e?"registered":"")}),r._registrar.on("stateChanged",function(e){r._onRegistrationStateChange(e)}),r._registrar.on("needReliableTransport",r._onNeedReliableTransport.bind(r)),r._twilsock.on("message",function(e,t){return r._routeMessage(e,t)}),r._twilsock.on("connected",function(e){r._onTransportStateChange(!0),r._registrar.setNotificationId("twilsock",e)}),r._twilsock.on("disconnected",function(){r._onTransportStateChange(!1)}),r}return(0,f.default)(t,e),(0,c.default)(t,[{key:"_routeMessage",value:function(e,t){p.default.trace("Message arrived: ",e,t),this.emit("message",e,t)}},{key:"_onNeedReliableTransport",value:function(e){e?this._twilsock.connect():this._twilsock.disconnect()}},{key:"_onRegistrationStateChange",value:function(e){this._reliableTransportState.registration="registered"===e,this._updateTransportState()}},{key:"_onTransportStateChange",value:function(e){this._reliableTransportState.transport=e,this._updateTransportState()}},{key:"_updateTransportState",value:function(){var e=this._reliableTransportState.transport&&this._reliableTransportState.registration;this._reliableTransportState.overall!==e&&(this._reliableTransportState.overall=e,p.default.info("Transport ready "+e),this.emit("transportReady",e)),this._reliableTransportState.lastEmitted!==this.connectionState&&(this._reliableTransportState.lastEmitted=this.connectionState,this.emit("connectionStateChanged",this.connectionState))}},{key:"subscribe",value:function(e,t){return t=t||"twilsock",p.default.trace("Add subscriptions for message type: ",e,t),this._registrar.subscribe(e,t)}},{key:"unsubscribe",value:function(e,t){return t=t||"twilsock",p.default.trace("Remove subscriptions for message type: ",e,t),this._registrar.unsubscribe(e,t)}},{key:"handlePushNotification",value:function(e){p.default.warn("Push message passed, but no functionality implemented yet: "+e)}},{key:"setPushRegistrationId",value:function(e,t){this._registrar.setNotificationId(t||"gcm",e)}},{key:"_updateToken",value:function(e){var t=this;return p.default.info("authTokenUpdated"),this._fpaToken===e?o.default.resolve():(this._twilsock.updateToken(e),this._emsClient.setToken(e).then(function(e){return e.token}).then(function(e){t._config.updateToken(e),t._registrar.updateToken()}))}}]),t}(d.default);n.default=g,t.exports=n.default},{"./configuration":213,"./logger":215,"./registrar":217,"babel-runtime/core-js/object/define-properties":30,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,bottleneck:60,events:194,"twilio-ems-client":208,"twilio-transport":244,twilsock:247}],213:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("babel-runtime/core-js/object/define-properties")),o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/createClass")),a="https://ers.twilio.com",u="/v1/registrations",c=function(){function e(t,n){var r=this;(0,o.default)(this,e);var s=(n=(n||{}).Notification||{}).ersUri||a;(0,i.default)(this,{_registrarUri:{value:s+u},_token:{value:t,writable:!0},registrarUri:{get:function(){return r._registrarUri}},token:{get:function(){return r._token}}})}return(0,s.default)(e,[{key:"updateToken",value:function(e){this._token=e}}]),e}();n.default=c,t.exports=n.default},{"babel-runtime/core-js/object/define-properties":30,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],214:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./client"));n.default=r.default,t.exports=n.default},{"./client":212}],215:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return[e].concat((0,o.default)(t))}Object.defineProperty(n,"__esModule",{value:!0});var o=r(e("babel-runtime/core-js/array/from")),s=r(e("loglevel"));n.default={setLevel:function(e){s.default.setLevel(e)},trace:function(){s.default.trace.apply(null,i("Notify T:",arguments))},debug:function(){s.default.debug.apply(null,i("Notify D:",arguments))},info:function(){s.default.info.apply(null,i("Notify I:",arguments))},warn:function(){s.default.warn.apply(null,i("Notify W:",arguments))},error:function(){s.default.error.apply(null,i("Notify E:",arguments))}},t.exports=n.default},{"babel-runtime/core-js/array/from":22,loglevel:198}],216:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=[];return e.forEach(function(e){return t.push(e)}),t}Object.defineProperty(n,"__esModule",{value:!0});var o=r(e("babel-runtime/core-js/object/freeze")),s=r(e("babel-runtime/core-js/promise")),a=r(e("babel-runtime/core-js/set")),u=r(e("babel-runtime/core-js/object/define-properties")),c=r(e("babel-runtime/core-js/object/get-prototype-of")),l=r(e("babel-runtime/helpers/classCallCheck")),f=r(e("babel-runtime/helpers/createClass")),h=r(e("babel-runtime/helpers/possibleConstructorReturn")),d=r(e("babel-runtime/helpers/inherits")),p=r(e("events")),m=r(e("./logger")),v=r(e("javascript-state-machine")),b=r(e("backoff")),y=function(e){function t(e,n,r,i){(0,l.default)(this,t);var o=(0,h.default)(this,(t.__proto__||(0,c.default)(t)).call(this)),s=v.default.create({initial:{state:"unregistered",event:"init",defer:!0},events:[{name:"userUpdate",from:["unregistered"],to:"registering"},{name:"userUpdate",from:["registered"],to:"unregistering"},{name:"registered",from:["registering","retrying"],to:"registered"},{name:"unregistered",from:["unregistering"],to:"unregistered"},{name:"retry",from:["retrying"],to:"retrying"},{name:"failure",from:["registering"],to:"retrying"},{name:"failure",from:["retrying"],to:"retrying"},{name:"failure",from:["unregistering"],to:"unregistered"}],callbacks:{onregistering:function(e,t,n,r){return o._register(r)},onunregistering:function(){return o._unregister()},onregistered:function(){return o._onRegistered()},onunregistered:function(){return o._onUnregistered()},onretrying:function(e,t,n,r){return o._initRetry(r)},onfailure:function(e,t,n,r){"retrying"===t&&o._initRetry(r)}}}),f=b.default.exponential({randomisationFactor:.2,initialDelay:2e3,maxDelay:12e4});return f.on("ready",function(){o._retry()}),(0,u.default)(o,{_transport:{value:n},_context:{value:e},_url:{value:r.registrarUri,writable:!1},_config:{value:r},_fsm:{value:s},_backoff:{value:f},_channelType:{value:i},_registrationId:{value:!1,writable:!0},_notificationId:{value:!1,writable:!0},_messageTypes:{value:new a.default,writable:!0},_pendingUpdate:{value:null,writable:!0}}),s.init(),o}return(0,d.default)(t,e),(0,f.default)(t,[{key:"setNotificationId",value:function(e){this._notificationId!==e&&(this._notificationId=e,this._updateRegistration())}},{key:"updateToken",value:function(){return this._updateRegistration()}},{key:"has",value:function(e){return this._messageTypes.has(e)}},{key:"subscribe",value:function(e){return this._messageTypes.has(e)?(m.default.debug("Message type already registered ",e),!1):(this._messageTypes.add(e),this._updateRegistration(),!0)}},{key:"unsubscribe",value:function(e){return!!this._messageTypes.has(e)&&(this._messageTypes.delete(e),this._messageTypes.size>0?this._updateRegistration():this._removeRegistration(),!0)}},{key:"_updateRegistration",value:function(){this._notificationId&&this._update(this._notificationId,i(this._messageTypes))}},{key:"_removeRegistration",value:function(){this._notificationId&&this._update(this._notificationId,i(this._messageTypes))}},{key:"_update",value:function(e,t){var n={notificationId:e,messageTypes:t};this._fsm.is("unregistered")?n.notificationId&&n.messageTypes.length>0&&this._fsm.userUpdate(n):this._fsm.is("registered")?(this._fsm.userUpdate(n),this._setPendingUpdate(n)):this._setPendingUpdate(n)}},{key:"_setPendingUpdate",value:function(e){this._pendingUpdate=e}},{key:"_checkPendingUpdate",value:function(){if(this._pendingUpdate){var e=this._pendingUpdate;this._pendingUpdate=null,this._updateRegistration(e.notificationId,e.messageTypes)}}},{key:"_initRetry",value:function(e){this._pendingUpdate||this._setPendingUpdate(e),this._backoff.backoff()}},{key:"_retry",value:function(){if(this._pendingUpdate){var e=this._pendingUpdate;this._pendingUpdate=null,this._register(e)}}},{key:"_onRegistered",value:function(){this._backoff.reset(),this.emit("stateChanged","registered"),this._checkPendingUpdate()}},{key:"_onUnregistered",value:function(){this._backoff.reset(),this.emit("stateChanged","unregistered"),this._checkPendingUpdate()}},{key:"_register",value:function(e){var t=this,n={endpoint_platform:this._context.platform,channel_type:this._channelType,version:"2",message_types:e.messageTypes,data:{},ttl:"PT24H"};"twilsock"===this._channelType?n.data.url=e.notificationId:n.data.registration_id=e.notificationId;var r=this._url+"?productId="+this._context.productId,i={"Content-Type":"application/json","X-Twilio-Token":this._config.token};return m.default.trace("Creating registration for channel ",this._channelType),this._transport.post(r,i,n).then(function(n){t._registrationId=n.body.id,t._registrationData=e,m.default.debug("Registration created: ",n),t._fsm.registered()}).catch(function(n){return m.default.error("Registration failed: ",n),t._fsm.failure(e),n})}},{key:"_unregister",value:function(){var e=this;if(!this._registrationId)return s.default.resolve();var t=this._url+"/"+this._registrationId+"?productId="+this._context.productId,n={"Content-Type":"application/json","X-Twilio-Token":this._config.token};return m.default.trace("Removing registration for ",this._channelType),this._transport.delete(t,n).then(function(){m.default.debug("Registration removed for ",e._channelType),e._registrationId=!1,e._fsm.unregistered()}).catch(function(t){return m.default.error("Failed to remove of registration ",e.channelType,t),e._fsm.failure(),t})}}]),t}(p.default);n.default=y,(0,o.default)(y),t.exports=n.default},{"./logger":215,"babel-runtime/core-js/object/define-properties":30,"babel-runtime/core-js/object/freeze":32,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/core-js/set":38,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,backoff:49,events:194,"javascript-state-machine":196}],217:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("babel-runtime/core-js/object/freeze")),o=r(e("babel-runtime/core-js/map")),s=r(e("babel-runtime/core-js/object/define-properties")),a=r(e("babel-runtime/core-js/object/get-prototype-of")),u=r(e("babel-runtime/helpers/classCallCheck")),c=r(e("babel-runtime/helpers/createClass")),l=r(e("babel-runtime/helpers/possibleConstructorReturn")),f=r(e("babel-runtime/helpers/inherits")),h=r(e("events")),d=r(e("./registrar.connector")),p=r(e("./twilsock.connector")),m=function(e){function t(e,n,r,i){(0,u.default)(this,t);var c=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this));(0,s.default)(c,{_conf:{value:i},_connectors:{value:new o.default}});var f=c._detectPlatform();return c._connectors.set("twilsock",new p.default({productId:e,platform:f},r,i)),c._connectors.set("gcm",new d.default({productId:e,platform:f},n,i,"gcm")),c._connectors.set("fcm",new d.default({productId:e,platform:f},n,i,"fcm")),c._connectors.set("apn",new d.default({productId:e,platform:f},n,i,"apn")),c._connectors.get("twilsock").on("transportReady",function(e){return c.emit("transportReady",e)}),c}return(0,f.default)(t,e),(0,c.default)(t,[{key:"setNotificationId",value:function(e,t){this._connector(e).setNotificationId(t)}},{key:"hasSubscription",value:function(e,t){this._connector(t).has(e)}},{key:"subscribe",value:function(e,t){this._connector(t).subscribe(e)}},{key:"unsubscribe",value:function(e,t){this._connector(t).unsubscribe(e)}},{key:"updateToken",value:function(){this._connectors.forEach(function(e){return e.updateToken()})}},{key:"_connector",value:function(e){var t=this._connectors.get(e);if(!t)throw new Error("Unknown channel type: "+e);return t}},{key:"_detectPlatform",value:function(){var e="";return"undefined"!=typeof navigator?(e="unknown",void 0!==navigator.product&&(e=navigator.product),void 0!==navigator.userAgent&&(e=navigator.userAgent)):e="web",e.substring(0,128)}}]),t}(h.default);n.default=m,(0,i.default)(m),t.exports=n.default},{"./registrar.connector":216,"./twilsock.connector":218,"babel-runtime/core-js/map":26,"babel-runtime/core-js/object/define-properties":30,"babel-runtime/core-js/object/freeze":32,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,events:194}],218:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=[];return e.forEach(function(e){return t.push(e)}),t}Object.defineProperty(n,"__esModule",{value:!0});var o=r(e("babel-runtime/core-js/object/freeze")),s=r(e("babel-runtime/core-js/set")),a=r(e("babel-runtime/core-js/object/define-properties")),u=r(e("babel-runtime/core-js/object/get-prototype-of")),c=r(e("babel-runtime/helpers/classCallCheck")),l=r(e("babel-runtime/helpers/createClass")),f=r(e("babel-runtime/helpers/possibleConstructorReturn")),h=r(e("babel-runtime/helpers/inherits")),d=r(e("uuid")),p=r(e("./logger")),m=function(e){function t(e,n,r){(0,c.default)(this,t);var i=(0,f.default)(this,(t.__proto__||(0,u.default)(t)).call(this));return e.id=d.default.v4(),(0,a.default)(i,{_twilsock:{value:n},_messageTypes:{value:new s.default},config:{value:r},context:{value:e}}),n.on("stateChanged",function(e){"connected"!==e&&i.emit("transportReady",!1)}),n.on("registered",function(t){e&&t===e.id&&"connected"===n.state&&i.emit("transportReady",!0)}),i}return(0,h.default)(t,e),(0,l.default)(t,[{key:"setNotificationId",value:function(){return!1}},{key:"updateToken",value:function(){this._twilsock.removeNotificationsContext(this.context.id),this.context.id=d.default.v4(),this._updateContext()}},{key:"has",value:function(e){return this._messageTypes.has(e)}},{key:"subscribe",value:function(e){return this._messageTypes.has(e)?(p.default.trace("Message type already registered ",e),!1):(this._messageTypes.add(e),this._updateContext(),!0)}},{key:"unsubscribe",value:function(e){return!!this._messageTypes.has(e)&&(this._messageTypes.delete(e),this._messageTypes.size>0?this._updateContext():this._twilsock.removeNotificationsContext(this.context.id),!0)}},{key:"_updateContext",value:function(){if(this.config.token){var e=i(this._messageTypes),t={product_id:this.context.productId,notification_protocol_version:4,endpoint_platform:this.context.platform,ttl:172800,token:this.config.token,message_types:e};this.emit("transportReady",!1),this._twilsock.setNotificationsContext(this.context.id,t)}}}]),t}(r(e("events")).default);n.default=m,(0,o.default)(m),t.exports=n.default},{"./logger":215,"babel-runtime/core-js/object/define-properties":30,"babel-runtime/core-js/object/freeze":32,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/set":38,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,events:194,uuid:254}],219:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/helpers/classCallCheck")),o=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var s=e("karibu"),a=function(){function e(t,n){(0,i.default)(this,e),this.value=t,this.revision=n||0}return(0,o.default)(e,[{key:"isValid",get:function(){return!0}}]),e}(),u=function(){function e(t){(0,i.default)(this,e),this.revision=t}return(0,o.default)(e,[{key:"isValid",get:function(){return!1}}]),e}(),c=function(){function e(){(0,i.default)(this,e),this.items=new s.TreeMap}return(0,o.default)(e,[{key:"store",value:function(e,t,n){var r=this.items.get(e);return r&&r.revision>n?r.isValid?r.value:null:(this.items.set(e,new a(t,n)),t)}},{key:"delete",value:function(e,t){var n=this.items.get(e);(!n||n.revision<t)&&this.items.set(e,new u(t))}},{key:"isKnown",value:function(e,t){var n=this.items.get(e);return n&&n.revision>=t}},{key:"get",value:function(e){var t=this.items.get(e);return t&&t.isValid?t.value:null}},{key:"has",value:function(e){var t=this.items.get(e);return t&&t.isValid}}]),e}();n.Cache=c,n.default=c},{"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,karibu:197}],220:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return e._subscribe(),e}function o(e,t,n,r){return{unique_name:e,purpose:t,context:n,data:r}}function s(e){return e?"string"==typeof e?{id:e,purpose:null,data:null,context:null,mode:null,optimistic:!1}:{id:e.uniqueName||e.sid||e.id,purpose:e.purpose,data:e.data,context:e.context,mode:e.mode,optimistic:!!e.optimistic}:{id:null,purpose:null,data:null,context:null,mode:null,optimistic:!1}}var a=r(e("babel-runtime/regenerator")),u=r(e("babel-runtime/core-js/object/get-prototype-of")),c=r(e("babel-runtime/helpers/classCallCheck")),l=r(e("babel-runtime/helpers/createClass")),f=r(e("babel-runtime/helpers/possibleConstructorReturn")),h=r(e("babel-runtime/helpers/inherits")),d=r(e("babel-runtime/core-js/promise")),p=function(e,t,n,r){return new(n||(n=d.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var m=e("events"),v=e("xxhashjs"),b=e("twilsock"),y=e("twilio-transport"),_=e("twilio-ems-client"),g=e("twilio-notifications"),k=e("./utils"),w=e("./logger"),C=e("./configuration"),x=e("./subscriptions"),j=e("./router"),E=e("./network"),S=e("./syncdocument"),T=e("./synclist"),R=e("./syncmap"),I=e("./clientInfo"),A=e("./entitiesCache"),P=e("./services/storage"),O=e("./utils"),M=e("./utils/deferred"),F=e("./syncerror"),N="data_sync",U=e("../package.json").version,L=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,c.default)(this,t);var r=(0,f.default)(this,(t.__proto__||(0,u.default)(t)).call(this));if(!e)throw new Error("Sync library needs a valid Twilio token to be passed");n.hasOwnProperty("logLevel")&&w.default.setLevel(n.logLevel),r.productId=n.productId=n.productId||N;var i=n.twilsockClient=n.twilsockClient||new b(e,n),o=n.transport=n.transport||new y.Transport(n.twilsockClient),s=n.emsClient=n.emsClient||new _.EmsClient(n),a=n.notificationsClient=n.notificationsClient||new g(e,n),l=new C.Configuration(null,n),h=new E.Network(r.productId,new I.ClientInfo(U),l,o),d=new P.SessionStorage(l);r.localStorageId=null,r.fpaToken=e,r.authData=new M.Deferred,r.authData.promise.then(function(e){return r.handleEmsResponse(e)}),s.once("response",function(e){return r.authData.update(e)}),s.setToken(e).catch(function(e){w.default.warn("Failed to set token",e)}),i.connect(),r.services={config:l,twilsock:i,notifications:a,network:h,emsClient:s,storage:d,router:null,subscriptions:null};var p=new x.Subscriptions(r.services),m=new j.Router({config:l,subscriptions:p,notifications:a});return r.services.router=m,r.services.subscriptions=p,r.entities=new A.EntitiesCache,a.on("connectionStateChanged",function(){r.emit("connectionStateChanged",r.services.notifications.connectionState)}),r}return(0,h.default)(t,e),(0,l.default)(t,[{key:"handleEmsResponse",value:function(e){this.services.config.updateToken(e.token);try{var t=e.identity,n=e.serviceSids[this.productId],r=v.h64().update("TW::"+t+"::"+n).digest().toString(16);this.services.storage.updateStorageId(r)}catch(e){w.default.error("Failed to initialize persistent storage",e)}}},{key:"ensureReady",value:function(){return p(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.authData.promise;case 2:case"end":return e.stop()}},e,this)}))}},{key:"storeRootInSessionCache",value:function(e,t,n){if(this.services.config.sessionStorageEnabled&&t){var r=O.deepClone(n);e!==S.SyncDocument.type&&(r.last_event_id=null,delete r.items),this.services.storage.store(e,t,r)}}},{key:"readRootFromSessionCache",value:function(e,t){return this.services.config.sessionStorageEnabled&&t?this.services.storage.read(e,t):null}},{key:"_get",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return p(this,void 0,void 0,a.default.mark(function r(){var i,o;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t){r.next=2;break}return r.abrupt("return",null);case 2:return i=new k.UriBuilder(e).path(t).arg("Include",n?"items":void 0).build(),r.prev=3,r.next=6,this.services.network.get(i);case 6:return o=r.sent,r.abrupt("return",o.body);case 10:if(r.prev=10,r.t0=r.catch(3),404!==r.t0.status){r.next=14;break}return r.abrupt("return",null);case 14:throw r.t0;case 15:case"end":return r.stop()}},r,this,[[3,10]])}))}},{key:"_createDocument",value:function(e,t,n){var r=o(e,t,null,n);return this.services.network.post(this.services.config.documentsUri,r).then(function(e){return e.body})}},{key:"_getDocument",value:function(e){return p(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.readRootFromSessionCache(S.SyncDocument.type,e)||this._get(this.services.config.documentsUri,e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"_createList",value:function(e,t,n){var r=o(e,t,n);return this.services.network.post(this.services.config.listsUri,r).then(function(e){return e.body})}},{key:"_getList",value:function(e){return p(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.readRootFromSessionCache(T.SyncList.type,e)||this._get(this.services.config.listsUri,e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"_createMap",value:function(e,t,n){var r=o(e,t,n);return this.services.network.post(this.services.config.mapsUri,r).then(function(e){return e.body})}},{key:"_getMap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p(this,void 0,void 0,a.default.mark(function n(){return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.readRootFromSessionCache(R.SyncMap.type,e)||this._get(this.services.config.mapsUri,e,t));case 1:case"end":return n.stop()}},n,this)}))}},{key:"getCached",value:function(e,t){return e?this.entities.get(e,t)||null:null}},{key:"removeFromCacheAndSession",value:function(e,t,n){this.entities.remove(t),this.services.config.sessionStorageEnabled&&this.services.storage.remove(e,t,n)}},{key:"document",value:function(e){return p(this,void 0,void 0,a.default.mark(function t(){var n,r,o,u,c,l=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:return n=s(e),r=n.id,o=n.purpose,u=n.data,c=n.mode,t.abrupt("return",this.getCached(r,"document")||this._getDocument(r).then(function(e){if(e)return e;if("open"!==c)return l._createDocument(r,o,u);throw new F.default("Not found",404)}).then(function(e){return l.storeRootInSessionCache(S.SyncDocument.type,r,e),new S.SyncDocument(l.services,e,function(e,t,n){return l.removeFromCacheAndSession(e,t,n)})}).then(function(e){return l.entities.store(e)}).then(i));case 4:case"end":return t.stop()}},t,this)}))}},{key:"map",value:function(e){return p(this,void 0,void 0,a.default.mark(function t(){var n,r,o,u,c,l,f=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:return n=s(e),r=n.id,o=n.purpose,u=n.context,c=n.mode,l=n.optimistic,t.abrupt("return",this.getCached(r,"map")||this._getMap(r,l).then(function(e){if(e)return e;if("open"!==c)return f._createMap(r,o,u);throw new F.default("Not found",404)}).then(function(e){return f.storeRootInSessionCache(R.SyncMap.type,r,e),new R.SyncMap(f.services,e,function(e,t,n){return f.removeFromCacheAndSession(e,t,n)})}).then(function(e){return f.entities.store(e)}).then(i));case 4:case"end":return t.stop()}},t,this)}))}},{key:"list",value:function(e){return p(this,void 0,void 0,a.default.mark(function t(){var n,r,o,u,c,l=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:return n=s(e),r=n.id,o=n.purpose,u=n.context,c=n.mode,t.abrupt("return",this.getCached(r,"list")||this._getList(r).then(function(e){if(e)return e;if("open"!==c)return l._createList(r,o,u);throw new F.default("Not found",404)}).then(function(e){return l.storeRootInSessionCache(T.SyncList.type,r,e),new T.SyncList(l.services,e,function(e,t,n){return l.removeFromCacheAndSession(e,t,n)})}).then(function(e){return l.entities.store(e)}).then(i));case 4:case"end":return t.stop()}},t,this)}))}},{key:"shutdown",value:function(){return p(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.subscriptions.shutdown();case 2:return e.next=4,this.services.twilsock.disconnect();case 4:case"end":return e.stop()}},e,this)}))}},{key:"updateToken",value:function(e){return p(this,void 0,void 0,a.default.mark(function t(){var n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.services.emsClient.setToken(e);case 2:return n=t.sent,this.services.config.updateToken(n.token),t.next=6,d.default.all([this.services.notifications.updateToken(e),this.services.twilsock.updateToken(e)]);case 6:this.fpaToken=e;case 7:case"end":return t.stop()}},t,this)}))}},{key:"connectionState",get:function(){return this.services.notifications.connectionState}}],[{key:"version",get:function(){return U}}]),t}(m.EventEmitter);n.SyncClient=L,n.Client=L,n.default=L},{"../package.json":242,"./clientInfo":221,"./configuration":222,"./entitiesCache":223,"./logger":227,"./network":229,"./router":232,"./services/storage":233,"./subscriptions":234,"./syncdocument":236,"./syncerror":237,"./synclist":238,"./syncmap":239,"./utils":240,"./utils/deferred":241,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,"babel-runtime/regenerator":48,events:194,"twilio-ems-client":208,"twilio-notifications":214,"twilio-transport":244,twilsock:247,xxhashjs:259}],221:[function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(e("babel-runtime/helpers/classCallCheck"));Object.defineProperty(n,"__esModule",{value:!0});var i=e("platform"),o=function e(t){(0,r.default)(this,e),this.sdk="js",this.sdkVer=t,this.os=i.os.family,this.osVer=i.os.version,this.pl=i.name,this.plVer=i.version};n.ClientInfo=o,n.default=o},{"babel-runtime/helpers/classCallCheck":41,platform:200}],222:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){return e&&void 0!==e[t]?e[t]:n}var o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var a="https://cds.twilio.com",u="/v4/Subscriptions",c="/v3/Maps",l="/v3/Lists",f="/v3/Documents",h=function(){function e(t,n){(0,o.default)(this,e);var r=(n=(n=n||{}).Sync||n.DataSync||{}).cdsUri||a;this._token=t,this.settings={subscriptionsUri:r+u,documentsUri:r+f,listsUri:r+l,mapsUri:r+c,sessionStorageEnabled:i(n,"enableSessionStorage",!0)}}return(0,s.default)(e,[{key:"updateToken",value:function(e){this._token=e}},{key:"token",get:function(){return this._token}},{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}},{key:"sessionStorageEnabled",get:function(){return this.settings.sessionStorageEnabled}}]),e}();n.Configuration=h},{"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],223:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/core-js/map")),o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(){(0,o.default)(this,e),this.names=new i.default,this.entities=new i.default}return(0,s.default)(e,[{key:"store",value:function(e){return this.entities.get(e.sid)||(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}},{key:"getResolved",value:function(e,t){var n=this.names.get(t+"::"+e);return n?this.entities.get(n):null}},{key:"get",value:function(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}},{key:"remove",value:function(e){var t=this.entities.get(e);t&&(this.entities.delete(e),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}]),e}();n.EntitiesCache=a},{"babel-runtime/core-js/map":26,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],224:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/core-js/object/get-prototype-of")),o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/createClass")),a=r(e("babel-runtime/helpers/possibleConstructorReturn")),u=r(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{value:!0});var c=function(e){function t(e,n){(0,o.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return r.services=e,r.removalHandler=n,r}return(0,u.default)(t,e),(0,s.default)(t,[{key:"_advanceLastEventId",value:function(e,t){}},{key:"reportFailure",value:function(e){404===e.status?this.onRemoved(!1):this.emit("failure",e)}},{key:"_subscribe",value:function(){return this.services.router.subscribe(this.sid,this),this}},{key:"_unsubscribe",value:function(){return this.services.router.unsubscribe(this.sid,this),this}},{key:"close",value:function(){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName)}}]),t}(e("events").EventEmitter);n.SyncEntity=c,n.default=c},{"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,events:194}],225:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./client");n.SyncClient=r.SyncClient,n.default=r.SyncClient,t.exports=r.SyncClient,t.exports.SyncClient=r.SyncClient},{"./client":220}],226:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/helpers/classCallCheck")),o=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(t){(0,i.default)(this,e),this.data=t}return(0,o.default)(e,[{key:"update",value:function(e,t,n){return this.data.lastEventId=e,this.data.revision=t,this.data.value=n,this}},{key:"uri",get:function(){return this.data.uri}},{key:"revision",get:function(){return this.data.revision}},{key:"lastEventId",get:function(){return this.data.lastEventId}},{key:"index",get:function(){return this.data.index}},{key:"value",get:function(){return this.data.value}}]),e}();n.ListItem=s,n.default=s},{"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],227:[function(e,t,n){"use strict";function r(e,t){return[e].concat((0,i.default)(t))}var i=function(e){return e&&e.__esModule?e:{default:e}}(e("babel-runtime/core-js/array/from"));Object.defineProperty(n,"__esModule",{value:!0});var o=e("loglevel");n.default={setLevel:function(e){o.setLevel(e)},trace:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.trace.apply(null,r("Sync T:",t))},debug:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.debug.apply(null,r("Sync D:",t))},info:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.info.apply(null,r("Sync I:",t))},warn:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.warn.apply(null,r("Sync W:",t))},error:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.error.apply(null,r("Sync E:",t))}}},{"babel-runtime/core-js/array/from":22,loglevel:198}],228:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/helpers/classCallCheck")),o=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(t){(0,i.default)(this,e),this.descriptor=t}return(0,o.default)(e,[{key:"update",value:function(e,t,n){return this.descriptor.last_event_id=e,this.descriptor.revision=t,this.descriptor.data=n,this}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"key",get:function(){return this.descriptor.key}},{key:"value",get:function(){return this.descriptor.data}}]),e}();n.MapItem=s,n.default=s},{"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],229:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function o(e){return e.body?e.body.code:0}function s(e){return 409===e.status?new m.SyncNetworkError(i(e),e.status,o(e),e.body):e.status?new p.SyncError(i(e),e.status,o(e)):new p.SyncError(e.message,0,0)}var a=r(e("babel-runtime/core-js/promise")),u=r(e("babel-runtime/helpers/extends")),c=r(e("babel-runtime/core-js/json/stringify")),l=r(e("babel-runtime/helpers/classCallCheck")),f=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var h=e("uuid"),d=e("./logger"),p=e("./syncerror"),m=e("./syncNetworkError"),v=e("operation-retrier"),b=function(){function e(t,n,r,i){(0,l.default)(this,e),this.productId=t,this.clientInfo=n,this.config=r,this.transport=i}return(0,f.default)(e,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":(0,c.default)(this.clientInfo),"Twilio-Request-Id":"RQ"+h.v4().replace(/-/g,""),"X-Twilio-Product-Id":this.productId,"X-Twilio-Token":this.config.token}}},{key:"backoffConfig",value:function(){return(0,u.default)({min:4e3,max:6e4,maxAttemptsTime:9e4,randomness:.2},this.config.backoffConfig)}},{key:"executeWithRetry",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new a.default(function(r,i){var o=[502,503,504];n&&o.push(429);var a=new v.default(t.backoffConfig());a.on("attempt",function(){e().then(function(e){return a.succeeded(e)}).catch(function(e){if(-1!==o.indexOf(e.status)){var t=e.headers?e.headers["Retry-After"]:null;a.failed(s(e),t)}else"Twilsock disconnected"===e.message?a.failed(s(e)):(a.removeAllListeners(),a.cancel(),i(s(e)))})}),a.on("succeeded",function(e){r(e)}),a.on("cancelled",function(e){return i(s(e))}),a.on("failed",function(e){return i(s(e))}),a.start()})}},{key:"get",value:function(e){var t=this,n=this.createHeaders();return d.default.debug("GET",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry(function(){return t.transport.get(e,n)},!0)}},{key:"post",value:function(e,t,n,r){var i=this,o=this.createHeaders();return void 0!==n&&null!==n&&(o["If-Match"]=n),d.default.debug("POST",e,"ID:",o["Twilio-Request-Id"]),this.executeWithRetry(function(){return i.transport.post(e,o,t,r)},!1)}},{key:"put",value:function(e,t,n){var r=this,i=this.createHeaders();return void 0!==n&&null!==n&&(i["If-Match"]=n),d.default.debug("PUT",e,"ID:",i["Twilio-Request-Id"]),this.executeWithRetry(function(){return r.transport.put(e,i,t)},!1)}},{key:"delete",value:function(e){var t=this,n=this.createHeaders();return d.default.debug("DELETE",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry(function(){return t.transport.delete(e,n)},!1)}}]),e}();n.Network=b,n.default=b},{"./logger":227,"./syncNetworkError":235,"./syncerror":237,"babel-runtime/core-js/json/stringify":25,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/extends":43,"operation-retrier":199,uuid:254}],230:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/regenerator")),o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/createClass")),a=r(e("babel-runtime/core-js/promise")),u=function(e,t,n,r){return new(n||(n=a.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function e(t,n,r,i){(0,o.default)(this,e),this.prevToken=r,this.nextToken=i,this.items=t,this.source=n}return(0,s.default)(e,[{key:"nextPage",value:function(){return u(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasNextPage){e.next=2;break}throw new Error("No next page");case 2:return e.abrupt("return",this.source(this.nextToken));case 3:case"end":return e.stop()}},e,this)}))}},{key:"prevPage",value:function(){return u(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasPrevPage){e.next=2;break}throw new Error("No previous page");case 2:return e.abrupt("return",this.source(this.prevToken));case 3:case"end":return e.stop()}},e,this)}))}},{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}}]),e}();n.Paginator=c,n.default=c},{"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/regenerator":48}],231:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/core-js/object/freeze")),o=r(e("babel-runtime/core-js/promise")),s=r(e("babel-runtime/helpers/classCallCheck")),a=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(){(0,s.default)(this,e),this.queue=new Array,this.isActive=!1}return(0,a.default)(e,[{key:"wakeupQueue",value:function(){var e=this;!this.isActive&&this.queue.length>0&&(this.isActive=!0,setTimeout(function(){return e.executeTask(e.queue[0])},0))}},{key:"pickNext",value:function(){var e=this;this.queue.shift(),0!==this.queue.length?setTimeout(function(){return e.executeTask(e.queue[0])},0):this.isActive=!1}},{key:"pickSame",value:function(e){var t=this;this.queue[0].arg=e,setTimeout(function(){return t.executeTask(t.queue[0])},0)}},{key:"executeTask",value:function(e){var t=this;e.task(e.context,e.arg).then(function(n){t.pickNext(),e.resolve(n)}).catch(function(n){try{if(!e.handle)throw n;e.handle(n).then(function(e){return t.pickSame(e)}).catch(e.reject)}catch(t){e.reject(n)}})}},{key:"add",value:function(e,t,n,r){var i=this;return new o.default(function(o,s){i.queue.push({task:e,context:t,arg:n,handle:r,resolve:o,reject:s}),i.wakeupQueue()})}}]),e}();n.RetryingQueue=u,(0,i.default)(u),n.default=u},{"babel-runtime/core-js/object/freeze":32,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],232:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/regenerator")),o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/createClass")),a=r(e("babel-runtime/core-js/promise")),u=function(e,t,n,r){return new(n||(n=a.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var c=e("./logger"),l="com.twilio.rtd.cds.document",f="com.twilio.rtd.cds.list",h="com.twilio.rtd.cds.map",d="twilio.sync.event",p=function(){function e(t){var n=this;(0,o.default)(this,e),this.config=t.config,this.subscriptions=t.subscriptions,this.notifications=t.notifications,this.notifications.subscribe(d),this.notifications.subscribe(l),this.notifications.subscribe(f),this.notifications.subscribe(h),this.notifications.on("message",function(e,t){return n.onMessage(e,t)}),this.notifications.on("transportReady",function(e){e&&n.onConnected()})}return(0,s.default)(e,[{key:"onMessage",value:function(e,t){switch(e){case l:case f:case h:case d:c.default.trace("Notification type:",e,"content:",t),this.subscriptions.acceptMessage(t)}}},{key:"subscribe",value:function(e,t){return u(this,void 0,void 0,i.default.mark(function n(){return i.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.subscriptions.add(e,t);case 2:case"end":return n.stop()}},n,this)}))}},{key:"unsubscribe",value:function(e,t){return u(this,void 0,void 0,i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.subscriptions.remove(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"onConnected",value:function(){this.subscriptions.poke()}}]),e}();n.Router=p,n.default=p},{"./logger":227,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/regenerator":48}],233:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/helpers/extends")),o=r(e("babel-runtime/core-js/json/stringify")),s=r(e("babel-runtime/helpers/classCallCheck")),a=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(t,n){(0,s.default)(this,e),this.config=t,this.storageId=null;try{this.storage=n||sessionStorage}catch(e){}}return(0,a.default)(e,[{key:"storageKey",value:function(e,t){return this.storageId+"::"+e+"::"+t}},{key:"updateStorageId",value:function(e){this.storageId=e}},{key:"store",value:function(e,t,n){return this.isReady?this._store(this.storageKey(e,t),n):null}},{key:"read",value:function(e,t){return this.isReady?this._read(this.storageKey(e,t)):null}},{key:"remove",value:function(e,t,n){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(e,t)),n&&this.storage.removeItem(this.storageKey(e,n))}catch(e){}}},{key:"update",value:function(e,t,n,r){if(!this.isReady)return null;this._apply(this.storageKey(e,t),r),n&&this._apply(this.storageKey(e,n),r)}},{key:"_store",value:function(e,t){try{this.storage.setItem(e,(0,o.default)(t))}catch(e){}}},{key:"_read",value:function(e){try{var t=this.storage.getItem(e);if(t)return JSON.parse(t)}catch(e){}return null}},{key:"_apply",value:function(e,t){var n=this._read(e);if(!n)return!1;this._store(e,(0,i.default)(n,t))}},{key:"isReady",get:function(){return this.config.sessionStorageEnabled&&!!this.storageId}}]),e}();n.SessionStorage=u},{"babel-runtime/core-js/json/stringify":25,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/extends":43}],234:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/regenerator")),o=r(e("babel-runtime/helpers/slicedToArray")),s=r(e("babel-runtime/core-js/get-iterator")),a=r(e("babel-runtime/helpers/extends")),u=r(e("babel-runtime/core-js/map")),c=r(e("babel-runtime/helpers/classCallCheck")),l=r(e("babel-runtime/helpers/createClass")),f=r(e("babel-runtime/core-js/promise")),h=function(e,t,n,r){return new(n||(n=f.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var d=e("backoff"),p=e("./logger"),m=e("./syncerror"),v=e("twilio-transport"),b=function(){function e(t){(0,c.default)(this,e),this.localObject=t,this.correlationId=null}return(0,l.default)(e,[{key:"markAsFailed",value:function(e){this.pendingPokeTimer&&clearTimeout(this.pendingPokeTimer),this.rejectedWithError=e}},{key:"updateLastEventId",value:function(e){this.localObject._advanceLastEventId(e)}},{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"isInTransition",get:function(){return null!==this.correlationId}}]),e}(),y=function(){function e(t){var n=this;(0,c.default)(this,e),this.services=t,this.subscriptions=new u.default,this.persisted=new u.default;var r={randomisationFactor:.2,initialDelay:100,maxDelay:12e4};this.backoff=d.exponential((0,a.default)(r,this.services.config.backoffConfig)),this.backoff.on("ready",function(){var e=n.getSubscriptionUpdateBatch(),t=e.action,r=e.subscriptions;t?n.applyNewSubscriptionUpdateBatch(t,r):(n.backoff.reset(),p.default.info("All subscriptions resolved."))})}return(0,l.default)(e,[{key:"getSubscriptionUpdateBatch",value:function(){function e(e,t,n,r){var i=[],a=!0,u=!1,c=void 0;try{for(var l,f=(0,s.default)(e);!(a=(l=f.next()).done);a=!0){var h=(0,o.default)(l.value,2),d=h[0],p=h[1];if(!t.get(d)&&(n||!p.isInTransition)&&!p.rejectedWithError&&(i.push(p),r&&i.length>=r))break}}catch(e){u=!0,c=e}finally{try{!a&&f.return&&f.return()}finally{if(u)throw c}}return i}var t=e(this.subscriptions,this.persisted,!1,1e3).map(function(e){return new b(e)});if(t.length>0)return{action:"establish",subscriptions:t};var n=e(this.persisted,this.subscriptions,!0,1e3);return n.length>0?{action:"cancel",subscriptions:n}:{action:null,subscriptions:null}}},{key:"persist",value:function(){try{this.backoff.backoff()}catch(e){}}},{key:"applyNewSubscriptionUpdateBatch",value:function(e,t){return h(this,void 0,void 0,i.default.mark(function n(){var r,o,a,u,c,l,f,h,d,m,b,y,_,g,k,w,C,x,j,E;return i.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:for(t=this.processLocalActions(e,t),r=(new Date).getTime(),o=!0,a=!1,u=void 0,n.prev=5,c=(0,s.default)(t);!(o=(l=c.next()).done);o=!0)f=l.value,this.recordActionAttemptOn(f,e,r);n.next=13;break;case 9:n.prev=9,n.t0=n.catch(5),a=!0,u=n.t0;case 13:n.prev=13,n.prev=14,!o&&c.return&&c.return();case 16:if(n.prev=16,!a){n.next=19;break}throw u;case 19:return n.finish(16);case 20:return n.finish(13);case 21:return n.prev=21,n.next=24,this.request(e,r,t.map(function(t){return{object_sid:t.sid,object_type:t.type,last_event_id:"establish"===e?t.lastEventId:void 0}}));case 24:if(h=n.sent,"establish"!==e){n.next=45;break}for(d=!0,m=!1,b=void 0,n.prev=29,y=(0,s.default)(t);!(d=(_=y.next()).done);d=!0)(g=_.value).correlationId===r&&this.beginReplayTimeout(h.body.estimated_delivery_in_ms,g,e,r);n.next=37;break;case 33:n.prev=33,n.t1=n.catch(29),m=!0,b=n.t1;case 37:n.prev=37,n.prev=38,!d&&y.return&&y.return();case 40:if(n.prev=40,!m){n.next=43;break}throw b;case 43:return n.finish(40);case 44:return n.finish(37);case 45:this.backoff.reset(),n.next=70;break;case 48:for(n.prev=48,n.t2=n.catch(21),k=!0,w=!1,C=void 0,n.prev=53,x=(0,s.default)(t);!(k=(j=x.next()).done);k=!0)E=j.value,this.recordActionFailureOn(E,e);n.next=61;break;case 57:n.prev=57,n.t3=n.catch(53),w=!0,C=n.t3;case 61:n.prev=61,n.prev=62,!k&&x.return&&x.return();case 64:if(n.prev=64,!w){n.next=67;break}throw C;case 67:return n.finish(64);case 68:return n.finish(61);case 69:n.t2 instanceof v.TwilsockUnavailableError?(p.default.debug("Twilsock connection (required for subscription) not ready (c:"+r+"); waiting"),this.backoff.reset()):(p.default.debug("Failed an attempt to "+e+" subscriptions (c:"+r+"); retrying",n.t2),this.persist());case 70:case"end":return n.stop()}},n,this,[[5,9,13,21],[14,,16,20],[21,48],[29,33,37,45],[38,,40,44],[53,57,61,69],[62,,64,68]])}))}},{key:"processLocalActions",value:function(e,t){return"cancel"===e?t.filter(function(e){return!e.rejectedWithError}):t}},{key:"recordActionAttemptOn",value:function(e,t,n){if("establish"===t)this.persisted.set(e.sid,e),e.correlationId=n;else{var r=this.persisted.get(e.sid);r&&(r.correlationId=n)}}},{key:"recordActionFailureOn",value:function(e,t){e.correlationId=null,"establish"===t&&this.persisted.delete(e.sid)}},{key:"request",value:function(e,t,n){p.default.debug("Attempting '"+e+"' request (c:"+t+"):",n);var r={event_protocol_version:3,action:e,correlation_id:t,requests:n};return this.services.network.post(this.services.config.subscriptionsUri,r,null,!0)}},{key:"beginReplayTimeout",value:function(e,t,n,r){var i=this;!isNaN(parseFloat(e))&&isFinite(e)&&e>0&&(t.pendingPokeTimer=setTimeout(function(){t.correlationId===r&&(p.default.debug("Attempt to "+n+" "+t.sid+" (c:"+r+") timed out without confirmation; trying again."),t.correlationId=null,i.persisted.delete(t.sid),i.persist())},e))}},{key:"add",value:function(e,t){p.default.debug("Establishing intent to subscribe to "+e);var n=this.subscriptions.get(e);n&&n.lastEventId===t.lastEventId||(this.persisted.delete(e),this.subscriptions.set(e,t),this.persist())}},{key:"remove",value:function(e){p.default.debug("Establishing intent to unsubscribe from "+e),this.subscriptions.delete(e)&&this.persist()}},{key:"acceptMessage",value:function(e){switch(p.default.trace("Subscriptions received",e),e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(e.event,e.correlation_id);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(e.event,e.correlation_id);break;case"subscription_failed":this.applySubscriptionFailedMessage(e.event,e.correlation_id);break;case(e.event_type.match(/^(?:map|list|document)_/)||{}).input:this.applyEventToSubscribedEntity(function(){return e.event_type.match(/^map_/)?e.event.map_sid:e.event_type.match(/^list_/)?e.event.list_sid:e.event_type.match(/^document_/)?e.event.document_sid:void 0}(),e);break;default:p.default.debug("Dropping unknown message type "+e.event_type)}}},{key:"applySubscriptionEstablishedMessage",value:function(e,t){var n=e.object_sid,r=this.persisted.get(e.object_sid);r&&r.correlationId===t?"interrupted"===e.replay_status?(p.default.debug("Event Replay for subscription to "+n+" (c:"+t+") interrupted; continuing eagerly."),clearTimeout(r.pendingPokeTimer),r.pendingPokeTimer=null,r.correlationId=null,this.persisted.delete(r.sid),this.backoff.reset()):"completed"===e.replay_status&&(p.default.debug("Event Replay for subscription to "+n+" (c:"+t+") completed. Subscription is ready."),clearTimeout(r.pendingPokeTimer),r.pendingPokeTimer=null,r.correlationId=null,r.updateLastEventId(e.last_event_id),this.persisted.set(e.object_sid,r),this.backoff.reset()):p.default.debug("Late message for "+e.object_sid+" (c:"+t+") dropped."),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(e,t){var n=this.persisted.get(e.object_sid);n&&n.correlationId===t?(clearTimeout(n.pendingPokeTimer),n.pendingPokeTimer=null,n.correlationId=null,this.persisted.delete(e.object_sid)):p.default.debug("Late message for "+e.object_sid+" (c:"+t+") dropped."),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(e,t){var n=e.object_sid,r=this.subscriptions.get(n),i=this.persisted.get(n);r&&i?i.correlationId===t&&(i.markAsFailed(e.error),p.default.error("Failed to subscribe on "+i.sid,e.error),r.reportFailure(new m.SyncError("Failed to subscribe on service events: "+e.error.message,e.error.status,e.error.code))):!r&&i&&this.persisted.delete(n),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(e,t){var n=e?this.subscriptions.get(e):null;n?(t.event.type=t.event_type,n._update(t.event)):p.default.debug("Message dropped for SID '"+e+"', for which there is no subscription.")}},{key:"poke",value:function(){p.default.info("Triggering event replay for all subscriptions.");var e=[],t=!0,n=!1,r=void 0;try{for(var i,a=(0,s.default)(this.persisted);!(t=(i=a.next()).done);t=!0){var u=(0,o.default)(i.value,2),c=(u[0],u[1]);clearTimeout(c.pendingPokeTimer),c.pendingPokeTimer=null,c.correlationId=null,c.rejectedWithError&&e.push(c)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}this.persisted.clear();var l=!0,f=!1,h=void 0;try{for(var d,m=(0,s.default)(e);!(l=(d=m.next()).done);l=!0){c=d.value;this.persisted.set(c.sid,c)}}catch(e){f=!0,h=e}finally{try{!l&&m.return&&m.return()}finally{if(f)throw h}}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),e}();n.Subscriptions=y,n.default=y},{"./logger":227,"./syncerror":237,"babel-runtime/core-js/get-iterator":23,"babel-runtime/core-js/map":26,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/extends":43,"babel-runtime/helpers/slicedToArray":46,"babel-runtime/regenerator":48,backoff:49,"twilio-transport":244}],235:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/core-js/object/get-prototype-of")),o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/possibleConstructorReturn")),a=r(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{value:!0});var u=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments[3];(0,o.default)(this,t);var u=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n,r));return u.body=a,u}return(0,a.default)(t,e),t}(e("./syncerror").SyncError);n.SyncNetworkError=u,n.default=u},{"./syncerror":237,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45}],236:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/helpers/extends")),o=r(e("babel-runtime/regenerator")),s=r(e("babel-runtime/core-js/object/get-prototype-of")),a=r(e("babel-runtime/helpers/classCallCheck")),u=r(e("babel-runtime/helpers/createClass")),c=r(e("babel-runtime/helpers/possibleConstructorReturn")),l=r(e("babel-runtime/helpers/inherits")),f=r(e("babel-runtime/core-js/promise")),h=function(e,t,n,r){return new(n||(n=f.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var d=e("./logger"),p=e("./entity"),m=e("rfc6902"),v=e("./retryingqueue"),b=function(e){function t(e,n,r){(0,a.default)(this,t);var i=(0,c.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e,r));return i.actionQueue=new v.RetryingQueue,i.descriptor=n,i.descriptor.data=i.descriptor.data||{},i}return(0,l.default)(t,e),(0,u.default)(t,[{key:"_update",value:function(e){switch(e.type){case"document_updated":if(e.id>this.lastEventId){var t=this.descriptor.data;this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.data=e.document_data,this.traverse(t,e.document_data,!1),this.emit("updated",e.document_data,!1),this.emit("updatedRemotely",e.document_data),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.id,revision:e.document_revision,data:e.document_data})}break;case"document_removed":this.onRemoved(!1)}}},{key:"traverse",value:function(e,t,n){var r=this;m.createPatch(e,t).forEach(function(e){"add"===e.op?(r.emit("keyAdded",e.path,e.value,n),n||r.emit("keyAddedRemotely",e.path,e.value)):"replace"===e.op?(r.emit("keyUpdated",e.path,e.value,n),n||r.emit("keyUpdatedRemotely",e.path,e.value)):"remove"===e.op&&(r.emit("keyRemoved",e.path,n),n||r.emit("keyRemovedRemotely",e.path))})}},{key:"get",value:function(e){return this.value}},{key:"set",value:function(e,t){return this._actualSet(e,t?function(){throw new Error("Revision mismatch")}:null)}},{key:"_actualSet",value:function(e,t){var n=this,r=void 0,i={data:e,revision:t?this.revision:void 0};return t&&(r=function(r){return h(n,void 0,void 0,o.default.mark(function n(){return o.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(412!==r.status){n.next=4;break}return n.next=3,this.softSync();case 3:return n.abrupt("return",{revision:this.revision,data:t(this.value,e)});case 4:throw r;case 5:case"end":return n.stop()}},n,this)}))}),this.actionQueue.add(this._set.bind(this),this.uri,i,r).then(function(e){return e.last_event_id>n.descriptor.last_event_id&&(n.descriptor.revision=e.revision,n.descriptor.data=e.data,n.descriptor.last_event_id=e.last_event_id,n.services.storage.update(n.type,n.sid,n.uniqueName,{last_event_id:e.last_event_id,revision:e.revision,data:e.data})),n.emit("updated",n.value,!0),n.value})}},{key:"mutate",value:function(e){return h(this,void 0,void 0,o.default.mark(function t(){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._actualSet(e(this.value),e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"update",value:function(e){return this.mutate(function(t){return(0,i.default)(t,e)})}},{key:"_set",value:function(e,t){return h(this,void 0,void 0,o.default.mark(function e(){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.post(this.uri,{data:t.data},t.revision);case 2:return n=e.sent,e.abrupt("return",{revision:n.body.revision,data:t.data,last_event_id:n.body.last_event_id});case 4:case"end":return e.stop()}},e,this)}))}},{key:"softSync",value:function(){var e=this;return this.services.network.get(this.uri).then(function(t){return e._update({type:"document_updated",id:t.body.last_event_id,document_revision:t.body.revision,document_data:t.body.data}),e}).catch(function(t){404===t.status?e.onRemoved(!1):d.default.error("Can't get updates for "+e.sid+":",t)})}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",e),e||this.emit("removedRemotely")}},{key:"removeDocument",value:function(){return h(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},e,this)}))}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"value",get:function(){return this.descriptor.data}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"type",get:function(){return"document"}}],[{key:"type",get:function(){return"document"}}]),t}(p.SyncEntity);n.SyncDocument=b,n.default=b},{"./entity":224,"./logger":227,"./retryingqueue":231,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/extends":43,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,"babel-runtime/regenerator":48,rfc6902:207}],237:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/core-js/object/get-prototype-of")),o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/possibleConstructorReturn")),a=r(e("babel-runtime/helpers/inherits"));Object.defineProperty(n,"__esModule",{value:!0});var u=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,o.default)(this,t);var a=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return a.name=a.constructor.name,a.message=e,a.status=n,a.code=r,a}return(0,a.default)(t,e),t}(Error);n.SyncError=u,n.default=u},{"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45}],238:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/helpers/extends")),o=r(e("babel-runtime/regenerator")),s=r(e("babel-runtime/core-js/object/get-prototype-of")),a=r(e("babel-runtime/helpers/classCallCheck")),u=r(e("babel-runtime/helpers/createClass")),c=r(e("babel-runtime/helpers/possibleConstructorReturn")),l=r(e("babel-runtime/helpers/inherits")),f=r(e("babel-runtime/core-js/promise")),h=function(e,t,n,r){return new(n||(n=f.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var d=e("./utils"),p=e("./logger"),m=e("./entity"),v=e("./retryingqueue"),b=e("./listitem"),y=e("./paginator"),_=e("./cache"),g=function(e){function t(e,n,r){(0,a.default)(this,t);var i=(0,c.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e,r));return i.actionQueue=new v.RetryingQueue,i.cache=new _.Cache,i.descriptor=n,i}return(0,l.default)(t,e),(0,u.default)(t,[{key:"__set",value:function(e,t){return h(this,void 0,void 0,o.default.mark(function n(){var r;return o.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.services.network.post(e,{data:t.data},t.revision);case 2:return r=n.sent,r.body.data=t.data,n.abrupt("return",r.body);case 5:case"end":return n.stop()}},n,this)}))}},{key:"_set",value:function(e,t,n){return h(this,void 0,void 0,o.default.mark(function r(){var i,s,a=this;return o.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n){r.next=5;break}return r.next=3,this.services.network.post(e.uri,{data:t});case 3:return i=r.sent,r.abrupt("return",e.update(i.body.last_event_id,i.body.revision,t));case 5:return s=function(r){if(412===r.status)return a.queryEvents().then(function(){return a.get(e.index)}).then(function(e){return{revision:e.revision,data:n(e.value,t)}});throw r},r.abrupt("return",this.actionQueue.add(this.__set.bind(this),e.uri,{revision:e.revision,data:t},s).then(function(t){return e.update(t.last_event_id,t.revision,t.data)}));case 7:case"end":return r.stop()}},r,this)}))}},{key:"push",value:function(e){return h(this,void 0,void 0,o.default.mark(function t(){var n,r,i;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.services.network.post(this.links.items,{data:e});case 2:return n=t.sent,r=Number(n.body.index),i=this.cache.store(r,new b.ListItem({index:r,revision:n.body.revision,lastEventId:n.body.last_event_id,uri:n.body.url,value:e}),n.body.last_event_id),this.emit("itemAdded",i,!0),t.abrupt("return",i);case 7:case"end":return t.stop()}},t,this)}))}},{key:"set",value:function(e,t){return this._actualSet(e,t)}},{key:"_actualSet",value:function(e,t,n){return h(this,void 0,void 0,o.default.mark(function r(){var i;return o.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.get(e);case 2:return i=r.sent,r.next=5,this._set(i,t,n);case 5:return i=r.sent,this.emit("itemUpdated",i,!0),r.abrupt("return",i);case 8:case"end":return r.stop()}},r,this)}))}},{key:"mutate",value:function(e,t){return h(this,void 0,void 0,o.default.mark(function n(){var r;return o.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.get(e);case 2:return r=n.sent,n.abrupt("return",this._actualSet(e,t(r.value),t));case 4:case"end":return n.stop()}},n,this)}))}},{key:"update",value:function(e,t){return h(this,void 0,void 0,o.default.mark(function n(){return o.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.mutate(e,function(e){return(0,i.default)(e,t)}));case 1:case"end":return n.stop()}},n,this)}))}},{key:"remove",value:function(e){return h(this,void 0,void 0,o.default.mark(function t(){var n,r;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get(e);case 2:return n=t.sent,t.next=5,this.services.network.delete(n.uri);case 5:r=t.sent,this.cache.delete(e,r.body.last_event_id),this.emit("itemRemoved",e,!0);case 8:case"end":return t.stop()}},t,this)}))}},{key:"get",value:function(e){return h(this,void 0,void 0,o.default.mark(function t(){var n,r;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=this.cache.get(e))){t.next=3;break}return t.abrupt("return",n);case 3:return t.next=5,this.queryItems({index:e});case 5:if(!((r=t.sent).items.length<1)){t.next=8;break}throw new Error("No item with index "+e+" found");case 8:return t.abrupt("return",this.cache.store(e,r.items[0],r.items[0].lastEventId));case 9:case"end":return t.stop()}},t,this)}))}},{key:"queryEvents",value:function(){return h(this,void 0,void 0,o.default.mark(function e(){var t,n,r=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.links.events+"?From="+(this.lastEventId+1)+"&PageSize=100",e.next=3,this.services.network.get(t);case 3:(n=e.sent).body.events.forEach(function(e){return r._update(e)});case 5:case"end":return e.stop()}},e,this)}))}},{key:"queryItems",value:function(e){return h(this,void 0,void 0,o.default.mark(function t(){var n,r,i,s,a=this;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},n=new d.UriBuilder(this.links.items).arg("From",e.from).arg("PageSize",e.limit).arg("Index",e.index).arg("PageToken",e.pageToken).arg("Order",e.order).build(),t.next=4,this.services.network.get(n);case 4:return r=t.sent,i=r.body.items.map(function(e){return a.cache.store(Number(e.index),new b.ListItem({index:Number(e.index),uri:e.url,revision:e.revision,lastEventId:e.last_event_id,value:e.data}),e.last_event_id)}),s=r.body.meta,t.abrupt("return",new y.Paginator(i,function(e){return a.queryItems({pageToken:e})},s.previous_token,s.next_token));case 8:case"end":return t.stop()}},t,this)}))}},{key:"getItems",value:function(e){return h(this,void 0,void 0,o.default.mark(function t(){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},e.limit=e.pageSize||e.limit||50,e.order=e.order||"asc",t.abrupt("return",this.queryItems(e));case 4:case"end":return t.stop()}},t,this)}))}},{key:"getContext",value:function(){return h(this,void 0,void 0,o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.context){e.next=2;break}return e.abrupt("return",this.context);case 2:return e.next=4,this.services.network.get(this.links.context);case 4:return t=e.sent,this.context=t.body.data,e.abrupt("return",this.context);case 7:case"end":return e.stop()}},e,this)}))}},{key:"updateContext",value:function(e){return h(this,void 0,void 0,o.default.mark(function t(){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.services.network.post(this.links.context,{data:e});case 3:return this.context=e,this.emit("contextUpdated",e,!0),t.abrupt("return",this);case 8:throw t.prev=8,t.t0=t.catch(0),p.default.error("Failed to update context",t.t0),t.t0;case 12:case"end":return t.stop()}},t,this,[[0,8]])}))}},{key:"removeList",value:function(){return h(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},e,this)}))}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("collectionRemoved",e),e||this.emit("collectionRemovedRemotely")}},{key:"softSync",value:function(){return h(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.queryEvents();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),404===e.t0.status?this.onRemoved(!1):p.default.error("Can't get updates for "+this.sid+":",e.t0);case 8:case"end":return e.stop()}},e,this,[[0,5]])}))}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e){var t=Number(e.item_index);switch(e.type){case"list_item_added":this._handleItemAdded(t,e.item_url,e.id,e.item_revision,e.item_data);break;case"list_item_updated":this._handleItemUpdated(t,e.item_url,e.id,e.item_revision,e.item_data);break;case"list_item_removed":this._handleItemRemoved(t,e.id);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id);break;case"list_removed":this.onRemoved(!1)}this._advanceLastEventId(e.id,e.list_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_handleItemAdded",value:function(e,t,n,r,i){if(!this.cache.isKnown(e,n)){var o=new b.ListItem({index:e,uri:t,lastEventId:n,revision:r,value:i});this.cache.store(e,o,n),this.emit("itemAdded",o,!1),this.emit("itemAddedRemotely",o)}}},{key:"_handleItemUpdated",value:function(e,t,n,r,i){var o=this.cache.get(e);o||this.shouldIgnoreEvent(e,n)?o&&n>o.lastEventId&&(o.update(n,r,i),this.emit("itemUpdated",o,!1),this.emit("itemUpdatedRemotely",o)):(o=this.cache.store(e,new b.ListItem({index:e,uri:t,lastEventId:n,revision:r,value:i}),n),this.emit("itemUpdated",o,!1),this.emit("itemUpdatedRemotely",o))}},{key:"_handleItemRemoved",value:function(e,t){this.cache.delete(e,t),this.emit("itemRemoved",e,!1),this.emit("itemRemovedRemotely",e)}},{key:"_handleContextUpdate",value:function(e,t){this.lastEventId<t&&(this.context=e,this.emit("contextUpdated",e,!1),this.emit("contextUpdatedRemotely",e))}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"type",get:function(){return"list"}}],[{key:"type",get:function(){return"list"}}]),t}(m.SyncEntity);n.SyncList=g,n.default=g},{"./cache":219,"./entity":224,"./listitem":226,"./logger":227,"./paginator":230,"./retryingqueue":231,"./utils":240,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/extends":43,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,"babel-runtime/regenerator":48}],239:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/helpers/extends")),o=r(e("babel-runtime/regenerator")),s=r(e("babel-runtime/core-js/object/get-prototype-of")),a=r(e("babel-runtime/helpers/classCallCheck")),u=r(e("babel-runtime/helpers/createClass")),c=r(e("babel-runtime/helpers/possibleConstructorReturn")),l=r(e("babel-runtime/helpers/inherits")),f=r(e("babel-runtime/core-js/promise")),h=function(e,t,n,r){return new(n||(n=f.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var d=e("./utils"),p=e("./logger"),m=e("./entity"),v=e("./retryingqueue"),b=e("./mapitem"),y=e("./paginator"),_=e("./cache"),g=function(e){function t(e,n,r){(0,a.default)(this,t);var i=(0,c.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e,r));return i.actionQueue=new v.RetryingQueue,i.cache=new _.Cache,i.descriptor=n,n.items&&n.items.forEach(function(e){i.cache.store(e.key,new b.MapItem(e),e.last_event_id)}),i}return(0,l.default)(t,e),(0,u.default)(t,[{key:"_get",value:function(e){return this.queryItems({key:e}).then(function(t){if(t.items.length<1)throw new Error("No item with key "+e+" found");return t.items[0]})}},{key:"__set",value:function(e,t){return this.services.network.post(e,{data:t.data},t.revision).then(function(e){return e=e.body,e.data=t.data,e})}},{key:"_set",value:function(e,t,n){return h(this,void 0,void 0,o.default.mark(function r(){var i,s=this;return o.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n){r.next=2;break}return r.abrupt("return",this.__set(e,{data:t.data}));case 2:return i=function(e){return h(s,void 0,void 0,o.default.mark(function r(){var i;return o.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(412!==e.status){r.next=7;break}return r.next=3,this.queryEvents();case 3:return r.next=5,this.get(t.key);case 5:return i=r.sent,r.abrupt("return",{revision:i.revision,data:n(i.value,t.data)});case 7:throw e;case 8:case"end":return r.stop()}},r,this)}))},r.abrupt("return",this.actionQueue.add(this.__set.bind(this),e,{revision:t.revision,data:t.data},i));case 4:case"end":return r.stop()}},r,this)}))}},{key:"_tryAddOrUpdate",value:function(e,t,n){return h(this,void 0,void 0,o.default.mark(function r(){var i,s,a,u,c;return o.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.services.network.post(e,t);case 3:return i=r.sent,i.body.data=t.data,r.abrupt("return",{added:!0,value:i.body});case 8:if(r.prev=8,r.t0=r.catch(0),409===r.t0.status){r.next=12;break}throw r.t0;case 12:if(s=r.t0.body.links.item,n){r.next=20;break}return r.next=16,this._set(s,t,n);case 16:return a=r.sent,r.abrupt("return",{added:!1,value:a});case 20:return r.next=22,this.services.network.get(s);case 22:return u=r.sent,r.next=25,this._set(s,{key:u.key,revision:u.revision,data:t},n);case 25:return c=r.sent,r.abrupt("return",{added:!1,value:c});case 27:case"end":return r.stop()}},r,this,[[0,8]])}))}},{key:"queryEvents",value:function(){return h(this,void 0,void 0,o.default.mark(function e(){var t,n,r=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.descriptor.links.events+"?From="+(this.lastEventId+1)+"&PageSize=100",e.next=4,this.services.network.get(t);case 4:(n=e.sent).body.events.forEach(function(e){return r._update(e)}),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),p.default.error("Failed to fetch events:",e.t0),e.t0;case 12:case 13:case"end":return e.stop()}},e,this,[[0,8]])}))}},{key:"getContext",value:function(){return h(this,void 0,void 0,o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.context){e.next=2;break}return e.abrupt("return",this.context);case 2:return e.next=4,this.services.network.get(this.links.context);case 4:return t=e.sent,this.context=t.body.data,e.abrupt("return",this.context);case 7:case"end":return e.stop()}},e,this)}))}},{key:"updateContext",value:function(e){return h(this,void 0,void 0,o.default.mark(function t(){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.services.network.post(this.links.context,{data:e});case 2:this.context=e,this.emit("contextUpdated",e,!0);case 4:case"end":return t.stop()}},t,this)}))}},{key:"set",value:function(e,t){return this._actualSet(e,t)}},{key:"_actualSet",value:function(e,t,n){return h(this,void 0,void 0,o.default.mark(function r(){var i,s,a,u,c,l;return o.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i=this.cache.get(e))){r.next=9;break}return s={key:e,data:t,revision:i.revision||void 0},r.next=5,this._set(i.uri,s,n);case 5:return a=r.sent,i.update(a.last_event_id,a.revision,a.data),this.emit("itemUpdated",i,!0),r.abrupt("return",i);case 9:return r.next=11,this._tryAddOrUpdate(this.links.items,{key:e,data:t},n);case 11:return u=r.sent,c=u.added,l=u.value,r.next=16,this.cache.get(e);case 16:return i=r.sent,i&&l.lastEventId>i.lastEventId?i.update(l.lastEventId,l.revision,l.value):i||(i=this.cache.store(e,new b.MapItem(l),l.lastEventId),c?this.emit("itemAdded",i,!0):this.emit("itemUpdated",i,!0)),r.abrupt("return",i);case 19:case"end":return r.stop()}},r,this)}))}},{key:"get",value:function(e){return h(this,void 0,void 0,o.default.mark(function t(){var n;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.cache.has(e)){t.next=2;break}return t.abrupt("return",this.cache.get(e));case 2:return t.next=4,this.queryItems({key:e});case 4:if(!((n=t.sent).items.length<1)){t.next=7;break}throw new Error("No item with key "+e+" found");case 7:return t.abrupt("return",n.items[0]);case 8:case"end":return t.stop()}},t,this)}))}},{key:"mutate",value:function(e,t){return h(this,void 0,void 0,o.default.mark(function n(){var r;return o.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.get(e).then(function(e){return e.value}).catch(function(){return{}});case 2:return r=n.sent,n.abrupt("return",this._actualSet(e,t(r),t));case 4:case"end":return n.stop()}},n,this)}))}},{key:"update",value:function(e,t){return h(this,void 0,void 0,o.default.mark(function n(){return o.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.mutate(e,function(e){return(0,i.default)(e,t)}));case 1:case"end":return n.stop()}},n,this)}))}},{key:"remove",value:function(e){return h(this,void 0,void 0,o.default.mark(function t(){var n,r;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e){t.next=2;break}throw new Error("Key argument is invalid");case 2:return t.next=4,this.get(e);case 4:return n=t.sent,t.next=7,this.services.network.delete(n.uri);case 7:r=t.sent,this.cache.delete(e,r.body.last_event_id),this.emit("itemRemoved",e,!0);case 10:case"end":return t.stop()}},t,this)}))}},{key:"queryItems",value:function(e){return h(this,void 0,void 0,o.default.mark(function t(){var n,r,i,s,a=this;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},n=new d.UriBuilder(this.links.items).arg("From",e.from).arg("PageSize",e.limit).arg("Key",e.key).arg("PageToken",e.pageToken).arg("Order",e.order).build(),t.next=4,this.services.network.get(n);case 4:return r=t.sent,i=r.body.items.map(function(e){return a.cache.store(e.key,new b.MapItem(e),e.last_event_id)}),s=r.body.meta,t.abrupt("return",new y.Paginator(i,function(e){return a.queryItems({pageToken:e})},s.previous_token,s.next_token));case 8:case"end":return t.stop()}},t,this)}))}},{key:"getItems",value:function(e){return h(this,void 0,void 0,o.default.mark(function t(){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},e.limit=e.pageSize||e.limit||50,e.order=e.order||"asc",t.abrupt("return",this.queryItems(e));case 4:case"end":return t.stop()}},t,this)}))}},{key:"softSync",value:function(){return h(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.queryEvents();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),404===e.t0.status?this.onRemoved(!1):p.default.error("Can't get updates for "+this.sid+":",e.t0);case 8:case"end":return e.stop()}},e,this,[[0,5]])}))}},{key:"forEach",value:function(e){var t=this;return new f.default(function(n,r){function i(t){t.items.forEach(function(t){return e(t)}),t.hasNextPage?t.nextPage().then(i).catch(r):n()}t.queryItems().then(i).catch(r)})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e){switch(e.type){case"map_item_added":this._handleItemAdded(e.item_key,e.item_url,e.id,e.item_revision,e.item_data);break;case"map_item_updated":this._handleItemUpdated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id);break;case"map_context_updated":this._handleContextUpdate(e.context_data,e.id);break;case"map_removed":this.onRemoved(!1)}this._advanceLastEventId(e.id,e.map_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_handleItemAdded",value:function(e,t,n,r,i){if(!this.cache.has(e)&&!this.shouldIgnoreEvent(e,n)){var o=new b.MapItem({key:e,url:t,last_event_id:n,revision:r,data:i});this.cache.store(e,o,n),this.emit("itemAdded",o,!1),this.emit("itemAddedRemotely",o)}}},{key:"_handleItemUpdated",value:function(e,t,n,r,i){var o=this.cache.get(e);o||this.shouldIgnoreEvent(e,n)?o&&n>o.lastEventId&&(o.update(n,r,i),this.emit("itemUpdated",o,!1),this.emit("itemUpdatedRemotely",o)):(o=new b.MapItem({key:e,url:t,last_event_id:n,revision:r,data:i}),this.cache.store(e,o,n),this.emit("itemUpdated",o,!1),this.emit("itemUpdatedRemotely",o))}},{key:"_handleItemRemoved",value:function(e,t){this.cache.delete(e,t),this.emit("itemRemoved",e,!1),this.emit("itemRemovedRemotely",e,!1)}},{key:"_handleContextUpdate",value:function(e,t){this.lastEventId<t&&(this.context=e,this.emit("contextUpdated",e,!1),this.emit("contextUpdatedRemotely",e))}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("collectionRemoved",e),e||this.emit("collectionRemovedRemotely")}},{key:"removeMap",value:function(){return h(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},e,this)}))}},{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"type",get:function(){return"map"}}],[{key:"type",get:function(){return"map"}}]),t}(m.SyncEntity);n.SyncMap=g,n.default=g},{"./cache":219,"./entity":224,"./logger":227,"./mapitem":228,"./paginator":230,"./retryingqueue":231,"./utils":240,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/extends":43,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,"babel-runtime/regenerator":48}],240:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return JSON.parse((0,a.default)(e))}var o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/createClass")),a=r(e("babel-runtime/core-js/json/stringify"));Object.defineProperty(n,"__esModule",{value:!0}),n.deepClone=i;var u=function(){function e(t){(0,o.default)(this,e),this.base=t,this.args=new Array,this.paths=new Array}return(0,s.default)(e,[{key:"path",value:function(e){return this.paths.push(e),this}},{key:"arg",value:function(e,t){return void 0!==t&&this.args.push(e+"="+encodeURIComponent(t)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();n.UriBuilder=u},{"babel-runtime/core-js/json/stringify":25,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],241:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("babel-runtime/core-js/promise")),o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/createClass"));Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(){var t=this;(0,o.default)(this,e),this._promise=new i.default(function(e,n){t._resolve=e,t._reject=n})}return(0,s.default)(e,[{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}},{key:"promise",get:function(){return this._promise}}]),e}();n.Deferred=a},{"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],242:[function(e,t,n){t.exports={_args:[[{raw:"twilio-sync@^0.5.0",scope:null,escapedName:"twilio-sync",name:"twilio-sync",rawSpec:"^0.5.0",spec:">=0.5.0 <0.6.0",type:"range"},"/var/lib/jenkins/jobs/twilio-chat.js/workspace"]],_from:"twilio-sync@>=0.5.0 <0.6.0",_id:"twilio-sync@0.5.3",_inCache:!0,_location:"/twilio-sync",_nodeVersion:"7.7.1",_npmOperationalInternal:{host:"packages-12-west.internal.npmjs.com",tmp:"tmp/twilio-sync-0.5.3.tgz_1490299378756_0.1648261109367013"},_npmUser:{name:"twilio-ci",email:"mroberts+twilio-ci@twilio.com"},_npmVersion:"4.1.2",_phantomChildren:{},_requested:{raw:"twilio-sync@^0.5.0",scope:null,escapedName:"twilio-sync",name:"twilio-sync",rawSpec:"^0.5.0",spec:">=0.5.0 <0.6.0",type:"range"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/twilio-sync/-/twilio-sync-0.5.3.tgz",_shasum:"f07d93b72a27dd42b4def1fb4812f56a7845c0df",_shrinkwrap:null,_spec:"twilio-sync@^0.5.0",_where:"/var/lib/jenkins/jobs/twilio-chat.js/workspace",author:{name:"Twilio"},browser:"browser/index.js",dependencies:{"babel-runtime":"^6.23.0",karibu:"^1.0.1",loglevel:"^1.4.1","operation-retrier":"^1.1.2",platform:"^1.3.3",rfc6902:"^1.3.0","twilio-ems-client":"^0.2.0","twilio-notifications":"^0.4.0","twilio-transport":"^0.1.1",twilsock:"^0.3.0",uuid:"^3.0.1",xxhashjs:"^0.2.1"},description:"Twilio Sync client library",devDependencies:{"@types/chai":"^3.4.35","@types/chai-as-promised":"0.0.29","@types/loglevel":"^1.4.29","@types/mocha":"^2.2.39","@types/node":"^7.0.5","@types/sinon":"^1.16.35","@types/sinon-as-promised":"^4.0.5","@types/sinon-chai":"^2.7.27","async-test-tools":"^1.0.6","babel-cli":"^6.23.0","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-array-includes":"^2.0.3","babel-plugin-transform-object-assign":"^6.22.0","babel-plugin-transform-runtime":"^6.23.0","babel-preset-es2015":"^6.22.0",babelify:"^7.3.0",backoff:"^2.5.0",browserify:"^14.1.0",chai:"^3.5.0","chai-as-promised":"^6.0.0",cheerio:"^0.22.0",del:"^2.2.2","event-to-promise":"^0.8.0",gulp:"^3.9.1","gulp-babel":"^6.1.2","gulp-derequire":"^2.1.0","gulp-exit":"0.0.2","gulp-insert":"^0.5.0","gulp-istanbul":"^1.1.1","gulp-mocha":"^4.0.1","gulp-rename":"^1.2.2","gulp-replace":"^0.5.4","gulp-tap":"^0.1.3","gulp-tslint":"^7.1.0","gulp-typescript":"^3.1.5","gulp-uglify":"^2.0.1","gulp-util":"^3.0.8","ink-docstrap":"^1.3.0",isparta:"^4.0.0",jsdoc:"^3.4.3",jsonwebtoken:"^7.3.0",karma:"^1.5.0","karma-browserify":"^5.1.1","karma-browserstack-launcher":"^1.2.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.2","run-sequence":"^1.2.2",sinon:"^1.17.7","sinon-as-promised":"^4.0.2","sinon-chai":"^2.8.0","ts-node":"^2.1.0",tslint:"^4.5.1",twilio:"^3.3.0-edge",typescript:"^2.2.1",underscore:"^1.8.3","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0",watchify:"^3.9.0"},directories:{},dist:{shasum:"f07d93b72a27dd42b4def1fb4812f56a7845c0df",tarball:"https://registry.npmjs.org/twilio-sync/-/twilio-sync-0.5.3.tgz"},engines:{node:">=6"},gitHead:"87cd7d3b73030d673f1a3133f5c738c40866487b",license:"MIT",main:"lib/index.js",maintainers:[{name:"schertkov",email:"schertkov@twilio.com"},{name:"twilio-ci",email:"mroberts+twilio-ci@twilio.com"}],name:"twilio-sync",optionalDependencies:{},readme:"ERROR: No README data found!",scripts:{prepublish:"gulp build",test:"gulp unit-test"},version:"0.5.3"}},{}],243:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return e.split("\r\n").map(function(e){return e.split(": ")}).filter(function(e){return 2===e.length&&e[1].length>0}).reduce(function(e,t){return e[t[0]]=t[1],e},{})}function s(e){var t=e.getResponseHeader("Content-Type");if(!t||0!==t.indexOf("application/json")||0===e.responseText.length)return e.responseText;try{return JSON.parse(e.responseText)}catch(t){return e.responseText}}var a=r(e("babel-runtime/core-js/json/stringify")),u=r(e("babel-runtime/core-js/promise")),c=r(e("babel-runtime/core-js/object/define-property"));Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,c.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f="undefined"==typeof XMLHttpRequest?e("xmlhttprequest").XMLHttpRequest:XMLHttpRequest,h=function(){function e(){i(this,e)}return l(e,null,[{key:"request",value:function(e,t){return new u.default(function(n,r){var i=new f;i.open(e,t.url,!0),i.onreadystatechange=function(){if(4===i.readyState){var e=o(i.getAllResponseHeaders()),t=s(i);200<=i.status&&i.status<300?n({status:i.status,headers:e,body:t}):r({status:i.status,description:i.statusText,headers:e,body:t})}};for(var u in t.headers)i.setRequestHeader(u,t.headers[u]),"Content-Type"===u&&"application/json"===t.headers[u]&&(t.body=(0,a.default)(t.body));i.send(t.body)})}},{key:"get",value:function(e){return this.request("GET",e)}},{key:"post",value:function(e){return this.request("POST",e)}},{key:"put",value:function(e){return this.request("PUT",e)}},{key:"delete",value:function(e){return this.request("DELETE",e)}}]),e}();n.default=h,t.exports=h,t.exports=n.default},{"babel-runtime/core-js/json/stringify":25,"babel-runtime/core-js/object/define-property":31,"babel-runtime/core-js/promise":36,xmlhttprequest:61}],244:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,C.default)(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,C.default)(t)));e.prototype=(0,w.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(k.default?(0,k.default)(e,t):e.__proto__=t)}function a(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var n={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7]};if(n.search.length>0){var r=n.search.substring(1);n.params=r.split("&").map(function(e){return e.split("=")}).reduce(function(e,t){return e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e},{})}return n}throw new Error("Incorrect URI: "+e)}function u(e,t){var n=a(t),r={method:e,host:n.host,path:n.pathname};return n.params&&(r.params=n.params),r}function c(e,t,n,r){return{to:u(e,t),headers:n,body:r}}function l(e){return{status:e.status,headers:e.header.http_headers,body:e.body}}function f(e,t,n){return{url:e,headers:t,body:n}}function h(e){try{e.body=JSON.parse(e.body)}catch(e){}return e}function d(e){for(var t=(0,b.default)(e.headers),n=t.length,r={};n--;){var i=t[n];r[i.toLowerCase()]=e.headers[i]}return e.headers=r,e}var p=r(e("babel-runtime/core-js/promise")),m=r(e("babel-runtime/core-js/map")),v=r(e("babel-runtime/core-js/object/define-properties")),b=r(e("babel-runtime/core-js/object/keys")),y=r(e("babel-runtime/core-js/object/get-prototype-of")),_=r(e("babel-runtime/core-js/array/from")),g=r(e("babel-runtime/core-js/reflect/construct")),k=r(e("babel-runtime/core-js/object/set-prototype-of")),w=r(e("babel-runtime/core-js/object/create")),C=r(e("babel-runtime/helpers/typeof")),x=r(e("babel-runtime/core-js/object/define-property"));Object.defineProperty(n,"__esModule",{value:!0}),n.TwilsockUnavailableError=n.Transport=void 0;var j=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,x.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),E=function(e){return e&&e.__esModule?e:{default:e}}(e("./httprequest")),S=function(e){function t(){return i(this,t),o(this,(t.__proto__||(0,y.default)(t)).call(this))}return s(t,e),t}(function(e){function t(){var t=(0,g.default)(e,(0,_.default)(arguments));return(0,k.default)(t,(0,y.default)(this)),t}return t.prototype=(0,w.default)(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),k.default?(0,k.default)(t,e):t.__proto__=e,t}(Error)),T=function(){function e(t){var n=this;i(this,e),(0,v.default)(this,{_activeGetRequests:{value:new m.default},_twilsock:{value:t},_http:{value:E.default},_twilsockIsAvailable:{get:function(){return n._twilsock&&n._twilsock.isConnected}}}),t&&t.connect()}return j(e,[{key:"get",value:function(e,t,n){var r=this;if(this._activeGetRequests.has(e))return this._activeGetRequests.get(e);var i=this._get(e,t,n).then(function(t){return r._activeGetRequests.delete(e),t}).catch(function(t){throw r._activeGetRequests.delete(e),t});return this._activeGetRequests.set(e,i),i}},{key:"_oneOfBasedOnChannelAvailability",value:function(e,t){var n=this;return function(e){var r=e.sendViaTwilsock,i=e.sendDirectHttp;return n._twilsockIsAvailable?r():t?p.default.reject(new S):i()}(e).then(d)}},{key:"_get",value:function(e,t,n){var r=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return r._twilsock.send(c("GET",e,t)).then(l)},sendDirectHttp:function(){return r._http.get(f(e,t)).then(h)}},n)}},{key:"post",value:function(e,t,n,r){var i=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return i._twilsock.send(c("POST",e,t,n)).then(l)},sendDirectHttp:function(){return i._http.post(f(e,t,n)).then(h)}},r)}},{key:"put",value:function(e,t,n,r){var i=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return i._twilsock.send(c("PUT",e,t,n)).then(l)},sendDirectHttp:function(){return i._http.put(f(e,t,n)).then(h)}},r)}},{key:"delete",value:function(e,t,n){var r=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return r._twilsock.send(c("DELETE",e,t)).then(l)},sendDirectHttp:function(){return r._http.delete(f(e,t)).then(h)}},n)}}]),e}();n.default=T,n.Transport=T,n.TwilsockUnavailableError=S},{"./httprequest":243,"babel-runtime/core-js/array/from":22,"babel-runtime/core-js/map":26,"babel-runtime/core-js/object/create":29,"babel-runtime/core-js/object/define-properties":30,"babel-runtime/core-js/object/define-property":31,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/object/keys":34,"babel-runtime/core-js/object/set-prototype-of":35,"babel-runtime/core-js/promise":36,"babel-runtime/core-js/reflect/construct":37,"babel-runtime/helpers/typeof":47}],245:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("babel-runtime/core-js/object/freeze")),o=r(e("babel-runtime/core-js/set")),s=r(e("babel-runtime/core-js/promise")),a=r(e("babel-runtime/core-js/map")),u=r(e("babel-runtime/core-js/object/define-properties")),c=r(e("babel-runtime/core-js/object/get-prototype-of")),l=r(e("babel-runtime/helpers/classCallCheck")),f=r(e("babel-runtime/helpers/createClass")),h=r(e("babel-runtime/helpers/possibleConstructorReturn")),d=r(e("babel-runtime/helpers/inherits")),p=r(e("events")),m=r(e("./logger")),v=r(e("uuid")),b=r(e("./configuration")),y=r(e("./twilsock")),_=r(e("./packetinterface")),g=function(e){function t(e,n){(0,l.default)(this,t);var r=(0,h.default)(this,(t.__proto__||(0,c.default)(t)).call(this));(n=n||{}).logLevel=n.logLevel||"error",m.default.setLevel(n.logLevel);var i=new b.default(e,n),o=new y.default(i),s=new _.default(o);return(0,u.default)(r,{_config:{value:i},_socket:{value:o},_packet:{value:s},_registrations:{value:new a.default},_registrationsInProgress:{value:new a.default},isConnected:{get:function(){return r._socket.isConnected}},connected:{get:function(){return r._socket.isConnected}},state:{get:function(){return r._socket.state}}}),r._socket.on("message",function(e,t){return setTimeout(function(){r.emit("message",e,t)},0)}),r._socket.on("connected",function(){return r._updateRegistrations()}),r._socket.on("connected",function(){return r.emit("connected")}),r._socket.on("disconnected",function(){return r.emit("disconnected")}),r._socket.on("stateChanged",function(e){return r.emit("stateChanged",e)}),r}return(0,d.default)(t,e),(0,f.default)(t,[{key:"send",value:function(e){return this._packet.send(e.to,e.headers,e.body)}},{key:"updateToken",value:function(e){return m.default.info("updateToken"),this._config.token===e?s.default.resolve():(this._config.updateToken(e),this._socket.updateToken(),s.default.resolve())}},{key:"_updateRegistration",value:function(e,t){var n=this;m.default.info("update registration for context",e);var r=this._registrationsInProgress.get(e);r||(r=new o.default,this._registrationsInProgress.set(e,r));var i=v.default.v4();return r.add(i),this._packet.putNotificationContext(e,t).then(function(){m.default.info("registration attempt succeeded for context",t),r.delete(i),0===r.size&&(n._registrationsInProgress.delete(e),n.emit("registered",e))}).catch(function(o){m.default.info("registration attempt failed for context",t),m.default.debug(o),r.delete(i),0===r.size&&(n._registrationsInProgress.delete(e),n.emit("registrationFailed",e,o))})}},{key:"_updateRegistrations",value:function(){var e=this;m.default.info("refreshing all registrations"),this._registrations.forEach(function(t,n){e._updateRegistration(n,t)})}},{key:"setNotificationsContext",value:function(e,t){if(!e||!t)throw new Error("Invalid arguments provided");this._registrations.set(e,t),this._socket.isConnected&&this._updateRegistration(e,t)}},{key:"removeNotificationsContext",value:function(e){this._registrations.has(e)&&(this._registrations.delete(e),this._socket.isConnected&&this._packet.deleteNotificationContext(e))}},{key:"connect",value:function(){return this._socket.connect()}},{key:"disconnect",value:function(){return this._socket.disconnect()}}]),t}(p.default);n.default=g,(0,i.default)(g),t.exports=n.default},{"./configuration":246,"./logger":248,"./packetinterface":249,"./twilsock":250,"babel-runtime/core-js/map":26,"babel-runtime/core-js/object/define-properties":30,"babel-runtime/core-js/object/freeze":32,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/core-js/set":38,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,events:194,uuid:254}],246:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("babel-runtime/core-js/object/define-properties")),o=r(e("babel-runtime/helpers/classCallCheck")),s=r(e("babel-runtime/helpers/createClass")),a="wss://tsock.twilio.com",u="/v3/wsconnect",c=function(){function e(t,n){var r=this;(0,o.default)(this,e);var s=((n=n||{}).Twilsock||{}).uri||n.wsServer||a;(0,i.default)(this,{_twilsockWsHost:{value:s+u},_token:{value:t,writable:!0},twilsockUri:{get:function(){return r._twilsockWsHost}},token:{get:function(){return r._token}}})}return(0,s.default)(e,[{key:"updateToken",value:function(e){this._token=e}}]),e}();n.default=c,t.exports=n.default},{"babel-runtime/core-js/object/define-properties":30,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],247:[function(e,t,n){arguments[4][214][0].apply(n,arguments)},{"./client":245,dup:214}],248:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return[e].concat((0,o.default)(t))}Object.defineProperty(n,"__esModule",{value:!0});var o=r(e("babel-runtime/core-js/array/from")),s=r(e("loglevel"));n.default={setLevel:function(e){s.default.setLevel(e)},trace:function(){s.default.trace.apply(null,i("Twilsock T:",arguments))},debug:function(){s.default.debug.apply(null,i("Twilsock D:",arguments))},info:function(){s.default.info.apply(null,i("Twilsock I:",arguments))},warn:function(){s.default.warn.apply(null,i("Twilsock W:",arguments))},error:function(){s.default.error.apply(null,i("Twilsock E:",arguments))}},t.exports=n.default},{"babel-runtime/core-js/array/from":22,loglevel:198}],249:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return e>=200&&e<300}function o(e){return e&&e.header&&e.header.http_status}Object.defineProperty(n,"__esModule",{value:!0});var s=r(e("babel-runtime/core-js/promise")),a=r(e("babel-runtime/core-js/map")),u=r(e("babel-runtime/core-js/object/define-properties")),c=r(e("babel-runtime/helpers/classCallCheck")),l=r(e("babel-runtime/helpers/createClass")),f=r(e("./logger")),h=function(){function e(t){var n=this;(0,c.default)(this,e),(0,u.default)(this,{_activeRequests:{value:new a.default},_socket:{value:t}}),this._socket.on("reply",this._processReply.bind(this)),this._socket.on("disconnected",function(){n._activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new Error("Twilsock disconnected"))}),n._activeRequests.clear()})}return(0,l.default)(e,[{key:"_processReply",value:function(e){var t=this._activeRequests.get(e.id);t&&(clearTimeout(t.timeout),this._activeRequests.delete(e.id),setTimeout(function(){i(e.status.code)?o(e)&&!i(e.header.http_status.code)?t.reject({status:e.header.http_status.code,description:e.header.http_status.status,body:e.body}):t.resolve(e):t.reject(new Error("Transport failure: "+e.status.status))},0))}},{key:"_storeRequest",value:function(e,t,n){var r={resolve:t,reject:n,timeout:setTimeout(function(){f.default.debug("request",e,"is timed out"),n(new Error("Twilsock: request timeout: "+e))},3e4)};this._activeRequests.set(e,r)}},{key:"send",value:function(e,t,n){var r=this;return new s.default(function(i,o){r._socket.isConnected||(f.default.info("Can not send upstream message. Twilsock is not in connected state"),o(new Error("Twilsock is not connected")));var s=r._socket.sendUpstreamMessage(e,t,n);f.default.trace("message sent: ",{id:s,address:e,headers:t,body:n}),r._storeRequest(s,i,o)})}},{key:"putNotificationContext",value:function(e,t){var n=this;return new s.default(function(r,i){n._socket.isConnected||(f.default.info("Can not send put notification context. Twilsock is not in connected state"),i(new Error("Twilsock is not connected")));var o={method:"put_notification_ctx",notification_ctx_id:e},s=n._socket.send(o,t);n._storeRequest(s,r,i)})}},{key:"deleteNotificationContext",value:function(e){var t=this;return new s.default(function(n,r){t._socket.isConnected||(f.default.info("Can not send delete notification context. Twilsock is not in connected state"),r(new Error("Twilsock is not connected")));var i={method:"delete_notification_ctx",notification_ctx_id:e},o=t._socket.send(i);t._storeRequest(o,n,r)})}},{key:"shutdown",value:function(){this._activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new Error("Twilsock: request cancelled by user"))}),this._activeRequests.clear()}}]),e}();n.default=h,t.exports=n.default},{"./logger":248,"babel-runtime/core-js/map":26,"babel-runtime/core-js/object/define-properties":30,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42}],250:[function(e,t,n){(function(r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function o(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}).length}function s(e){var t=encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}),n=new Uint8Array(t.length);return Array.prototype.forEach.call(t,function(e,t){n[t]=e.charCodeAt(0)}),n}function a(e){var t=Array.prototype.map.call(e,function(e){return String.fromCharCode(e)}).join("").replace(/(.)/g,function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n});return decodeURIComponent(t)}function u(e){for(var t="",n=0;n<e.length;++n){var r=String.fromCharCode(e[n]);if(t+=r,"\r"===r){n+=2;break}}var i=t.split(" ");return{size:n,protocol:i[0],version:i[1],headerSize:Number(i[2])}}function c(e){switch(void 0===e?"undefined":(0,C.default)(e)){case"undefined":return"";case"object":return(0,w.default)(e);default:return e}}function l(e){var t=a(e);try{return JSON.parse(t)}catch(e){throw j.default.error("failed to parse input: ",t),e}}Object.defineProperty(n,"__esModule",{value:!0});var f=i(e("babel-runtime/core-js/object/freeze")),h=i(e("babel-runtime/core-js/promise")),d=i(e("babel-runtime/helpers/slicedToArray")),p=i(e("babel-runtime/core-js/get-iterator")),m=i(e("babel-runtime/core-js/map")),v=i(e("babel-runtime/core-js/object/define-properties")),b=i(e("babel-runtime/core-js/object/get-prototype-of")),y=i(e("babel-runtime/helpers/classCallCheck")),_=i(e("babel-runtime/helpers/createClass")),g=i(e("babel-runtime/helpers/possibleConstructorReturn")),k=i(e("babel-runtime/helpers/inherits")),w=i(e("babel-runtime/core-js/json/stringify")),C=i(e("babel-runtime/helpers/typeof")),x=i(e("events")),j=i(e("./logger")),E=i(e("uuid")),S=i(e("backoff")),T=i(e("javascript-state-machine")),R=r.WebSocket||r.MozWebSocket||e("ws"),I=function(e){function t(e){(0,y.default)(this,t);var n=(0,g.default)(this,(t.__proto__||(0,b.default)(t)).call(this));e.logLevel&&j.default.setLevel(e.logLevel);var r=S.default.exponential({randomisationFactor:.2,initialDelay:2e3,maxDelay:12e4});return r.on("ready",function(){n._retry()}),n.on("reply",function(e){n._processReply(e)}),(0,v.default)(n,{_config:{value:e},_transportReady:{value:!1,writable:!0},_disconnectedPromiseResolve:{value:null,writable:!0},_backoffDefault:{value:r},_backoff:{value:r,writable:!0},_fsm:{value:null,writable:!0},_watchTimer:{value:null,writable:!0},_timestamp:{value:0,writable:!0},_socket:{value:null,writable:!0},_activeToken:{value:null,writable:!0},activeToken:{enumerable:!0,get:function(){return n._activeToken}},state:{enumberable:!0,get:function(){return n._getState()}},isConnected:{enumberable:!0,get:function(){return n._isConnected()}},_activeRequests:{value:new m.default},_disconnectingTimer:{value:null,writable:!0},_isDeferredUpdate:{value:!1,writable:!0}}),n._fsm=T.default.create({initial:"disconnected",events:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"}],callbacks:{onconnecting:function(){n._startWatchdogTimer(),n._setupSocket(),n.emit("connecting")},onenterinitialising:function(){n._sendInit()},onleaveinitialising:function(){n._cancelInit()},onenterupdating:function(){n._sendUpdate()},onleaveupdating:function(){n._cancelUpdate()},onenterretrying:function(){n._initRetry(),n.emit("connecting")},onenterconnected:function(){n._resetBackoff(),n._onConnected()},onuserUpdateToken:function(){n._resetBackoff()},ontokenRejected:function(){n._resetBackoff(),n._closeSocket(),n._finalizeSocket()},onuserDisconnect:function(){n._closeSocket()},onenterdisconnecting:function(){n._startDisconnectTimer()},onleavedisconnecting:function(){n._cancelDisconnectTimer()},onenterwaitSocketClosed:function(){n._startDisconnectTimer()},onleavewaitSocketClosed:function(){n._cancelDisconnectTimer()},onenterwaitOffloadSocketClosed:function(){n._startDisconnectTimer()},onleavewaitOffloadSocketClosed:function(){n._cancelDisconnectTimer()},ondisconnected:function(){n._resetBackoff(),n._finalizeSocket()},onreceiveClose:function(e,t,r,i){j.default.debug("onreceiveClose: ",i),n._onCloseReceived(i)},onreceiveOffload:function(e,t,r,i){j.default.debug("onreceiveoffload: ",i),n._modifyBackoff(i.body),n._onCloseReceived(i.status)},onunsupported:function(){n._closeSocket(),n._finalizeSocket()},onerror:function(){n._closeSocket(),n._finalizeSocket()},onenterstate:function(e,t,r){n._changeState(e,t,r)}},error:function(){j.default.warn("FSM: unexpected transition",arguments)}}),n}return(0,k.default)(t,e),(0,_.default)(t,[{key:"_changeState",value:function(e,t,n){var r=this;j.default.debug("FSM: ",e,": ",t,">>",n),this.emit("stateChanged",this.state),this._isDeferredUpdate&&(this._isDeferredUpdate=!1,setTimeout(function(){r.updateToken()},0))}},{key:"_resetBackoff",value:function(){j.default.trace("_resetBackoff"),this._backoff=this._backoffDefault,this._backoff.reset()}},{key:"_modifyBackoff",value:function(e){j.default.trace("_modifyBackoff",e);var t=e?e.backoff_policy:null;if(t){var n=t.reconnect_min_ms||2e3,r=t.reconnect_max_ms||12e4;j.default.debug("new backoff policy",n,r),this._backoff=S.default.exponential({randomisationFactor:.2,initialDelay:n,maxDelay:r})}}},{key:"_startDisconnectTimer",value:function(){var e=this;j.default.trace("_startDisconnectTimer"),this._disconnectingTimer&&(clearTimeout(this._disconnectingTimer),this._disconnectingTimer=null),this._disconnectingTimer=setTimeout(function(){j.default.debug("disconnecting is timed out"),e._closeSocket()},3e3)}},{key:"_cancelDisconnectTimer",value:function(){j.default.trace("_cancelDisconnectTimer"),this._disconnectingTimer&&(clearTimeout(this._disconnectingTimer),this._disconnectingTimer=null)}},{key:"_processReply",value:function(e){j.default.debug("receive reply:",e);var t=this._activeRequests.get(e.id);if(t)switch(clearTimeout(t.timeout),this._activeRequests.delete(e.id),t.reqType){case"init":e.status.code>=200&&e.status.code<300?this._fsm.initSuccess(e.body):401===e.status.code||403===e.status.code?this._fsm.tokenRejected(e.status):429===e.status.code?(this._modifyBackoff(e.body),this._fsm.initError(e.status)):this._fsm.initError(e.status);break;case"update":e.status.code>=200&&e.status.code<300?this._fsm.updateSuccess(e.body):401===e.status.code||403===e.status.code?this._fsm.tokenRejected(e.status):429===e.status.code?(this._modifyBackoff(e.body),this._fsm.updateError(e.status)):this._fsm.updateError(e.status);break;default:j.default.error("unexpected reply")}}},{key:"_storeRequest",value:function(e,t,n){var r=this;j.default.trace("_storeRequest");var i={reqType:t,timeout:setTimeout(function(){j.default.debug("request",t,": ",e,"is timed out"),"init"!==t&&"update"!==t&&j.default.error("unknown request type",t),r._closeSocket()},n)};this._activeRequests.set(e,i)}},{key:"_isConnected",value:function(){return this.state===t.state.CONNECTED&&this._socket&&1===this._socket.readyState}},{key:"_getState",value:function(){if(!this._fsm)return t.state.DISCONNECTED;switch(this._fsm.current){case"connecting":case"initialising":case"retrying":case"error":return t.state.CONNECTING;case"updating":case"connected":return t.state.CONNECTED;case"rejected":return t.state.REJECTED;case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return t.state.DISCONNECTING;case"disconnected":default:return t.state.DISCONNECTED}}},{key:"_initRetry",value:function(){j.default.trace("_initRetry"),this._backoff.backoff()}},{key:"_retry",value:function(){j.default.trace("_retry"),this._socket=null,this._activeToken=null,this._fsm.userRetry()}},{key:"_onConnected",value:function(){this.emit("connected")}},{key:"_finalizeSocket",value:function(){if(j.default.trace("_finalizeSocket"),this._stopWatchdogTimer(),this._onDisconnected(),this._disconnectedPromiseResolve){var e=this._disconnectedPromiseResolve;this._disconnectedPromiseResolve=null,e()}}},{key:"_onDisconnected",value:function(){this._socket=null,this._activeToken=null,this.emit("disconnected")}},{key:"_setupSocket",value:function(){j.default.trace("_setupSocket:",this._config.token);var e=this,t=this._config.twilsockUri;j.default.debug("try to connect to:",t);var n=new R(t);n.binaryType="arraybuffer",n.onopen=function(){j.default.info("socket opened"),e._fsm.socketConnected()},n.onclose=function(t){j.default.info("socket closed",t),e._fsm.socketClosed()},n.onerror=function(e){j.default.error("error: ",e)},n.onmessage=function(t){j.default.trace("data: ",t.data);var n=new Uint8Array(t.data),r=u(n);if("TWILSOCK"!==r.protocol||"V3.0"!==r.version)return j.default.error("unsupported protocol: "+r.protocol+" ver "+r.version),void e._fsm.unsupportedProtocol();var i=null;try{i=l(n.subarray(r.size,r.size+r.headerSize))}catch(n){return j.default.error("failed to parse message header",n,t),void e._fsm.protocolError()}j.default.trace("message received: ",i);var o=null;if(i.payload_size>0){var s=2+r.size+r.headerSize,c=i.payload_size;if(i.hasOwnProperty("payload_type")&&0!==i.payload_type.indexOf("application/json"))0===i.payload_type.indexOf("text/plain")&&(o=a(n.subarray(s,s+c)));else try{o=l(n.subarray(s,s+c))}catch(n){return j.default.error("failed to parse message body",n,t),void e._fsm.protocolError()}}e._updateActivityTimestamp(),"notification"===i.method?(e._confirmReceiving(i),e.emit("message",i.message_type,o)):"reply"===i.method?e.emit("reply",{id:i.id,status:i.status,header:i,body:o}):"ping"===i.method?e._confirmReceiving(i):"close"===i.method&&(j.default.trace("connection close initated by server"),e._confirmReceiving(i),308===i.status.code?(j.default.info("connection has been offloaded"),e._fsm.receiveOffload({status:i.status.status,body:o})):406===i.status.code?(j.default.error("connection has been rejected because server can not parse protocol"),e._fsm.receiveFatalClose()):417===i.status.code?(j.default.info("connection has been rejected because server could not understand client`s reply"),e._fsm.receiveFatalClose(i.status.status)):410===i.status.code?(j.default.info("connection has expired"),e._fsm.receiveClose(i.status.status)):401===i.status.code?(j.default.info("connection is not authenticate"),e._fsm.receiveClose(i.status.status)):(j.default.error("unexpected close: ",i.status),e._fsm.receiveOffload({status:i.status.status,body:null})))},this._activeToken=this._config.token,this._socket=n}},{key:"_sendInit",value:function(){j.default.trace("_sendInit");var e={id:E.default.v4(),method:"init",token:this._activeToken};this._sendPacket(e),this._storeRequest(e.id,"init",5e3)}},{key:"_sendUpdate",value:function(){j.default.trace("_sendUpdate");var e={id:E.default.v4(),method:"update",token:this._activeToken};this._sendPacket(e),this._storeRequest(e.id,"update",5e3)}},{key:"_cancelInit",value:function(){j.default.trace("_cancelInit");var e=!0,t=!1,n=void 0;try{for(var r,i=(0,p.default)(this._activeRequests);!(e=(r=i.next()).done);e=!0){var o=(0,d.default)(r.value,2),s=o[0],a=o[1];a&&"init"===a.reqType&&(clearTimeout(a.timeout),this._activeRequests.delete(s))}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},{key:"_cancelUpdate",value:function(){j.default.trace("_cancelUpdate");var e=!0,t=!1,n=void 0;try{for(var r,i=(0,p.default)(this._activeRequests);!(e=(r=i.next()).done);e=!0){var o=(0,d.default)(r.value,2),s=o[0],a=o[1];a&&"update"===a.reqType&&(clearTimeout(a.timeout),this._activeRequests.delete(s))}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},{key:"_confirmReceiving",value:function(e){j.default.trace("_confirmReceiving");var t={method:"reply",id:e.id,payload_type:"application/json",status:{code:200,status:"OK"}};try{this._sendPacket(t)}catch(e){j.default.debug("failed to confirm packet receiving",e)}}},{key:"_sendPacket",value:function(e,t){var n=c(t);e.payload_size=o(n);var r=(0,w.default)(e)+"\r\n",i="TWILSOCK V3.0 "+(o(r)-2)+"\r\n";j.default.debug("send request:",i+r+n);var a=s(i+r+n);try{this._socket.send(a.buffer)}catch(t){throw j.default.info("failed to send ",e,t),j.default.info(t.stack),t}}},{key:"_closeSocket",value:function(){j.default.trace("_closeSocket"),this._socket&&(this._socket.onopen=null,this._socket.onclose=null,this._socket.onerror=null,this._socket.onmessage=null,this._socket.close()),this._fsm.socketClosed()}},{key:"connect",value:function(){j.default.trace("connect"),this._fsm.userConnect()}},{key:"disconnect",value:function(){var e=this;return j.default.trace("disconnect"),this._fsm.is("disconnected")?h.default.resolve():new h.default(function(t){e._disconnectedPromiseResolve=t,e._fsm.userDisconnect()})}},{key:"updateToken",value:function(){if(j.default.trace("updateToken:",this._config.token),"initialising"===this._fsm.current||"updating"===this._fsm.current||"waitSocketClosed"===this._fsm.current||"waitOffloadSocketClosed"===this._fsm.current)return j.default.debug("defer updateToken because of",this._fsm.current,"is in progress"),void(this._isDeferredUpdate=!0);this._isDeferredUpdate=!1,this._activeToken=this._config.token,this._fsm.userUpdateToken()}},{key:"sendUpstreamMessage",value:function(e,t,n){var r=E.default.v4(),i={host:e.host,path:e.path,method:e.method};e.hasOwnProperty("params")&&(i.params=e.params);var o={method:"message",id:r,http_request:i};return t&&(o.http_request.headers=t),t&&t.hasOwnProperty("Content-Type")&&(o.payload_type=t["Content-Type"]),this._sendPacket(o,n),r}},{key:"send",value:function(e,t){return e.id=e.id||E.default.v4(),this._sendPacket(e,t),e.id}},{key:"_onCloseReceived",value:function(e){j.default.trace("_onCloseReceived"),j.default.info("connection closed by server, reason is",e),this._socket&&(this._socket.onopen=null,this._socket.onerror=null,this._socket.onmessage=null)}},{key:"_startWatchdogTimer",value:function(){var e=this;j.default.trace("_startWatchdogTimer"),this._timestamp=Date.now(),this._watchTimer=setInterval(function(){Date.now()-e._timestamp>43e3&&e._socket&&e._socket.close()},5e3)}},{key:"_stopWatchdogTimer",value:function(){j.default.trace("_stopWatchdogTimer"),clearInterval(this._watchTimer)}},{key:"_updateActivityTimestamp",value:function(){j.default.trace("_updateActivityTimestamp"),this._timestamp=Date.now()}}]),t}(x.default);n.default=I,I.state={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTING:"disconnecting",ERROR:"error",REJECTED:"rejected"},(0,f.default)(I.state),(0,f.default)(I),t.exports=n.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./logger":248,"babel-runtime/core-js/get-iterator":23,"babel-runtime/core-js/json/stringify":25,"babel-runtime/core-js/map":26,"babel-runtime/core-js/object/define-properties":30,"babel-runtime/core-js/object/freeze":32,"babel-runtime/core-js/object/get-prototype-of":33,"babel-runtime/core-js/promise":36,"babel-runtime/helpers/classCallCheck":41,"babel-runtime/helpers/createClass":42,"babel-runtime/helpers/inherits":44,"babel-runtime/helpers/possibleConstructorReturn":45,"babel-runtime/helpers/slicedToArray":46,"babel-runtime/helpers/typeof":47,backoff:49,events:194,"javascript-state-machine":196,uuid:254,ws:61}],251:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],252:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],253:[function(e,t,n){(function(t,r){function i(e,t){var r={seen:[],stylize:s};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),m(t)?r.showHidden=t:t&&n._extend(r,t),k(r.showHidden)&&(r.showHidden=!1),k(r.depth)&&(r.depth=2),k(r.colors)&&(r.colors=!1),k(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=o),u(r,e,r.depth)}function o(e,t){var n=i.styles[t];return n?"["+i.colors[n][0]+"m"+e+"["+i.colors[n][1]+"m":e}function s(e,t){return e}function a(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function u(e,t,r){if(e.customInspect&&t&&E(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return _(i)||(i=u(e,i,r)),i}var o=c(e,t);if(o)return o;var s=Object.keys(t),m=a(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),j(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return l(t);if(0===s.length){if(E(t)){var v=t.name?": "+t.name:"";return e.stylize("[Function"+v+"]","special")}if(w(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(x(t))return e.stylize(Date.prototype.toString.call(t),"date");if(j(t))return l(t)}var b="",y=!1,g=["{","}"];if(p(t)&&(y=!0,g=["[","]"]),E(t)&&(b=" [Function"+(t.name?": "+t.name:"")+"]"),w(t)&&(b=" "+RegExp.prototype.toString.call(t)),x(t)&&(b=" "+Date.prototype.toUTCString.call(t)),j(t)&&(b=" "+l(t)),0===s.length&&(!y||0==t.length))return g[0]+b+g[1];if(r<0)return w(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var k;return k=y?f(e,t,r,m,s):s.map(function(n){return h(e,t,r,m,n,y)}),e.seen.pop(),d(k,b,g)}function c(e,t){if(k(t))return e.stylize("undefined","undefined");if(_(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return y(t)?e.stylize(""+t,"number"):m(t)?e.stylize(""+t,"boolean"):v(t)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,i){for(var o=[],s=0,a=t.length;s<a;++s)A(t,String(s))?o.push(h(e,t,n,r,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(h(e,t,n,r,i,!0))}),o}function h(e,t,n,r,i,o){var s,a,c;if(c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},c.get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),A(r,i)||(s="["+i+"]"),a||(e.seen.indexOf(c.value)<0?(a=v(n)?u(e,c.value,null):u(e,c.value,n-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),k(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function d(e,t,n){var r=0;return e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function p(e){return Array.isArray(e)}function m(e){return"boolean"==typeof e}function v(e){return null===e}function b(e){return null==e}function y(e){return"number"==typeof e}function _(e){return"string"==typeof e}function g(e){return"symbol"==typeof e}function k(e){return void 0===e}function w(e){return C(e)&&"[object RegExp]"===T(e)}function C(e){return"object"==typeof e&&null!==e}function x(e){return C(e)&&"[object Date]"===T(e)}function j(e){return C(e)&&("[object Error]"===T(e)||e instanceof Error)}function E(e){return"function"==typeof e}function S(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function T(e){return Object.prototype.toString.call(e)}function R(e){return e<10?"0"+e.toString(10):e.toString(10)}function I(){var e=new Date,t=[R(e.getHours()),R(e.getMinutes()),R(e.getSeconds())].join(":");return[e.getDate(),M[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.format=function(e){if(!_(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(i(arguments[n]));return t.join(" ")}for(var n=1,r=arguments,o=r.length,s=String(e).replace(/%[sdj%]/g,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),a=r[n];n<o;a=r[++n])v(a)||!C(a)?s+=" "+a:s+=" "+i(a);return s},n.deprecate=function(e,i){function o(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),s=!0}return e.apply(this,arguments)}if(k(r.process))return function(){return n.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var s=!1;return o};var P,O={};n.debuglog=function(e){if(k(P)&&(P=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!O[e])if(new RegExp("\\b"+e+"\\b","i").test(P)){var r=t.pid;O[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else O[e]=function(){};return O[e]},n.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=p,n.isBoolean=m,n.isNull=v,n.isNullOrUndefined=b,n.isNumber=y,n.isString=_,n.isSymbol=g,n.isUndefined=k,n.isRegExp=w,n.isObject=C,n.isDate=x,n.isError=j,n.isFunction=E,n.isPrimitive=S,n.isBuffer=e("./support/isBuffer");var M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",I(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!C(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":252,_process:204,inherits:251}],254:[function(e,t,n){var r=e("./v1"),i=e("./v4"),o=i;o.v1=r,o.v4=i,t.exports=o},{"./v1":257,"./v4":258}],255:[function(e,t,n){function r(e,t){var n=t||0,r=i;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]}for(var i=[],o=0;o<256;++o)i[o]=(o+256).toString(16).substr(1);t.exports=r},{}],256:[function(e,t,n){(function(e){var n,r=e.crypto||e.msCrypto;if(r&&r.getRandomValues){var i=new Uint8Array(16);n=function(){return r.getRandomValues(i),i}}if(!n){var o=new Array(16);n=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],257:[function(e,t,n){function r(e,t,n){var r=t&&n||0,i=t||[],s=void 0!==(e=e||{}).clockseq?e.clockseq:u,f=void 0!==e.msecs?e.msecs:(new Date).getTime(),h=void 0!==e.nsecs?e.nsecs:l+1,d=f-c+(h-l)/1e4;if(d<0&&void 0===e.clockseq&&(s=s+1&16383),(d<0||f>c)&&void 0===e.nsecs&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=f,l=h,u=s;var p=(1e4*(268435455&(f+=122192928e5))+h)%4294967296;i[r++]=p>>>24&255,i[r++]=p>>>16&255,i[r++]=p>>>8&255,i[r++]=255&p;var m=f/4294967296*1e4&268435455;i[r++]=m>>>8&255,i[r++]=255&m,i[r++]=m>>>24&15|16,i[r++]=m>>>16&255,i[r++]=s>>>8|128,i[r++]=255&s;for(var v=e.node||a,b=0;b<6;++b)i[r+b]=v[b];return t||o(i)}var i=e("./lib/rng"),o=e("./lib/bytesToUuid"),s=i(),a=[1|s[0],s[1],s[2],s[3],s[4],s[5]],u=16383&(s[6]<<8|s[7]),c=0,l=0;t.exports=r},{"./lib/bytesToUuid":255,"./lib/rng":256}],258:[function(e,t,n){function r(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[r+a]=s[a];return t||o(s)}var i=e("./lib/rng"),o=e("./lib/bytesToUuid");t.exports=r},{"./lib/bytesToUuid":255,"./lib/rng":256}],259:[function(e,t,n){t.exports={h32:e("./xxhash"),h64:e("./xxhash64")}},{"./xxhash":260,"./xxhash64":261}],260:[function(e,t,n){(function(n){function r(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e.charCodeAt(n);i<128?t.push(i):i<2048?t.push(192|i>>6,128|63&i):i<55296||i>=57344?t.push(224|i>>12,128|i>>6&63,128|63&i):(n++,i=65536+((1023&i)<<10|1023&e.charCodeAt(n)),t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return new Uint8Array(t)}function i(){return 2==arguments.length?new i(arguments[1]).update(arguments[0]).digest():this instanceof i?void o.call(this,arguments[0]):new i(arguments[0])}function o(e){return this.seed=e instanceof s?e.clone():s(e),this.v1=this.seed.clone().add(a).add(u),this.v2=this.seed.clone().add(u),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(a),this.total_len=0,this.memsize=0,this.memory=null,this}var s=e("cuint").UINT32;s.prototype.xxh_update=function(e,t){var n,r,i=u._low,o=u._high;n=(r=e*i)>>>16,n+=t*i,n&=65535,n+=e*o;var s=this._low+(65535&r),c=s>>>16,l=(c+=this._high+(65535&n))<<16|65535&s;c=(l=l<<13|l>>>19)>>>16,n=(r=(s=65535&l)*(i=a._low))>>>16,n+=c*i,n&=65535,n+=s*(o=a._high),this._low=65535&r,this._high=65535&n};var a=s("2654435761"),u=s("2246822519"),c=s("3266489917"),l=s("668265263"),f=s("374761393");i.prototype.init=o,i.prototype.update=function(e){var t,i="string"==typeof e;i&&(e=r(e),i=!1,t=!0),"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer&&(t=!0,e=new Uint8Array(e));var o=0,s=e.length,a=o+s;if(0==s)return this;if(this.total_len+=s,0==this.memsize&&(this.memory=i?"":t?new Uint8Array(16):new n(16)),this.memsize+s<16)return i?this.memory+=e:t?this.memory.set(e.subarray(0,s),this.memsize):e.copy(this.memory,this.memsize,0,s),this.memsize+=s,this;if(this.memsize>0){i?this.memory+=e.slice(0,16-this.memsize):t?this.memory.set(e.subarray(0,16-this.memsize),this.memsize):e.copy(this.memory,this.memsize,0,16-this.memsize);var u=0;i?(this.v1.xxh_update(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2)),u+=4,this.v2.xxh_update(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2)),u+=4,this.v3.xxh_update(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2)),u+=4,this.v4.xxh_update(this.memory.charCodeAt(u+1)<<8|this.memory.charCodeAt(u),this.memory.charCodeAt(u+3)<<8|this.memory.charCodeAt(u+2))):(this.v1.xxh_update(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2]),u+=4,this.v2.xxh_update(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2]),u+=4,this.v3.xxh_update(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2]),u+=4,this.v4.xxh_update(this.memory[u+1]<<8|this.memory[u],this.memory[u+3]<<8|this.memory[u+2])),o+=16-this.memsize,this.memsize=0,i&&(this.memory="")}if(o<=a-16){var c=a-16;do{i?(this.v1.xxh_update(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2)),o+=4,this.v2.xxh_update(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2)),o+=4,this.v3.xxh_update(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2)),o+=4,this.v4.xxh_update(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2))):(this.v1.xxh_update(e[o+1]<<8|e[o],e[o+3]<<8|e[o+2]),o+=4,this.v2.xxh_update(e[o+1]<<8|e[o],e[o+3]<<8|e[o+2]),o+=4,this.v3.xxh_update(e[o+1]<<8|e[o],e[o+3]<<8|e[o+2]),o+=4,this.v4.xxh_update(e[o+1]<<8|e[o],e[o+3]<<8|e[o+2])),o+=4}while(o<=c)}return o<a&&(i?this.memory+=e.slice(o):t?this.memory.set(e.subarray(o,a),this.memsize):e.copy(this.memory,this.memsize,o,a),this.memsize=a-o),this},i.prototype.digest=function(){var e,t,n=this.memory,r="string"==typeof n,i=0,o=this.memsize,h=new s;for((e=this.total_len>=16?this.v1.rotl(1).add(this.v2.rotl(7).add(this.v3.rotl(12).add(this.v4.rotl(18)))):this.seed.clone().add(f)).add(h.fromNumber(this.total_len));i<=o-4;)r?h.fromBits(n.charCodeAt(i+1)<<8|n.charCodeAt(i),n.charCodeAt(i+3)<<8|n.charCodeAt(i+2)):h.fromBits(n[i+1]<<8|n[i],n[i+3]<<8|n[i+2]),e.add(h.multiply(c)).rotl(17).multiply(l),i+=4;for(;i<o;)h.fromBits(r?n.charCodeAt(i++):n[i++],0),e.add(h.multiply(f)).rotl(11).multiply(a);return t=e.clone().shiftRight(15),e.xor(t).multiply(u),t=e.clone().shiftRight(13),e.xor(t).multiply(c),t=e.clone().shiftRight(16),e.xor(t),this.init(this.seed),e},t.exports=i}).call(this,e("buffer").Buffer)},{buffer:62,cuint:189}],261:[function(e,t,n){(function(n){function r(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e.charCodeAt(n);i<128?t.push(i):i<2048?t.push(192|i>>6,128|63&i):i<55296||i>=57344?t.push(224|i>>12,128|i>>6&63,128|63&i):(n++,i=65536+((1023&i)<<10|1023&e.charCodeAt(n)),t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return new Uint8Array(t)}function i(){return 2==arguments.length?new i(arguments[1]).update(arguments[0]).digest():this instanceof i?void o.call(this,arguments[0]):new i(arguments[0])}function o(e){return this.seed=e instanceof s?e.clone():s(e),this.v1=this.seed.clone().add(a).add(u),this.v2=this.seed.clone().add(u),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(a),this.total_len=0,this.memsize=0,this.memory=null,this}var s=e("cuint").UINT64,a=s("11400714785074694791"),u=s("14029467366897019727"),c=s("1609587929392839161"),l=s("9650029242287828579"),f=s("2870177450012600261");i.prototype.init=o,i.prototype.update=function(e){var t,i="string"==typeof e;i&&(e=r(e),i=!1,t=!0),"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer&&(t=!0,e=new Uint8Array(e));var o=0,c=e.length,l=o+c;if(0==c)return this;if(this.total_len+=c,0==this.memsize&&(this.memory=i?"":t?new Uint8Array(32):new n(32)),this.memsize+c<32)return i?this.memory+=e:t?this.memory.set(e.subarray(0,c),this.memsize):e.copy(this.memory,this.memsize,0,c),this.memsize+=c,this;if(this.memsize>0){i?this.memory+=e.slice(0,32-this.memsize):t?this.memory.set(e.subarray(0,32-this.memsize),this.memsize):e.copy(this.memory,this.memsize,0,32-this.memsize);var f=0;if(i){d=s(this.memory.charCodeAt(f+1)<<8|this.memory.charCodeAt(f),this.memory.charCodeAt(f+3)<<8|this.memory.charCodeAt(f+2),this.memory.charCodeAt(f+5)<<8|this.memory.charCodeAt(f+4),this.memory.charCodeAt(f+7)<<8|this.memory.charCodeAt(f+6)),this.v1.add(d.multiply(u)).rotl(31).multiply(a),f+=8,d=s(this.memory.charCodeAt(f+1)<<8|this.memory.charCodeAt(f),this.memory.charCodeAt(f+3)<<8|this.memory.charCodeAt(f+2),this.memory.charCodeAt(f+5)<<8|this.memory.charCodeAt(f+4),this.memory.charCodeAt(f+7)<<8|this.memory.charCodeAt(f+6)),this.v2.add(d.multiply(u)).rotl(31).multiply(a),f+=8,d=s(this.memory.charCodeAt(f+1)<<8|this.memory.charCodeAt(f),this.memory.charCodeAt(f+3)<<8|this.memory.charCodeAt(f+2),this.memory.charCodeAt(f+5)<<8|this.memory.charCodeAt(f+4),this.memory.charCodeAt(f+7)<<8|this.memory.charCodeAt(f+6)),this.v3.add(d.multiply(u)).rotl(31).multiply(a),f+=8,d=s(this.memory.charCodeAt(f+1)<<8|this.memory.charCodeAt(f),this.memory.charCodeAt(f+3)<<8|this.memory.charCodeAt(f+2),this.memory.charCodeAt(f+5)<<8|this.memory.charCodeAt(f+4),this.memory.charCodeAt(f+7)<<8|this.memory.charCodeAt(f+6)),this.v4.add(d.multiply(u)).rotl(31).multiply(a)}else{d=s(this.memory[f+1]<<8|this.memory[f],this.memory[f+3]<<8|this.memory[f+2],this.memory[f+5]<<8|this.memory[f+4],this.memory[f+7]<<8|this.memory[f+6]),this.v1.add(d.multiply(u)).rotl(31).multiply(a),f+=8,d=s(this.memory[f+1]<<8|this.memory[f],this.memory[f+3]<<8|this.memory[f+2],this.memory[f+5]<<8|this.memory[f+4],this.memory[f+7]<<8|this.memory[f+6]),this.v2.add(d.multiply(u)).rotl(31).multiply(a),f+=8,d=s(this.memory[f+1]<<8|this.memory[f],this.memory[f+3]<<8|this.memory[f+2],this.memory[f+5]<<8|this.memory[f+4],this.memory[f+7]<<8|this.memory[f+6]),this.v3.add(d.multiply(u)).rotl(31).multiply(a),f+=8,d=s(this.memory[f+1]<<8|this.memory[f],this.memory[f+3]<<8|this.memory[f+2],this.memory[f+5]<<8|this.memory[f+4],this.memory[f+7]<<8|this.memory[f+6]),this.v4.add(d.multiply(u)).rotl(31).multiply(a)}o+=32-this.memsize,this.memsize=0,i&&(this.memory="")}if(o<=l-32){var h=l-32;do{if(i){d=s(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2),e.charCodeAt(o+5)<<8|e.charCodeAt(o+4),e.charCodeAt(o+7)<<8|e.charCodeAt(o+6)),this.v1.add(d.multiply(u)).rotl(31).multiply(a),o+=8,d=s(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2),e.charCodeAt(o+5)<<8|e.charCodeAt(o+4),e.charCodeAt(o+7)<<8|e.charCodeAt(o+6)),this.v2.add(d.multiply(u)).rotl(31).multiply(a),o+=8,d=s(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2),e.charCodeAt(o+5)<<8|e.charCodeAt(o+4),e.charCodeAt(o+7)<<8|e.charCodeAt(o+6)),this.v3.add(d.multiply(u)).rotl(31).multiply(a),o+=8,d=s(e.charCodeAt(o+1)<<8|e.charCodeAt(o),e.charCodeAt(o+3)<<8|e.charCodeAt(o+2),e.charCodeAt(o+5)<<8|e.charCodeAt(o+4),e.charCodeAt(o+7)<<8|e.charCodeAt(o+6)),this.v4.add(d.multiply(u)).rotl(31).multiply(a)}else{var d;d=s(e[o+1]<<8|e[o],e[o+3]<<8|e[o+2],e[o+5]<<8|e[o+4],e[o+7]<<8|e[o+6]),this.v1.add(d.multiply(u)).rotl(31).multiply(a),d=s(e[(o+=8)+1]<<8|e[o],e[o+3]<<8|e[o+2],e[o+5]<<8|e[o+4],e[o+7]<<8|e[o+6]),this.v2.add(d.multiply(u)).rotl(31).multiply(a),d=s(e[(o+=8)+1]<<8|e[o],e[o+3]<<8|e[o+2],e[o+5]<<8|e[o+4],e[o+7]<<8|e[o+6]),this.v3.add(d.multiply(u)).rotl(31).multiply(a),d=s(e[(o+=8)+1]<<8|e[o],e[o+3]<<8|e[o+2],e[o+5]<<8|e[o+4],e[o+7]<<8|e[o+6]),this.v4.add(d.multiply(u)).rotl(31).multiply(a)}o+=8}while(o<=h)}return o<l&&(i?this.memory+=e.slice(o):t?this.memory.set(e.subarray(o,l),this.memsize):e.copy(this.memory,this.memsize,o,l),this.memsize=l-o),this},i.prototype.digest=function(){var e,t,n=this.memory,r="string"==typeof n,i=0,o=this.memsize,h=new s;for(this.total_len>=32?((e=this.v1.clone().rotl(1)).add(this.v2.clone().rotl(7)),e.add(this.v3.clone().rotl(12)),e.add(this.v4.clone().rotl(18)),e.xor(this.v1.multiply(u).rotl(31).multiply(a)),e.multiply(a).add(l),e.xor(this.v2.multiply(u).rotl(31).multiply(a)),e.multiply(a).add(l),e.xor(this.v3.multiply(u).rotl(31).multiply(a)),e.multiply(a).add(l),e.xor(this.v4.multiply(u).rotl(31).multiply(a)),e.multiply(a).add(l)):e=this.seed.clone().add(f),e.add(h.fromNumber(this.total_len));i<=o-8;)r?h.fromBits(n.charCodeAt(i+1)<<8|n.charCodeAt(i),n.charCodeAt(i+3)<<8|n.charCodeAt(i+2),n.charCodeAt(i+5)<<8|n.charCodeAt(i+4),n.charCodeAt(i+7)<<8|n.charCodeAt(i+6)):h.fromBits(n[i+1]<<8|n[i],n[i+3]<<8|n[i+2],n[i+5]<<8|n[i+4],n[i+7]<<8|n[i+6]),h.multiply(u).rotl(31).multiply(a),e.xor(h).rotl(27).multiply(a).add(l),i+=8;for(i+4<=o&&(r?h.fromBits(n.charCodeAt(i+1)<<8|n.charCodeAt(i),n.charCodeAt(i+3)<<8|n.charCodeAt(i+2),0,0):h.fromBits(n[i+1]<<8|n[i],n[i+3]<<8|n[i+2],0,0),e.xor(h.multiply(a)).rotl(23).multiply(u).add(c),i+=4);i<o;)h.fromBits(r?n.charCodeAt(i++):n[i++],0,0,0),e.xor(h.multiply(f)).rotl(11).multiply(a);return t=e.clone().shiftRight(33),e.xor(t).multiply(u),t=e.clone().shiftRight(29),e.xor(t).multiply(c),t=e.clone().shiftRight(32),e.xor(t),this.init(this.seed),e},t.exports=i}).call(this,e("buffer").Buffer)},{buffer:62,cuint:189}],262:[function(e,t,n){t.exports={name:"twilio-chat",version:"0.13.0",description:"Twilio Chat service client library",main:"lib/index.js",browser:"browser/index.js",types:"./lib/client.d.ts",author:"Twilio",license:"MIT",dependencies:{"babel-runtime":"^6.18.0",backoff:"^2.5.0",durational:"^1.1.0",loglevel:"^1.4.1",platform:"^1.3.3",rfc6902:"^1.3.0","twilio-ems-client":"^0.2.0","twilio-notifications":"^0.4.0","twilio-sync":"^0.5.0","twilio-transport":"^0.1.1",twilsock:"^0.3.0",uuid:"^3.0.1"},devDependencies:{"@types/chai":"^3.4.35","@types/mocha":"^2.2.39","@types/node":"^7.0.5","@types/sinon":"^1.16.35","@types/sinon-as-promised":"^4.0.5","@types/sinon-chai":"^2.7.27",async:"^2.1.5","async-test-tools":"^1.0.6","babel-eslint":"^7.1.1","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-transform-async-to-generator":"^6.22.0","babel-plugin-transform-object-assign":"^6.22.0","babel-plugin-transform-runtime":"^6.23.0","babel-preset-es2015":"^6.22.0","babel-runtime":"^6.23.0",babelify:"^7.3.0",browserify:"^14.1.0","browserify-replace":"^0.9.0",chai:"^3.5.0","chai-as-promised":"^6.0.0",cheerio:"^0.22.0",del:"^2.2.2",express:"^4.14.1",gulp:"^3.9.1","gulp-babel":"^6.1.2","gulp-derequire":"^2.1.0","gulp-eslint":"^3.0.1","gulp-exit":"0.0.2","gulp-insert":"^0.5.0","gulp-istanbul":"^1.1.1","gulp-mocha":"^4.1.0","gulp-rename":"^1.2.2","gulp-replace":"^0.5.4","gulp-tap":"^0.1.3","gulp-tslint":"^7.1.0","gulp-typescript":"^3.1.5","gulp-uglify":"^2.0.1","gulp-util":"^3.0.8","ink-docstrap":"^1.3.0",isparta:"^4.0.0",jsdoc:"^3.4.3","jsdoc-strip-async-await":"^0.1.0",karma:"^1.5.0","karma-browserify":"^5.1.1","karma-browserstack-launcher":"^1.2.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.2","karma-sinon-ie":"^2.0.0","loglevel-message-prefix":"^2.0.1","mocha.parallel":"^0.15.0",proxyquire:"^1.7.11","run-sequence":"^1.2.2",sinon:"^1.17.7","sinon-as-promised":"^4.0.2","sinon-chai":"^2.8.0","ts-node":"^2.1.0",tslint:"^4.5.1",twilio:"^2.11.1",typescript:"^2.2.1","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0",watchify:"^3.9.0"},engines:{node:">=6"}}},{}]},{},[3])(3)});